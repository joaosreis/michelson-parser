{ parameter
    (or (or (or (or (pair %ban (pair address nat) bool) (nat %bid))
                (or (list %configure
                       (or (or (or (nat %fee) (key %importer))
                               (or (pair %limits
                                      (nat %free_mints)
                                      (pair (nat %stake_mints)
                                            (pair (nat %free_offers)
                                                  (pair (nat %stake_offers)
                                                        (pair (nat %cooldown) (pair (nat %max_duration) (nat %max_buttonists_duration)))))))
                                   (nat %mint_id)))
                           (address %mintery)))
                    (unit %confirm_admin)))
            (or (or (or %create
                       (or (pair %create_allpay
                              (pair (pair (mutez %bid_step) (int %duration)) (pair (address %kt) (nat %token_id)))
                              (pair (bool %wait) (nat %winner_percent)))
                           (pair %create_auction
                              (pair (pair (mutez %ask) (mutez %bid_step)) (pair (int %duration) (address %kt)))
                              (pair (nat %token_id) (bool %wait))))
                       (pair %create_sale
                          (pair (mutez %ask) (address %kt))
                          (pair (nat %token_id) (nat %volume))))
                    (pair %import_royalties (bytes %packed) (signature %signed)))
                (or (pair %mint (bytes %metadata) (pair (nat %volume) (nat %royalties))) (bool %pause))))
        (or (or (or (list %register
                       (pair (address %issuer)
                             (pair (address %kt) (pair (nat %token_id) (pair (nat %royalties) (nat %volume))))))
                    (nat %resolve))
                (or (address %set_admin) (nat %stake)))
            (or (or (nat %sync_mintery) (nat %unstake)) (address %upgrade)))) ;
  storage
    (pair (pair (pair (pair (pair (address %admin) (big_map %banned (pair address nat) unit))
                            (pair (int %cooldown) (address %fee_address)))
                      (pair (pair (nat %fee_permille) (nat %free_mints))
                            (pair (nat %free_offers) (key %import_signer))))
                (pair (pair (pair (big_map %market
                                     nat
                                     (pair (pair (pair (pair (mutez %ask) (mutez %bid)) (pair (mutez %bid_step) (timestamp %deadline)))
                                                 (pair (pair (int %duration) (nat %editions)) (pair (bool %ended) (int %kind))))
                                           (pair (pair (pair (address %kt) (bool %primary)) (pair (address %seller) (nat %sold)))
                                                 (pair (pair (nat %token_id) (nat %volume))
                                                       (pair (address %winner) (nat %winner_percent))))))
                                  (int %max_b_duration))
                            (pair (int %max_duration) (big_map %metadata string bytes)))
                      (pair (pair (nat %mint_id) (address %mintery))
                            (pair (nat %offer_id)
                                  (big_map %offers (pair address (pair address nat)) (pair nat bool))))))
          (pair (pair (pair (bool %paused) (option %pending_admin address))
                      (pair (big_map %royalties
                               (pair address nat)
                               (pair (pair (nat %editions) (address %issuer)) (nat %royalties)))
                            (big_map %sellers
                               address
                               (pair (pair (timestamp %mint_ts) (nat %mints)) (pair (nat %on_second) (nat %stake))))))
                (pair (pair (address %stake_contract) (nat %stake_mints))
                      (pair (nat %stake_offers) (big_map %stakes (pair address nat) timestamp))))) ;
  code { PUSH int 600 ;
         PUSH nat 25 ;
         PUSH int 0 ;
         PUSH int 1 ;
         PUSH int 2 ;
         NIL operation ;
         DIG 6 ;
         { { DUP ; CAR ; DIP { CDR } } } ;
         IF_LEFT
           { IF_LEFT
               { DIG 6 ;
                 DROP ;
                 IF_LEFT
                   { IF_LEFT
                       { DIG 3 ;
                         DIG 4 ;
                         DIG 5 ;
                         DIG 6 ;
                         DROP 4 ;
                         DUP ;
                         DUG 2 ;
                         CDR ;
                         PAIR ;
                         SWAP ;
                         DUP ;
                         DUG 2 ;
                         CAR ;
                         CDR ;
                         DIG 2 ;
                         CAR ;
                         CAR ;
                         DIG 2 ;
                         { { DUP ; CAR ; DIP { CDR } } } ;
                         SWAP ;
                         DUP ;
                         DUG 2 ;
                         CAR ;
                         CAR ;
                         CAR ;
                         CAR ;
                         CAR ;
                         SENDER ;
                         COMPARE ;
                         NEQ ;
                         IF { PUSH string "NOT_ADMIN" ; FAILWITH } {} ;
                         PUSH mutez 0 ;
                         AMOUNT ;
                         COMPARE ;
                         GT ;
                         IF { PUSH string "NO_TEZ_ALLOWED" ; FAILWITH } {} ;
                         IF { DUP ;
                              CDR ;
                              SWAP ;
                              DUP ;
                              DUG 2 ;
                              CAR ;
                              CDR ;
                              { DIP 2 { DUP } ; DIG 3 } ;
                              CAR ;
                              CAR ;
                              CDR ;
                              { DIP 3 { DUP } ; DIG 4 } ;
                              CAR ;
                              CAR ;
                              CAR ;
                              CDR ;
                              { DIP 4 { DUP } ; DIG 5 } ;
                              CAR ;
                              CAR ;
                              CAR ;
                              CAR ;
                              CDR ;
                              UNIT ;
                              DIG 8 ;
                              DIG 8 ;
                              PAIR ;
                              SWAP ;
                              SOME ;
                              SWAP ;
                              UPDATE ;
                              DIG 5 ;
                              CAR ;
                              CAR ;
                              CAR ;
                              CAR ;
                              CAR ;
                              PAIR ;
                              PAIR ;
                              PAIR ;
                              PAIR ;
                              PAIR }
                            { DUP ;
                              CDR ;
                              SWAP ;
                              DUP ;
                              DUG 2 ;
                              CAR ;
                              CDR ;
                              { DIP 2 { DUP } ; DIG 3 } ;
                              CAR ;
                              CAR ;
                              CDR ;
                              { DIP 3 { DUP } ; DIG 4 } ;
                              CAR ;
                              CAR ;
                              CAR ;
                              CDR ;
                              { DIP 4 { DUP } ; DIG 5 } ;
                              CAR ;
                              CAR ;
                              CAR ;
                              CAR ;
                              CDR ;
                              DIG 7 ;
                              DIG 7 ;
                              PAIR ;
                              NONE unit ;
                              SWAP ;
                              UPDATE ;
                              DIG 5 ;
                              CAR ;
                              CAR ;
                              CAR ;
                              CAR ;
                              CAR ;
                              PAIR ;
                              PAIR ;
                              PAIR ;
                              PAIR ;
                              PAIR } ;
                         SWAP ;
                         PAIR }
                       { PUSH bool True ;
                         { DIP 2 { DUP } ; DIG 3 } ;
                         CDR ;
                         CAR ;
                         CAR ;
                         CAR ;
                         COMPARE ;
                         EQ ;
                         IF { PUSH string "PAUSED" ; FAILWITH } {} ;
                         SWAP ;
                         DUP ;
                         DUG 2 ;
                         CAR ;
                         CDR ;
                         CAR ;
                         CAR ;
                         CAR ;
                         SWAP ;
                         DUP ;
                         DUG 2 ;
                         GET ;
                         IF_NONE { PUSH string "NOT_FOUND" ; FAILWITH } {} ;
                         PUSH string "BID_REJECTED" ;
                         SOURCE ;
                         SENDER ;
                         COMPARE ;
                         NEQ ;
                         { DIP 2 { DUP } ; DIG 3 } ;
                         CDR ;
                         CAR ;
                         CDR ;
                         CAR ;
                         SENDER ;
                         COMPARE ;
                         EQ ;
                         OR ;
                         IF { FAILWITH } { DROP } ;
                         { DIP 2 { DUP } ; DIG 3 } ;
                         { DIP 4 { DUP } ; DIG 5 } ;
                         { DIP 2 { DUP } ; DIG 3 } ;
                         PAIR ;
                         PAIR ;
                         DIG 7 ;
                         { DIP 2 { DUP } ; DIG 3 } ;
                         CAR ;
                         CDR ;
                         CDR ;
                         CDR ;
                         COMPARE ;
                         EQ ;
                         IF { DIG 5 ;
                              DIG 6 ;
                              DIG 7 ;
                              DROP 3 ;
                              PUSH string "BID_TOO_LOW" ;
                              { DIP 2 { DUP } ; DIG 3 } ;
                              CAR ;
                              CAR ;
                              CAR ;
                              CAR ;
                              AMOUNT ;
                              COMPARE ;
                              LT ;
                              IF { FAILWITH } { DROP } ;
                              { DIP 3 { DUP } ; DIG 4 } ;
                              { DIP 2 { DUP } ; DIG 3 } ;
                              CDR ;
                              CDR ;
                              CAR ;
                              CAR ;
                              { DIP 3 { DUP } ; DIG 4 } ;
                              CDR ;
                              CAR ;
                              CAR ;
                              CAR ;
                              DIG 2 ;
                              CDR ;
                              CAR ;
                              CDR ;
                              CAR ;
                              DUG 2 ;
                              PAIR ;
                              GET ;
                              IF_NONE { PUSH nat 0 ; SELF_ADDRESS ; PUSH nat 0 ; PAIR ; PAIR } {} ;
                              { DIP 4 { DUP } ; DIG 5 } ;
                              CDR ;
                              CAR ;
                              CDR ;
                              CDR ;
                              { DIP 3 { DUP } ; DIG 4 } ;
                              CDR ;
                              CAR ;
                              CDR ;
                              CAR ;
                              GET ;
                              IF_NONE
                                { PUSH nat 0 ; PUSH nat 0 ; PAIR ; PUSH nat 0 ; NOW ; PAIR ; PAIR }
                                {} ;
                              PUSH mutez 0 ;
                              { DIP 4 { DUP } ; DIG 5 } ;
                              CAR ;
                              CAR ;
                              CAR ;
                              CAR ;
                              COMPARE ;
                              GT ;
                              IF { { DIP 3 { DUP } ; DIG 4 } ;
                                   CAR ;
                                   CAR ;
                                   CAR ;
                                   CAR ;
                                   AMOUNT ;
                                   EDIV ;
                                   IF_NONE { PUSH string "DIV by 0" ; FAILWITH } {} ;
                                   CAR }
                                 { PUSH nat 1 } ;
                              { DIP 4 { DUP } ; DIG 5 } ;
                              CDR ;
                              CAR ;
                              CDR ;
                              CDR ;
                              { DIP 5 { DUP } ; DIG 6 } ;
                              CDR ;
                              CDR ;
                              CAR ;
                              CDR ;
                              SUB ;
                              ABS ;
                              PUSH string "BAD_AMOUNT" ;
                              AMOUNT ;
                              { DIP 3 { DUP } ; DIG 4 } ;
                              { DIP 8 { DUP } ; DIG 9 } ;
                              CAR ;
                              CAR ;
                              CAR ;
                              CAR ;
                              MUL ;
                              COMPARE ;
                              NEQ ;
                              { DIP 3 { DUP } ; DIG 4 } ;
                              DIG 3 ;
                              COMPARE ;
                              LT ;
                              OR ;
                              IF { FAILWITH } { DROP } ;
                              { DIP 4 { DUP } ; DIG 5 } ;
                              CDR ;
                              CDR ;
                              SWAP ;
                              DUP ;
                              DUG 2 ;
                              { DIP 6 { DUP } ; DIG 7 } ;
                              CDR ;
                              CAR ;
                              CDR ;
                              CDR ;
                              ADD ;
                              { DIP 6 { DUP } ; DIG 7 } ;
                              CDR ;
                              CAR ;
                              CDR ;
                              CAR ;
                              PAIR ;
                              { DIP 6 { DUP } ; DIG 7 } ;
                              CDR ;
                              CAR ;
                              CAR ;
                              PAIR ;
                              PAIR ;
                              DIG 5 ;
                              CAR ;
                              PAIR ;
                              DUP ;
                              CDR ;
                              SWAP ;
                              DUP ;
                              DUG 2 ;
                              CAR ;
                              CDR ;
                              CDR ;
                              CDR ;
                              { DIP 2 { DUP } ; DIG 3 } ;
                              CDR ;
                              CAR ;
                              CDR ;
                              CDR ;
                              { DIP 3 { DUP } ; DIG 4 } ;
                              CDR ;
                              CDR ;
                              CAR ;
                              CDR ;
                              COMPARE ;
                              EQ ;
                              PAIR ;
                              { DIP 2 { DUP } ; DIG 3 } ;
                              CAR ;
                              CDR ;
                              CAR ;
                              PAIR ;
                              { DIP 2 { DUP } ; DIG 3 } ;
                              CAR ;
                              CAR ;
                              PAIR ;
                              PAIR ;
                              { DIP 7 { DUP } ; DIG 8 } ;
                              CDR ;
                              { DIP 8 { DUP } ; DIG 9 } ;
                              CAR ;
                              CDR ;
                              CDR ;
                              CDR ;
                              CDR ;
                              { DIP 2 { DUP } ; DIG 3 } ;
                              CAR ;
                              CDR ;
                              CDR ;
                              CAR ;
                              NOT ;
                              { DIP 9 { DUP } ; DIG 10 } ;
                              PAIR ;
                              { DIP 3 { DUP } ; DIG 4 } ;
                              CDR ;
                              CDR ;
                              CAR ;
                              CAR ;
                              { DIP 4 { DUP } ; DIG 5 } ;
                              CDR ;
                              CAR ;
                              CAR ;
                              CAR ;
                              PAIR ;
                              { DIP 4 { DUP } ; DIG 5 } ;
                              CDR ;
                              CAR ;
                              CDR ;
                              CAR ;
                              PAIR ;
                              SWAP ;
                              SOME ;
                              SWAP ;
                              UPDATE ;
                              { DIP 9 { DUP } ; DIG 10 } ;
                              CAR ;
                              CDR ;
                              CDR ;
                              CDR ;
                              CAR ;
                              PAIR ;
                              { DIP 9 { DUP } ; DIG 10 } ;
                              CAR ;
                              CDR ;
                              CDR ;
                              CAR ;
                              PAIR ;
                              { DIP 9 { DUP } ; DIG 10 } ;
                              CAR ;
                              CDR ;
                              CAR ;
                              PAIR ;
                              DIG 9 ;
                              CAR ;
                              CAR ;
                              PAIR ;
                              PAIR ;
                              SWAP ;
                              DUP ;
                              DUG 2 ;
                              CAR ;
                              CDR ;
                              CDR ;
                              CAR ;
                              { DIP 2 { DUP } ; DIG 3 } ;
                              CDR ;
                              CAR ;
                              CAR ;
                              CDR ;
                              NOT ;
                              AND ;
                              IF { DUP ;
                                   CDR ;
                                   CDR ;
                                   SWAP ;
                                   DUP ;
                                   DUG 2 ;
                                   CDR ;
                                   CAR ;
                                   CDR ;
                                   CDR ;
                                   { DIP 6 { DUP } ; DIG 7 } ;
                                   CDR ;
                                   CDR ;
                                   PUSH nat 1 ;
                                   { DIP 8 { DUP } ; DIG 9 } ;
                                   CDR ;
                                   CAR ;
                                   SUB ;
                                   ABS ;
                                   PAIR ;
                                   { DIP 7 { DUP } ; DIG 8 } ;
                                   CAR ;
                                   PAIR ;
                                   { DIP 4 { DUP } ; DIG 5 } ;
                                   CDR ;
                                   CAR ;
                                   CDR ;
                                   CAR ;
                                   SWAP ;
                                   SOME ;
                                   SWAP ;
                                   UPDATE ;
                                   { DIP 2 { DUP } ; DIG 3 } ;
                                   CDR ;
                                   CAR ;
                                   CDR ;
                                   CAR ;
                                   PAIR ;
                                   { DIP 2 { DUP } ; DIG 3 } ;
                                   CDR ;
                                   CAR ;
                                   CAR ;
                                   PAIR ;
                                   PAIR ;
                                   SWAP ;
                                   CAR ;
                                   PAIR }
                                 {} ;
                              DUP ;
                              { DIP 7 { DUP } ; DIG 8 } ;
                              CDR ;
                              DIG 8 ;
                              CAR ;
                              CDR ;
                              DIG 5 ;
                              PAIR ;
                              CDR ;
                              { DIP 4 { DUP } ; DIG 5 } ;
                              PAIR ;
                              PAIR ;
                              CAR ;
                              PAIR ;
                              AMOUNT ;
                              { DIP 2 { DUP } ; DIG 3 } ;
                              CAR ;
                              CAR ;
                              CDR ;
                              CAR ;
                              CAR ;
                              DIG 6 ;
                              CDR ;
                              CDR ;
                              SWAP ;
                              PUSH nat 1000 ;
                              DIG 3 ;
                              EDIV ;
                              IF_NONE { PUSH string "DIV by 0" ; FAILWITH } {} ;
                              CAR ;
                              MUL ;
                              PUSH nat 4 ;
                              { DIP 2 { DUP } ; DIG 3 } ;
                              COMPARE ;
                              GE ;
                              IF { SWAP ;
                                   DROP ;
                                   PUSH nat 2 ;
                                   SWAP ;
                                   EDIV ;
                                   IF_NONE { PUSH string "DIV by 0" ; FAILWITH } {} ;
                                   CAR }
                                 { SWAP ;
                                   PUSH nat 8 ;
                                   { DIP 2 { DUP } ; DIG 3 } ;
                                   EDIV ;
                                   IF_NONE { PUSH string "DIV by 0" ; FAILWITH } {} ;
                                   CAR ;
                                   MUL ;
                                   SWAP ;
                                   SUB } ;
                              { DIP 3 { DUP } ; DIG 4 } ;
                              CDR ;
                              CAR ;
                              CAR ;
                              CDR ;
                              IF { PUSH mutez 0 }
                                 { { DIP 5 { DUP } ; DIG 6 } ;
                                   CDR ;
                                   PUSH nat 100 ;
                                   { DIP 2 { DUP } ; DIG 3 } ;
                                   AMOUNT ;
                                   SUB ;
                                   EDIV ;
                                   IF_NONE { PUSH string "DIV by 0" ; FAILWITH } {} ;
                                   CAR ;
                                   MUL } ;
                              DUP ;
                              { DIP 2 { DUP } ; DIG 3 } ;
                              AMOUNT ;
                              SUB ;
                              SUB ;
                              DIG 9 ;
                              DIG 3 ;
                              DIG 5 ;
                              CAR ;
                              CAR ;
                              CAR ;
                              CDR ;
                              CDR ;
                              PUSH mutez 0 ;
                              { DIP 2 { DUP } ; DIG 3 } ;
                              COMPARE ;
                              GT ;
                              IF { DIG 2 ;
                                   SWAP ;
                                   CONTRACT unit ;
                                   IF_NONE { PUSH string "BAD_TO" ; FAILWITH } {} ;
                                   DIG 2 ;
                                   UNIT ;
                                   TRANSFER_TOKENS ;
                                   CONS }
                                 { DROP 2 } ;
                              DUP ;
                              DIG 3 ;
                              DIG 7 ;
                              CAR ;
                              CDR ;
                              PUSH mutez 0 ;
                              { DIP 2 { DUP } ; DIG 3 } ;
                              COMPARE ;
                              GT ;
                              IF { DIG 2 ;
                                   SWAP ;
                                   CONTRACT unit ;
                                   IF_NONE { PUSH string "BAD_TO" ; FAILWITH } {} ;
                                   DIG 2 ;
                                   UNIT ;
                                   TRANSFER_TOKENS ;
                                   CONS }
                                 { DROP 2 } ;
                              DUP ;
                              DIG 3 ;
                              { DIP 5 { DUP } ; DIG 6 } ;
                              CDR ;
                              CAR ;
                              CDR ;
                              CAR ;
                              PUSH mutez 0 ;
                              { DIP 2 { DUP } ; DIG 3 } ;
                              COMPARE ;
                              GT ;
                              IF { DIG 2 ;
                                   SWAP ;
                                   CONTRACT unit ;
                                   IF_NONE { PUSH string "BAD_TO" ; FAILWITH } {} ;
                                   DIG 2 ;
                                   UNIT ;
                                   TRANSFER_TOKENS ;
                                   CONS }
                                 { DROP 2 } ;
                              DUP ;
                              DIG 6 ;
                              SENDER ;
                              SELF_ADDRESS ;
                              PAIR ;
                              { DIP 7 { DUP } ; DIG 8 } ;
                              CDR ;
                              CDR ;
                              CAR ;
                              CAR ;
                              DIG 8 ;
                              CDR ;
                              CAR ;
                              CAR ;
                              CAR ;
                              DIG 2 ;
                              { { DUP ; CAR ; DIP { CDR } } } ;
                              DIG 2 ;
                              CONTRACT %transfer
                                (list (pair (address %from_)
                                            (list %txs (pair (address %to_) (pair (nat %token_id) (nat %amount)))))) ;
                              IF_NONE { PUSH string "NOT_FA2_CONTRACT" ; FAILWITH } {} ;
                              PUSH mutez 0 ;
                              NIL (pair address (list (pair address (pair nat nat)))) ;
                              DIG 3 ;
                              NIL (pair address (pair nat nat)) ;
                              DIG 5 ;
                              DIG 6 ;
                              DIG 7 ;
                              SWAP ;
                              PAIR ;
                              SWAP ;
                              PAIR ;
                              CONS ;
                              SWAP ;
                              PAIR ;
                              CONS ;
                              TRANSFER_TOKENS ;
                              CONS ;
                              { DIP 4 { DUP } ; DIG 5 } ;
                              CDR ;
                              DIG 4 ;
                              DIG 5 ;
                              CAR ;
                              CAR ;
                              PAIR ;
                              PAIR ;
                              DUP ;
                              CDR ;
                              DIG 4 ;
                              DIG 2 ;
                              CAR ;
                              CAR ;
                              PAIR ;
                              PAIR ;
                              DUP ;
                              CDR ;
                              DIG 3 ;
                              DIG 2 ;
                              CAR ;
                              CAR ;
                              PAIR ;
                              PAIR ;
                              DUP ;
                              CDR ;
                              DUG 2 ;
                              CAR ;
                              CAR ;
                              PAIR ;
                              PAIR }
                            { DIG 3 ;
                              DROP ;
                              PUSH string "AUCTION_ENDED" ;
                              NOW ;
                              { DIP 3 { DUP } ; DIG 4 } ;
                              CAR ;
                              CAR ;
                              CDR ;
                              CDR ;
                              COMPARE ;
                              LT ;
                              PUSH timestamp 0 ;
                              { DIP 4 { DUP } ; DIG 5 } ;
                              CAR ;
                              CAR ;
                              CDR ;
                              CDR ;
                              COMPARE ;
                              GT ;
                              AND ;
                              IF { FAILWITH } { DROP } ;
                              PUSH string "SAME_BIDDER" ;
                              { DIP 2 { DUP } ; DIG 3 } ;
                              CDR ;
                              CDR ;
                              CDR ;
                              CAR ;
                              SENDER ;
                              COMPARE ;
                              EQ ;
                              IF { FAILWITH } { DROP } ;
                              DIG 5 ;
                              { DIP 2 { DUP } ; DIG 3 } ;
                              CAR ;
                              CDR ;
                              CDR ;
                              CDR ;
                              COMPARE ;
                              EQ ;
                              IF { DIG 4 ;
                                   DROP ;
                                   PUSH timestamp 0 ;
                                   { DIP 2 { DUP } ; DIG 3 } ;
                                   CAR ;
                                   CAR ;
                                   CDR ;
                                   CDR ;
                                   COMPARE ;
                                   EQ ;
                                   IF { SWAP ;
                                        DUP ;
                                        DUG 2 ;
                                        CDR ;
                                        { DIP 2 { DUP } ; DIG 3 } ;
                                        CAR ;
                                        CDR ;
                                        { DIP 3 { DUP } ; DIG 4 } ;
                                        CAR ;
                                        CDR ;
                                        CAR ;
                                        CAR ;
                                        NOW ;
                                        ADD ;
                                        { DIP 4 { DUP } ; DIG 5 } ;
                                        CAR ;
                                        CAR ;
                                        CDR ;
                                        CAR ;
                                        PAIR ;
                                        DIG 4 ;
                                        CAR ;
                                        CAR ;
                                        CAR ;
                                        PAIR ;
                                        PAIR ;
                                        PAIR }
                                      { SWAP } ;
                                   DUP ;
                                   CDR ;
                                   CDR ;
                                   CDR ;
                                   CAR ;
                                   SWAP ;
                                   DUP ;
                                   DUG 2 ;
                                   CDR ;
                                   CAR ;
                                   CDR ;
                                   CAR ;
                                   COMPARE ;
                                   EQ ;
                                   IF { DUP ; CAR ; CAR ; CAR ; CAR }
                                      { DUP ;
                                        CAR ;
                                        CAR ;
                                        CDR ;
                                        CAR ;
                                        SWAP ;
                                        DUP ;
                                        DUG 2 ;
                                        CAR ;
                                        CAR ;
                                        CAR ;
                                        CDR ;
                                        ADD } ;
                                   PUSH string "BID_TOO_LOW" ;
                                   SWAP ;
                                   AMOUNT ;
                                   COMPARE ;
                                   LT ;
                                   IF { FAILWITH } { DROP } ;
                                   DUP ;
                                   CDR ;
                                   CDR ;
                                   CDR ;
                                   CAR ;
                                   SWAP ;
                                   DUP ;
                                   DUG 2 ;
                                   CDR ;
                                   CAR ;
                                   CDR ;
                                   CAR ;
                                   COMPARE ;
                                   NEQ ;
                                   IF { DIG 3 ;
                                        SWAP ;
                                        DUP ;
                                        DUG 2 ;
                                        CAR ;
                                        CAR ;
                                        CAR ;
                                        CDR ;
                                        { DIP 2 { DUP } ; DIG 3 } ;
                                        CDR ;
                                        CDR ;
                                        CDR ;
                                        CAR ;
                                        PUSH mutez 0 ;
                                        { DIP 2 { DUP } ; DIG 3 } ;
                                        COMPARE ;
                                        GT ;
                                        IF { DIG 2 ;
                                             SWAP ;
                                             CONTRACT unit ;
                                             IF_NONE { PUSH string "BAD_TO" ; FAILWITH } {} ;
                                             DIG 2 ;
                                             UNIT ;
                                             TRANSFER_TOKENS ;
                                             CONS }
                                           { DROP 2 } }
                                      { DIG 3 } ;
                                   SWAP ;
                                   DUP ;
                                   DUG 2 ;
                                   CDR ;
                                   { DIP 2 { DUP } ; DIG 3 } ;
                                   CAR ;
                                   CDR ;
                                   { DIP 3 { DUP } ; DIG 4 } ;
                                   CAR ;
                                   CAR ;
                                   CDR ;
                                   AMOUNT ;
                                   DIG 5 ;
                                   CAR ;
                                   CAR ;
                                   CAR ;
                                   CAR ;
                                   PAIR ;
                                   PAIR ;
                                   PAIR ;
                                   PAIR ;
                                   PAIR }
                                 { DIG 4 ;
                                   { DIP 2 { DUP } ; DIG 3 } ;
                                   CAR ;
                                   CDR ;
                                   CDR ;
                                   CDR ;
                                   COMPARE ;
                                   EQ ;
                                   IF { PUSH string "WRONG_AMOUNT" ;
                                        { DIP 2 { DUP } ; DIG 3 } ;
                                        CAR ;
                                        CAR ;
                                        CDR ;
                                        CAR ;
                                        AMOUNT ;
                                        COMPARE ;
                                        NEQ ;
                                        IF { FAILWITH } { DROP } ;
                                        SWAP ;
                                        DUP ;
                                        DUG 2 ;
                                        CDR ;
                                        { DIP 2 { DUP } ; DIG 3 } ;
                                        CAR ;
                                        CDR ;
                                        { DIP 3 { DUP } ; DIG 4 } ;
                                        CAR ;
                                        CAR ;
                                        CDR ;
                                        AMOUNT ;
                                        { DIP 5 { DUP } ; DIG 6 } ;
                                        CAR ;
                                        CAR ;
                                        CAR ;
                                        CDR ;
                                        ADD ;
                                        DIG 5 ;
                                        CAR ;
                                        CAR ;
                                        CAR ;
                                        CAR ;
                                        PAIR ;
                                        PAIR ;
                                        PAIR ;
                                        PAIR ;
                                        DUP ;
                                        CDR ;
                                        SWAP ;
                                        DUP ;
                                        DUG 2 ;
                                        CAR ;
                                        CDR ;
                                        { DIP 2 { DUP } ; DIG 3 } ;
                                        CAR ;
                                        CAR ;
                                        CDR ;
                                        CAR ;
                                        { DIP 3 { DUP } ; DIG 4 } ;
                                        CAR ;
                                        CAR ;
                                        CAR ;
                                        CDR ;
                                        EDIV ;
                                        IF_NONE { PUSH string "DIV by 0" ; FAILWITH } {} ;
                                        CAR ;
                                        INT ;
                                        PUSH int 2 ;
                                        MUL ;
                                        { DIP 3 { DUP } ; DIG 4 } ;
                                        CAR ;
                                        CDR ;
                                        CAR ;
                                        CAR ;
                                        EDIV ;
                                        IF_NONE { PUSH string "DIV by 0" ; FAILWITH } {} ;
                                        CAR ;
                                        PUSH int 2 ;
                                        { DIP 4 { DUP } ; DIG 5 } ;
                                        CAR ;
                                        CDR ;
                                        CAR ;
                                        CAR ;
                                        EDIV ;
                                        IF_NONE { PUSH string "DIV by 0" ; FAILWITH } {} ;
                                        CAR ;
                                        NOW ;
                                        ADD ;
                                        ADD ;
                                        { DIP 3 { DUP } ; DIG 4 } ;
                                        CAR ;
                                        CAR ;
                                        CDR ;
                                        CAR ;
                                        PAIR ;
                                        DIG 3 ;
                                        CAR ;
                                        CAR ;
                                        CAR ;
                                        PAIR ;
                                        PAIR ;
                                        PAIR }
                                      { SWAP } ;
                                   DIG 3 ;
                                   SWAP ;
                                   PAIR } ;
                              DUP ;
                              CAR ;
                              DUP ;
                              CDR ;
                              CDR ;
                              CDR ;
                              CDR ;
                              SENDER ;
                              PAIR ;
                              SWAP ;
                              DUP ;
                              DUG 2 ;
                              CDR ;
                              CDR ;
                              CAR ;
                              PAIR ;
                              SWAP ;
                              DUP ;
                              DUG 2 ;
                              CDR ;
                              CAR ;
                              PAIR ;
                              SWAP ;
                              DUP ;
                              DUG 2 ;
                              CAR ;
                              PAIR ;
                              { DIP 5 { DUP } ; DIG 6 } ;
                              NOW ;
                              { DIP 2 { DUP } ; DIG 3 } ;
                              CAR ;
                              CAR ;
                              CDR ;
                              CDR ;
                              SUB ;
                              COMPARE ;
                              LT ;
                              IF { DUP ;
                                   CDR ;
                                   SWAP ;
                                   DUP ;
                                   DUG 2 ;
                                   CAR ;
                                   CDR ;
                                   DIG 7 ;
                                   { DIP 3 { DUP } ; DIG 4 } ;
                                   CAR ;
                                   CAR ;
                                   CDR ;
                                   CDR ;
                                   ADD ;
                                   { DIP 3 { DUP } ; DIG 4 } ;
                                   CAR ;
                                   CAR ;
                                   CDR ;
                                   CAR ;
                                   PAIR ;
                                   { DIP 3 { DUP } ; DIG 4 } ;
                                   CAR ;
                                   CAR ;
                                   CAR ;
                                   PAIR ;
                                   PAIR ;
                                   PAIR }
                                 { DIG 5 ; DROP ; DUP } ;
                              { DIP 4 { DUP } ; DIG 5 } ;
                              CDR ;
                              DIG 5 ;
                              CAR ;
                              CDR ;
                              DIG 4 ;
                              PAIR ;
                              PAIR ;
                              DUP ;
                              CDR ;
                              DIG 4 ;
                              CDR ;
                              DIG 2 ;
                              CAR ;
                              CAR ;
                              PAIR ;
                              CDR ;
                              DIG 3 ;
                              PAIR ;
                              CDR ;
                              DIG 2 ;
                              PAIR ;
                              PAIR } ;
                         DUP ;
                         CDR ;
                         DUP ;
                         CDR ;
                         SWAP ;
                         DUP ;
                         DUG 2 ;
                         CAR ;
                         CDR ;
                         CDR ;
                         { DIP 2 { DUP } ; DIG 3 } ;
                         CAR ;
                         CDR ;
                         CAR ;
                         CDR ;
                         { DIP 3 { DUP } ; DIG 4 } ;
                         CAR ;
                         CDR ;
                         CAR ;
                         CAR ;
                         CDR ;
                         { DIP 4 { DUP } ; DIG 5 } ;
                         CAR ;
                         CDR ;
                         CAR ;
                         CAR ;
                         CAR ;
                         { DIP 6 { DUP } ; DIG 7 } ;
                         CAR ;
                         CAR ;
                         DIG 8 ;
                         SWAP ;
                         SOME ;
                         SWAP ;
                         UPDATE ;
                         PAIR ;
                         PAIR ;
                         PAIR ;
                         DIG 2 ;
                         CAR ;
                         CAR ;
                         PAIR ;
                         PAIR ;
                         SWAP ;
                         CAR ;
                         CDR ;
                         PAIR } }
                   { DIG 3 ;
                     DIG 4 ;
                     DIG 5 ;
                     DIG 6 ;
                     DROP 4 ;
                     IF_LEFT
                       { SWAP ;
                         DUP ;
                         DUG 2 ;
                         CAR ;
                         CAR ;
                         CAR ;
                         CAR ;
                         CAR ;
                         SENDER ;
                         COMPARE ;
                         NEQ ;
                         IF { PUSH string "NOT_ADMIN" ; FAILWITH } {} ;
                         PUSH mutez 0 ;
                         AMOUNT ;
                         COMPARE ;
                         GT ;
                         IF { PUSH string "NO_TEZ_ALLOWED" ; FAILWITH } {} ;
                         ITER { IF_LEFT
                                  { IF_LEFT
                                      { IF_LEFT
                                          { PUSH nat 1000 ;
                                            SWAP ;
                                            DUP ;
                                            DUG 2 ;
                                            COMPARE ;
                                            GT ;
                                            IF { DROP ; PUSH string "BAD_FEE" ; FAILWITH }
                                               { SWAP ;
                                                 DUP ;
                                                 DUG 2 ;
                                                 CDR ;
                                                 { DIP 2 { DUP } ; DIG 3 } ;
                                                 CAR ;
                                                 CDR ;
                                                 { DIP 3 { DUP } ; DIG 4 } ;
                                                 CAR ;
                                                 CAR ;
                                                 CDR ;
                                                 CDR ;
                                                 { DIP 4 { DUP } ; DIG 5 } ;
                                                 CAR ;
                                                 CAR ;
                                                 CDR ;
                                                 CAR ;
                                                 CDR ;
                                                 DIG 4 ;
                                                 PAIR ;
                                                 PAIR ;
                                                 DIG 3 ;
                                                 CAR ;
                                                 CAR ;
                                                 CAR ;
                                                 PAIR ;
                                                 PAIR ;
                                                 PAIR } }
                                          { SWAP ;
                                            DUP ;
                                            DUG 2 ;
                                            CDR ;
                                            { DIP 2 { DUP } ; DIG 3 } ;
                                            CAR ;
                                            CDR ;
                                            DIG 2 ;
                                            { DIP 3 { DUP } ; DIG 4 } ;
                                            CAR ;
                                            CAR ;
                                            CDR ;
                                            CDR ;
                                            CAR ;
                                            PAIR ;
                                            { DIP 3 { DUP } ; DIG 4 } ;
                                            CAR ;
                                            CAR ;
                                            CDR ;
                                            CAR ;
                                            PAIR ;
                                            DIG 3 ;
                                            CAR ;
                                            CAR ;
                                            CAR ;
                                            PAIR ;
                                            PAIR ;
                                            PAIR } }
                                      { IF_LEFT
                                          { SWAP ;
                                            DUP ;
                                            DUG 2 ;
                                            CDR ;
                                            { DIP 2 { DUP } ; DIG 3 } ;
                                            CAR ;
                                            CDR ;
                                            { DIP 3 { DUP } ; DIG 4 } ;
                                            CAR ;
                                            CAR ;
                                            CDR ;
                                            CDR ;
                                            { DIP 3 { DUP } ; DIG 4 } ;
                                            CAR ;
                                            { DIP 5 { DUP } ; DIG 6 } ;
                                            CAR ;
                                            CAR ;
                                            CDR ;
                                            CAR ;
                                            CAR ;
                                            PAIR ;
                                            PAIR ;
                                            DIG 4 ;
                                            CAR ;
                                            CAR ;
                                            CAR ;
                                            PAIR ;
                                            PAIR ;
                                            PAIR ;
                                            DUP ;
                                            CDR ;
                                            CDR ;
                                            CDR ;
                                            { DIP 2 { DUP } ; DIG 3 } ;
                                            GET 3 ;
                                            { DIP 2 { DUP } ; DIG 3 } ;
                                            CDR ;
                                            CDR ;
                                            CAR ;
                                            CAR ;
                                            PAIR ;
                                            PAIR ;
                                            SWAP ;
                                            DUP ;
                                            DUG 2 ;
                                            CDR ;
                                            CAR ;
                                            PAIR ;
                                            SWAP ;
                                            CAR ;
                                            PAIR ;
                                            DUP ;
                                            CDR ;
                                            SWAP ;
                                            DUP ;
                                            DUG 2 ;
                                            CAR ;
                                            CDR ;
                                            { DIP 2 { DUP } ; DIG 3 } ;
                                            CAR ;
                                            CAR ;
                                            CDR ;
                                            CDR ;
                                            CDR ;
                                            { DIP 4 { DUP } ; DIG 5 } ;
                                            GET 5 ;
                                            PAIR ;
                                            { DIP 3 { DUP } ; DIG 4 } ;
                                            CAR ;
                                            CAR ;
                                            CDR ;
                                            CAR ;
                                            PAIR ;
                                            DIG 3 ;
                                            CAR ;
                                            CAR ;
                                            CAR ;
                                            PAIR ;
                                            PAIR ;
                                            PAIR ;
                                            DUP ;
                                            CDR ;
                                            CDR ;
                                            CDR ;
                                            CDR ;
                                            { DIP 2 { DUP } ; DIG 3 } ;
                                            GET 7 ;
                                            PAIR ;
                                            SWAP ;
                                            DUP ;
                                            DUG 2 ;
                                            CDR ;
                                            CDR ;
                                            CAR ;
                                            PAIR ;
                                            SWAP ;
                                            DUP ;
                                            DUG 2 ;
                                            CDR ;
                                            CAR ;
                                            PAIR ;
                                            SWAP ;
                                            CAR ;
                                            PAIR ;
                                            DUP ;
                                            CDR ;
                                            SWAP ;
                                            DUP ;
                                            DUG 2 ;
                                            CAR ;
                                            CDR ;
                                            { DIP 2 { DUP } ; DIG 3 } ;
                                            CAR ;
                                            CAR ;
                                            CDR ;
                                            { DIP 3 { DUP } ; DIG 4 } ;
                                            CAR ;
                                            CAR ;
                                            CAR ;
                                            CDR ;
                                            CDR ;
                                            { DIP 5 { DUP } ; DIG 6 } ;
                                            GET 9 ;
                                            INT ;
                                            PAIR ;
                                            DIG 4 ;
                                            CAR ;
                                            CAR ;
                                            CAR ;
                                            CAR ;
                                            PAIR ;
                                            PAIR ;
                                            PAIR ;
                                            PAIR ;
                                            DUP ;
                                            CDR ;
                                            SWAP ;
                                            DUP ;
                                            DUG 2 ;
                                            CAR ;
                                            CDR ;
                                            CDR ;
                                            { DIP 2 { DUP } ; DIG 3 } ;
                                            CAR ;
                                            CDR ;
                                            CAR ;
                                            CDR ;
                                            CDR ;
                                            PUSH nat 1200 ;
                                            { DIP 5 { DUP } ; DIG 6 } ;
                                            GET 11 ;
                                            COMPARE ;
                                            LT ;
                                            IF { PUSH string "MAX_DURATION" ; FAILWITH }
                                               { { DIP 4 { DUP } ; DIG 5 } ; GET 11 ; INT } ;
                                            PAIR ;
                                            { DIP 3 { DUP } ; DIG 4 } ;
                                            CAR ;
                                            CDR ;
                                            CAR ;
                                            CAR ;
                                            PAIR ;
                                            PAIR ;
                                            DIG 2 ;
                                            CAR ;
                                            CAR ;
                                            PAIR ;
                                            PAIR ;
                                            DUP ;
                                            CDR ;
                                            SWAP ;
                                            DUP ;
                                            DUG 2 ;
                                            CAR ;
                                            CDR ;
                                            CDR ;
                                            { DIP 2 { DUP } ; DIG 3 } ;
                                            CAR ;
                                            CDR ;
                                            CAR ;
                                            CDR ;
                                            PUSH nat 1200 ;
                                            { DIP 5 { DUP } ; DIG 6 } ;
                                            GET 12 ;
                                            COMPARE ;
                                            LT ;
                                            IF { DIG 4 ; DROP ; PUSH string "MAX_B_DURATION" ; FAILWITH }
                                               { DIG 4 ; GET 12 ; INT } ;
                                            { DIP 4 { DUP } ; DIG 5 } ;
                                            CAR ;
                                            CDR ;
                                            CAR ;
                                            CAR ;
                                            CAR ;
                                            PAIR ;
                                            PAIR ;
                                            PAIR ;
                                            DIG 2 ;
                                            CAR ;
                                            CAR ;
                                            PAIR ;
                                            PAIR }
                                          { SWAP ;
                                            DUP ;
                                            DUG 2 ;
                                            CDR ;
                                            { DIP 2 { DUP } ; DIG 3 } ;
                                            CAR ;
                                            CDR ;
                                            CDR ;
                                            CDR ;
                                            { DIP 3 { DUP } ; DIG 4 } ;
                                            CAR ;
                                            CDR ;
                                            CDR ;
                                            CAR ;
                                            CDR ;
                                            DIG 3 ;
                                            PAIR ;
                                            PAIR ;
                                            { DIP 2 { DUP } ; DIG 3 } ;
                                            CAR ;
                                            CDR ;
                                            CAR ;
                                            PAIR ;
                                            DIG 2 ;
                                            CAR ;
                                            CAR ;
                                            PAIR ;
                                            PAIR } } }
                                  { SWAP ;
                                    DUP ;
                                    DUG 2 ;
                                    CDR ;
                                    { DIP 2 { DUP } ; DIG 3 } ;
                                    CAR ;
                                    CDR ;
                                    CDR ;
                                    CDR ;
                                    DIG 2 ;
                                    { DIP 3 { DUP } ; DIG 4 } ;
                                    CAR ;
                                    CDR ;
                                    CDR ;
                                    CAR ;
                                    CAR ;
                                    PAIR ;
                                    PAIR ;
                                    { DIP 2 { DUP } ; DIG 3 } ;
                                    CAR ;
                                    CDR ;
                                    CAR ;
                                    PAIR ;
                                    DIG 2 ;
                                    CAR ;
                                    CAR ;
                                    PAIR ;
                                    PAIR } } ;
                         SWAP ;
                         PAIR }
                       { DROP ;
                         PUSH mutez 0 ;
                         AMOUNT ;
                         COMPARE ;
                         GT ;
                         IF { PUSH string "NO_TEZ_ALLOWED" ; FAILWITH } {} ;
                         DUP ;
                         CDR ;
                         CAR ;
                         CAR ;
                         CDR ;
                         IF_NONE { PUSH string "NO_PENDING_ADMIN" ; FAILWITH } {} ;
                         SENDER ;
                         COMPARE ;
                         EQ ;
                         IF { DUP ;
                              CDR ;
                              SWAP ;
                              DUP ;
                              DUG 2 ;
                              CAR ;
                              CDR ;
                              { DIP 2 { DUP } ; DIG 3 } ;
                              CAR ;
                              CAR ;
                              CDR ;
                              { DIP 3 { DUP } ; DIG 4 } ;
                              CAR ;
                              CAR ;
                              CAR ;
                              CDR ;
                              DIG 4 ;
                              CAR ;
                              CAR ;
                              CAR ;
                              CAR ;
                              CDR ;
                              SENDER ;
                              PAIR ;
                              PAIR ;
                              PAIR ;
                              PAIR ;
                              PAIR ;
                              DUP ;
                              CDR ;
                              CDR ;
                              SWAP ;
                              DUP ;
                              DUG 2 ;
                              CDR ;
                              CAR ;
                              CDR ;
                              NONE address ;
                              { DIP 3 { DUP } ; DIG 4 } ;
                              CDR ;
                              CAR ;
                              CAR ;
                              CAR ;
                              PAIR ;
                              PAIR ;
                              PAIR ;
                              SWAP ;
                              CAR ;
                              PAIR }
                            { PUSH string "NOT_A_PENDING_ADMIN" ; FAILWITH } ;
                         SWAP ;
                         PAIR } } }
               { IF_LEFT
                   { IF_LEFT
                       { DIG 2 ;
                         DIG 6 ;
                         DROP 2 ;
                         PUSH bool True ;
                         { DIP 2 { DUP } ; DIG 3 } ;
                         CDR ;
                         CAR ;
                         CAR ;
                         CAR ;
                         COMPARE ;
                         EQ ;
                         IF { PUSH string "PAUSED" ; FAILWITH } {} ;
                         PUSH mutez 0 ;
                         AMOUNT ;
                         COMPARE ;
                         GT ;
                         IF { PUSH string "NO_TEZ_ALLOWED" ; FAILWITH } {} ;
                         IF_LEFT
                           { DIG 4 ;
                             DROP ;
                             IF_LEFT
                               { DIG 3 ;
                                 DIG 4 ;
                                 DROP 2 ;
                                 SWAP ;
                                 DUP ;
                                 DUG 2 ;
                                 SWAP ;
                                 DUP ;
                                 DUG 2 ;
                                 CAR ;
                                 CDR ;
                                 CDR ;
                                 { DIP 2 { DUP } ; DIG 3 } ;
                                 CAR ;
                                 CDR ;
                                 CAR ;
                                 PAIR ;
                                 PUSH string "TOKEN_BANNED" ;
                                 { DIP 2 { DUP } ; DIG 3 } ;
                                 CAR ;
                                 CAR ;
                                 CAR ;
                                 CAR ;
                                 CDR ;
                                 { DIP 2 { DUP } ; DIG 3 } ;
                                 MEM ;
                                 IF { FAILWITH } { DROP } ;
                                 SWAP ;
                                 DUP ;
                                 DUG 2 ;
                                 CAR ;
                                 CDR ;
                                 CDR ;
                                 CDR ;
                                 CDR ;
                                 SWAP ;
                                 SENDER ;
                                 PAIR ;
                                 GET ;
                                 IF_NONE
                                   { CAR ; CDR ; CDR ; CDR ; CAR }
                                   { CDR ;
                                     IF { DROP ; PUSH string "ACTIVE_OFFER_EXISTS" ; FAILWITH }
                                        { CAR ; CDR ; CDR ; CDR ; CAR } } ;
                                 PUSH string "BAD_DURATION" ;
                                 { DIP 3 { DUP } ; DIG 4 } ;
                                 CAR ;
                                 CDR ;
                                 CAR ;
                                 CAR ;
                                 CDR ;
                                 { DIP 3 { DUP } ; DIG 4 } ;
                                 CAR ;
                                 CAR ;
                                 CDR ;
                                 COMPARE ;
                                 GT ;
                                 PUSH int 1200 ;
                                 { DIP 4 { DUP } ; DIG 5 } ;
                                 CAR ;
                                 CAR ;
                                 CDR ;
                                 COMPARE ;
                                 LT ;
                                 OR ;
                                 IF { FAILWITH } { DROP } ;
                                 PUSH string "ZERO_BID_STEP" ;
                                 PUSH mutez 0 ;
                                 { DIP 3 { DUP } ; DIG 4 } ;
                                 CAR ;
                                 CAR ;
                                 CAR ;
                                 COMPARE ;
                                 EQ ;
                                 IF { FAILWITH } { DROP } ;
                                 PUSH string "BAD_PERCENT" ;
                                 PUSH nat 100 ;
                                 { DIP 3 { DUP } ; DIG 4 } ;
                                 CDR ;
                                 CDR ;
                                 COMPARE ;
                                 GT ;
                                 IF { FAILWITH } { DROP } ;
                                 { DIP 2 { DUP } ; DIG 3 } ;
                                 { DIP 2 { DUP } ; DIG 3 } ;
                                 CAR ;
                                 CDR ;
                                 CDR ;
                                 { DIP 3 { DUP } ; DIG 4 } ;
                                 CAR ;
                                 CDR ;
                                 CAR ;
                                 DIG 2 ;
                                 CDR ;
                                 CAR ;
                                 CDR ;
                                 CAR ;
                                 DUG 2 ;
                                 PAIR ;
                                 GET ;
                                 IF_NONE { PUSH nat 0 ; SELF_ADDRESS ; PUSH nat 0 ; PAIR ; PAIR } {} ;
                                 SENDER ;
                                 SWAP ;
                                 DUP ;
                                 DUG 2 ;
                                 CAR ;
                                 CDR ;
                                 COMPARE ;
                                 EQ ;
                                 DUP ;
                                 IF { DIG 4 }
                                    { { DIP 4 { DUP } ; DIG 5 } ;
                                      CDR ;
                                      CAR ;
                                      CDR ;
                                      CDR ;
                                      SENDER ;
                                      GET ;
                                      IF_NONE
                                        { PUSH nat 0 ; PUSH nat 0 ; PAIR ; PUSH nat 0 ; NOW ; PAIR ; PAIR }
                                        {} ;
                                      PUSH string "ACTIVE_SALES_LIMIT" ;
                                      SWAP ;
                                      DUP ;
                                      DUG 2 ;
                                      CDR ;
                                      CDR ;
                                      { DIP 7 { DUP } ; DIG 8 } ;
                                      CDR ;
                                      CDR ;
                                      CDR ;
                                      CAR ;
                                      MUL ;
                                      { DIP 7 { DUP } ; DIG 8 } ;
                                      CAR ;
                                      CAR ;
                                      CDR ;
                                      CDR ;
                                      CAR ;
                                      ADD ;
                                      { DIP 2 { DUP } ; DIG 3 } ;
                                      CDR ;
                                      CAR ;
                                      COMPARE ;
                                      GE ;
                                      IF { FAILWITH } { DROP } ;
                                      DUP ;
                                      CDR ;
                                      CDR ;
                                      PUSH nat 1 ;
                                      { DIP 2 { DUP } ; DIG 3 } ;
                                      CDR ;
                                      CAR ;
                                      ADD ;
                                      PAIR ;
                                      SWAP ;
                                      CAR ;
                                      PAIR ;
                                      { DIP 5 { DUP } ; DIG 6 } ;
                                      CDR ;
                                      CDR ;
                                      { DIP 6 { DUP } ; DIG 7 } ;
                                      CDR ;
                                      CAR ;
                                      CDR ;
                                      CDR ;
                                      DIG 2 ;
                                      SOME ;
                                      SENDER ;
                                      UPDATE ;
                                      { DIP 6 { DUP } ; DIG 7 } ;
                                      CDR ;
                                      CAR ;
                                      CDR ;
                                      CAR ;
                                      PAIR ;
                                      { DIP 6 { DUP } ; DIG 7 } ;
                                      CDR ;
                                      CAR ;
                                      CAR ;
                                      PAIR ;
                                      PAIR ;
                                      DIG 5 ;
                                      CAR ;
                                      PAIR } ;
                                 { DIP 4 { DUP } ; DIG 5 } ;
                                 CDR ;
                                 CDR ;
                                 SENDER ;
                                 PAIR ;
                                 PUSH nat 1 ;
                                 { DIP 6 { DUP } ; DIG 7 } ;
                                 CAR ;
                                 CDR ;
                                 CDR ;
                                 PAIR ;
                                 PAIR ;
                                 PUSH nat 0 ;
                                 SENDER ;
                                 PAIR ;
                                 DIG 3 ;
                                 { DIP 6 { DUP } ; DIG 7 } ;
                                 CAR ;
                                 CDR ;
                                 CAR ;
                                 PAIR ;
                                 PAIR ;
                                 PAIR ;
                                 DIG 5 ;
                                 PUSH bool False ;
                                 PAIR ;
                                 DIG 3 ;
                                 CAR ;
                                 CAR ;
                                 { DIP 5 { DUP } ; DIG 6 } ;
                                 CAR ;
                                 CAR ;
                                 CDR ;
                                 PAIR ;
                                 PAIR ;
                                 { DIP 4 { DUP } ; DIG 5 } ;
                                 CDR ;
                                 CAR ;
                                 IF { PUSH timestamp 0 }
                                    { { DIP 4 { DUP } ; DIG 5 } ; CAR ; CAR ; CDR ; NOW ; ADD } ;
                                 DIG 5 ;
                                 CAR ;
                                 CAR ;
                                 CAR ;
                                 PAIR ;
                                 PUSH mutez 0 ;
                                 PUSH mutez 0 ;
                                 PAIR ;
                                 PAIR ;
                                 PAIR ;
                                 PAIR ;
                                 DIG 2 ;
                                 { DIP 2 { DUP } ; DIG 3 } ;
                                 CDR ;
                                 { DIP 3 { DUP } ; DIG 4 } ;
                                 CAR ;
                                 CDR ;
                                 CDR ;
                                 CDR ;
                                 CDR ;
                                 PUSH nat 1 ;
                                 { DIP 3 { DUP } ; DIG 4 } ;
                                 ADD ;
                                 PAIR ;
                                 { DIP 4 { DUP } ; DIG 5 } ;
                                 CAR ;
                                 CDR ;
                                 CDR ;
                                 CAR ;
                                 PAIR ;
                                 { DIP 4 { DUP } ; DIG 5 } ;
                                 CAR ;
                                 CDR ;
                                 CAR ;
                                 PAIR ;
                                 DIG 4 ;
                                 CAR ;
                                 CAR ;
                                 PAIR ;
                                 PAIR ;
                                 DUP ;
                                 CDR ;
                                 SWAP ;
                                 DUP ;
                                 DUG 2 ;
                                 CAR ;
                                 CDR ;
                                 CDR ;
                                 { DIP 2 { DUP } ; DIG 3 } ;
                                 CAR ;
                                 CDR ;
                                 CAR ;
                                 CDR ;
                                 { DIP 3 { DUP } ; DIG 4 } ;
                                 CAR ;
                                 CDR ;
                                 CAR ;
                                 CAR ;
                                 CDR ;
                                 { DIP 4 { DUP } ; DIG 5 } ;
                                 CAR ;
                                 CDR ;
                                 CAR ;
                                 CAR ;
                                 CAR ;
                                 { DIP 7 { DUP } ; DIG 8 } ;
                                 { DIP 7 { DUP } ; DIG 8 } ;
                                 SWAP ;
                                 SOME ;
                                 SWAP ;
                                 UPDATE ;
                                 PAIR ;
                                 PAIR ;
                                 PAIR ;
                                 DIG 2 ;
                                 CAR ;
                                 CAR ;
                                 PAIR ;
                                 PAIR ;
                                 DUP ;
                                 CDR ;
                                 SWAP ;
                                 DUP ;
                                 DUG 2 ;
                                 CAR ;
                                 CDR ;
                                 CDR ;
                                 CDR ;
                                 CDR ;
                                 PUSH bool True ;
                                 DIG 4 ;
                                 PAIR ;
                                 { DIP 4 { DUP } ; DIG 5 } ;
                                 CDR ;
                                 CDR ;
                                 CAR ;
                                 CAR ;
                                 { DIP 5 { DUP } ; DIG 6 } ;
                                 CDR ;
                                 CAR ;
                                 CAR ;
                                 CAR ;
                                 PAIR ;
                                 { DIP 5 { DUP } ; DIG 6 } ;
                                 CDR ;
                                 CAR ;
                                 CDR ;
                                 CAR ;
                                 PAIR ;
                                 SWAP ;
                                 SOME ;
                                 SWAP ;
                                 UPDATE ;
                                 { DIP 2 { DUP } ; DIG 3 } ;
                                 CAR ;
                                 CDR ;
                                 CDR ;
                                 CDR ;
                                 CAR ;
                                 PAIR ;
                                 { DIP 2 { DUP } ; DIG 3 } ;
                                 CAR ;
                                 CDR ;
                                 CDR ;
                                 CAR ;
                                 PAIR ;
                                 { DIP 2 { DUP } ; DIG 3 } ;
                                 CAR ;
                                 CDR ;
                                 CAR ;
                                 PAIR ;
                                 DIG 2 ;
                                 CAR ;
                                 CAR ;
                                 PAIR ;
                                 PAIR ;
                                 NIL operation ;
                                 { DIP 2 { DUP } ; DIG 3 } ;
                                 CDR ;
                                 CDR ;
                                 CAR ;
                                 CDR ;
                                 SELF_ADDRESS ;
                                 { DIP 4 { DUP } ; DIG 5 } ;
                                 CDR ;
                                 CAR ;
                                 CDR ;
                                 CAR ;
                                 PAIR ;
                                 { DIP 4 { DUP } ; DIG 5 } ;
                                 CDR ;
                                 CDR ;
                                 CAR ;
                                 CAR ;
                                 DIG 5 ;
                                 CDR ;
                                 CAR ;
                                 CAR ;
                                 CAR ;
                                 DIG 2 ;
                                 { { DUP ; CAR ; DIP { CDR } } } ;
                                 DIG 2 ;
                                 CONTRACT %transfer
                                   (list (pair (address %from_)
                                               (list %txs (pair (address %to_) (pair (nat %token_id) (nat %amount)))))) ;
                                 IF_NONE { PUSH string "NOT_FA2_CONTRACT" ; FAILWITH } {} ;
                                 PUSH mutez 0 ;
                                 NIL (pair address (list (pair address (pair nat nat)))) ;
                                 DIG 3 ;
                                 NIL (pair address (pair nat nat)) ;
                                 DIG 5 ;
                                 DIG 6 ;
                                 DIG 7 ;
                                 SWAP ;
                                 PAIR ;
                                 SWAP ;
                                 PAIR ;
                                 CONS ;
                                 SWAP ;
                                 PAIR ;
                                 CONS ;
                                 TRANSFER_TOKENS ;
                                 CONS ;
                                 PAIR }
                               { DIG 2 ;
                                 DROP ;
                                 SWAP ;
                                 DUP ;
                                 DUG 2 ;
                                 SWAP ;
                                 DUP ;
                                 DUG 2 ;
                                 CDR ;
                                 CAR ;
                                 { DIP 2 { DUP } ; DIG 3 } ;
                                 CAR ;
                                 CDR ;
                                 CDR ;
                                 PAIR ;
                                 PUSH string "TOKEN_BANNED" ;
                                 { DIP 2 { DUP } ; DIG 3 } ;
                                 CAR ;
                                 CAR ;
                                 CAR ;
                                 CAR ;
                                 CDR ;
                                 { DIP 2 { DUP } ; DIG 3 } ;
                                 MEM ;
                                 IF { FAILWITH } { DROP } ;
                                 SWAP ;
                                 DUP ;
                                 DUG 2 ;
                                 CAR ;
                                 CDR ;
                                 CDR ;
                                 CDR ;
                                 CDR ;
                                 SWAP ;
                                 SENDER ;
                                 PAIR ;
                                 GET ;
                                 IF_NONE
                                   { CAR ; CDR ; CDR ; CDR ; CAR }
                                   { CDR ;
                                     IF { DROP ; PUSH string "ACTIVE_OFFER_EXISTS" ; FAILWITH }
                                        { CAR ; CDR ; CDR ; CDR ; CAR } } ;
                                 PUSH string "BAD_DURATION" ;
                                 { DIP 3 { DUP } ; DIG 4 } ;
                                 CAR ;
                                 CDR ;
                                 CAR ;
                                 CDR ;
                                 CAR ;
                                 { DIP 3 { DUP } ; DIG 4 } ;
                                 CAR ;
                                 CDR ;
                                 CAR ;
                                 COMPARE ;
                                 GT ;
                                 DIG 6 ;
                                 { DIP 4 { DUP } ; DIG 5 } ;
                                 CAR ;
                                 CDR ;
                                 CAR ;
                                 COMPARE ;
                                 LT ;
                                 OR ;
                                 IF { FAILWITH } { DROP } ;
                                 PUSH string "ZERO_BID_STEP" ;
                                 PUSH mutez 0 ;
                                 { DIP 3 { DUP } ; DIG 4 } ;
                                 CAR ;
                                 CAR ;
                                 CDR ;
                                 COMPARE ;
                                 EQ ;
                                 IF { FAILWITH } { DROP } ;
                                 { DIP 2 { DUP } ; DIG 3 } ;
                                 { DIP 2 { DUP } ; DIG 3 } ;
                                 CDR ;
                                 CAR ;
                                 { DIP 3 { DUP } ; DIG 4 } ;
                                 CAR ;
                                 CDR ;
                                 CDR ;
                                 DIG 2 ;
                                 CDR ;
                                 CAR ;
                                 CDR ;
                                 CAR ;
                                 DUG 2 ;
                                 PAIR ;
                                 GET ;
                                 IF_NONE { PUSH nat 0 ; SELF_ADDRESS ; PUSH nat 0 ; PAIR ; PAIR } {} ;
                                 SENDER ;
                                 SWAP ;
                                 DUP ;
                                 DUG 2 ;
                                 CAR ;
                                 CDR ;
                                 COMPARE ;
                                 EQ ;
                                 DUP ;
                                 IF { DIG 4 }
                                    { { DIP 4 { DUP } ; DIG 5 } ;
                                      CDR ;
                                      CAR ;
                                      CDR ;
                                      CDR ;
                                      SENDER ;
                                      GET ;
                                      IF_NONE
                                        { PUSH nat 0 ; PUSH nat 0 ; PAIR ; PUSH nat 0 ; NOW ; PAIR ; PAIR }
                                        {} ;
                                      PUSH string "ACTIVE_SALES_LIMIT" ;
                                      SWAP ;
                                      DUP ;
                                      DUG 2 ;
                                      CDR ;
                                      CDR ;
                                      { DIP 7 { DUP } ; DIG 8 } ;
                                      CDR ;
                                      CDR ;
                                      CDR ;
                                      CAR ;
                                      MUL ;
                                      { DIP 7 { DUP } ; DIG 8 } ;
                                      CAR ;
                                      CAR ;
                                      CDR ;
                                      CDR ;
                                      CAR ;
                                      ADD ;
                                      { DIP 2 { DUP } ; DIG 3 } ;
                                      CDR ;
                                      CAR ;
                                      COMPARE ;
                                      GE ;
                                      IF { FAILWITH } { DROP } ;
                                      DUP ;
                                      CDR ;
                                      CDR ;
                                      PUSH nat 1 ;
                                      { DIP 2 { DUP } ; DIG 3 } ;
                                      CDR ;
                                      CAR ;
                                      ADD ;
                                      PAIR ;
                                      SWAP ;
                                      CAR ;
                                      PAIR ;
                                      { DIP 5 { DUP } ; DIG 6 } ;
                                      CDR ;
                                      CDR ;
                                      { DIP 6 { DUP } ; DIG 7 } ;
                                      CDR ;
                                      CAR ;
                                      CDR ;
                                      CDR ;
                                      DIG 2 ;
                                      SOME ;
                                      SENDER ;
                                      UPDATE ;
                                      { DIP 6 { DUP } ; DIG 7 } ;
                                      CDR ;
                                      CAR ;
                                      CDR ;
                                      CAR ;
                                      PAIR ;
                                      { DIP 6 { DUP } ; DIG 7 } ;
                                      CDR ;
                                      CAR ;
                                      CAR ;
                                      PAIR ;
                                      PAIR ;
                                      DIG 5 ;
                                      CAR ;
                                      PAIR } ;
                                 PUSH nat 0 ;
                                 SENDER ;
                                 PAIR ;
                                 PUSH nat 1 ;
                                 { DIP 6 { DUP } ; DIG 7 } ;
                                 CDR ;
                                 CAR ;
                                 PAIR ;
                                 PAIR ;
                                 PUSH nat 0 ;
                                 SENDER ;
                                 PAIR ;
                                 DIG 3 ;
                                 { DIP 6 { DUP } ; DIG 7 } ;
                                 CAR ;
                                 CDR ;
                                 CDR ;
                                 PAIR ;
                                 PAIR ;
                                 PAIR ;
                                 DIG 5 ;
                                 PUSH bool False ;
                                 PAIR ;
                                 DIG 3 ;
                                 CAR ;
                                 CAR ;
                                 { DIP 5 { DUP } ; DIG 6 } ;
                                 CAR ;
                                 CDR ;
                                 CAR ;
                                 PAIR ;
                                 PAIR ;
                                 { DIP 4 { DUP } ; DIG 5 } ;
                                 CDR ;
                                 CDR ;
                                 IF { PUSH timestamp 0 }
                                    { { DIP 4 { DUP } ; DIG 5 } ; CAR ; CDR ; CAR ; NOW ; ADD } ;
                                 { DIP 5 { DUP } ; DIG 6 } ;
                                 CAR ;
                                 CAR ;
                                 CDR ;
                                 PAIR ;
                                 PUSH mutez 0 ;
                                 DIG 6 ;
                                 CAR ;
                                 CAR ;
                                 CAR ;
                                 PAIR ;
                                 PAIR ;
                                 PAIR ;
                                 PAIR ;
                                 DIG 2 ;
                                 { DIP 2 { DUP } ; DIG 3 } ;
                                 CDR ;
                                 { DIP 3 { DUP } ; DIG 4 } ;
                                 CAR ;
                                 CDR ;
                                 CDR ;
                                 CDR ;
                                 CDR ;
                                 PUSH nat 1 ;
                                 { DIP 3 { DUP } ; DIG 4 } ;
                                 ADD ;
                                 PAIR ;
                                 { DIP 4 { DUP } ; DIG 5 } ;
                                 CAR ;
                                 CDR ;
                                 CDR ;
                                 CAR ;
                                 PAIR ;
                                 { DIP 4 { DUP } ; DIG 5 } ;
                                 CAR ;
                                 CDR ;
                                 CAR ;
                                 PAIR ;
                                 DIG 4 ;
                                 CAR ;
                                 CAR ;
                                 PAIR ;
                                 PAIR ;
                                 DUP ;
                                 CDR ;
                                 SWAP ;
                                 DUP ;
                                 DUG 2 ;
                                 CAR ;
                                 CDR ;
                                 CDR ;
                                 { DIP 2 { DUP } ; DIG 3 } ;
                                 CAR ;
                                 CDR ;
                                 CAR ;
                                 CDR ;
                                 { DIP 3 { DUP } ; DIG 4 } ;
                                 CAR ;
                                 CDR ;
                                 CAR ;
                                 CAR ;
                                 CDR ;
                                 { DIP 4 { DUP } ; DIG 5 } ;
                                 CAR ;
                                 CDR ;
                                 CAR ;
                                 CAR ;
                                 CAR ;
                                 { DIP 7 { DUP } ; DIG 8 } ;
                                 { DIP 7 { DUP } ; DIG 8 } ;
                                 SWAP ;
                                 SOME ;
                                 SWAP ;
                                 UPDATE ;
                                 PAIR ;
                                 PAIR ;
                                 PAIR ;
                                 DIG 2 ;
                                 CAR ;
                                 CAR ;
                                 PAIR ;
                                 PAIR ;
                                 DUP ;
                                 CDR ;
                                 SWAP ;
                                 DUP ;
                                 DUG 2 ;
                                 CAR ;
                                 CDR ;
                                 CDR ;
                                 CDR ;
                                 CDR ;
                                 PUSH bool True ;
                                 DIG 4 ;
                                 PAIR ;
                                 { DIP 4 { DUP } ; DIG 5 } ;
                                 CDR ;
                                 CDR ;
                                 CAR ;
                                 CAR ;
                                 { DIP 5 { DUP } ; DIG 6 } ;
                                 CDR ;
                                 CAR ;
                                 CAR ;
                                 CAR ;
                                 PAIR ;
                                 { DIP 5 { DUP } ; DIG 6 } ;
                                 CDR ;
                                 CAR ;
                                 CDR ;
                                 CAR ;
                                 PAIR ;
                                 SWAP ;
                                 SOME ;
                                 SWAP ;
                                 UPDATE ;
                                 { DIP 2 { DUP } ; DIG 3 } ;
                                 CAR ;
                                 CDR ;
                                 CDR ;
                                 CDR ;
                                 CAR ;
                                 PAIR ;
                                 { DIP 2 { DUP } ; DIG 3 } ;
                                 CAR ;
                                 CDR ;
                                 CDR ;
                                 CAR ;
                                 PAIR ;
                                 { DIP 2 { DUP } ; DIG 3 } ;
                                 CAR ;
                                 CDR ;
                                 CAR ;
                                 PAIR ;
                                 DIG 2 ;
                                 CAR ;
                                 CAR ;
                                 PAIR ;
                                 PAIR ;
                                 NIL operation ;
                                 { DIP 2 { DUP } ; DIG 3 } ;
                                 CDR ;
                                 CDR ;
                                 CAR ;
                                 CDR ;
                                 SELF_ADDRESS ;
                                 { DIP 4 { DUP } ; DIG 5 } ;
                                 CDR ;
                                 CAR ;
                                 CDR ;
                                 CAR ;
                                 PAIR ;
                                 { DIP 4 { DUP } ; DIG 5 } ;
                                 CDR ;
                                 CDR ;
                                 CAR ;
                                 CAR ;
                                 DIG 5 ;
                                 CDR ;
                                 CAR ;
                                 CAR ;
                                 CAR ;
                                 DIG 2 ;
                                 { { DUP ; CAR ; DIP { CDR } } } ;
                                 DIG 2 ;
                                 CONTRACT %transfer
                                   (list (pair (address %from_)
                                               (list %txs (pair (address %to_) (pair (nat %token_id) (nat %amount)))))) ;
                                 IF_NONE { PUSH string "NOT_FA2_CONTRACT" ; FAILWITH } {} ;
                                 PUSH mutez 0 ;
                                 NIL (pair address (list (pair address (pair nat nat)))) ;
                                 DIG 3 ;
                                 NIL (pair address (pair nat nat)) ;
                                 DIG 5 ;
                                 DIG 6 ;
                                 DIG 7 ;
                                 SWAP ;
                                 PAIR ;
                                 SWAP ;
                                 PAIR ;
                                 CONS ;
                                 SWAP ;
                                 PAIR ;
                                 CONS ;
                                 TRANSFER_TOKENS ;
                                 CONS ;
                                 PAIR } }
                           { DIG 2 ;
                             DIG 3 ;
                             DIG 5 ;
                             DROP 3 ;
                             SWAP ;
                             DUP ;
                             DUG 2 ;
                             SWAP ;
                             DUP ;
                             DUG 2 ;
                             CDR ;
                             CAR ;
                             { DIP 2 { DUP } ; DIG 3 } ;
                             CAR ;
                             CDR ;
                             PAIR ;
                             PUSH string "TOKEN_BANNED" ;
                             { DIP 2 { DUP } ; DIG 3 } ;
                             CAR ;
                             CAR ;
                             CAR ;
                             CAR ;
                             CDR ;
                             { DIP 2 { DUP } ; DIG 3 } ;
                             MEM ;
                             IF { FAILWITH } { DROP } ;
                             SWAP ;
                             DUP ;
                             DUG 2 ;
                             CAR ;
                             CDR ;
                             CDR ;
                             CDR ;
                             CDR ;
                             SWAP ;
                             SENDER ;
                             PAIR ;
                             GET ;
                             IF_NONE
                               { CAR ; CDR ; CDR ; CDR ; CAR }
                               { CDR ;
                                 IF { DROP ; PUSH string "ACTIVE_OFFER_EXISTS" ; FAILWITH }
                                    { CAR ; CDR ; CDR ; CDR ; CAR } } ;
                             PUSH string "ZERO_VOLUME" ;
                             PUSH nat 0 ;
                             { DIP 3 { DUP } ; DIG 4 } ;
                             CDR ;
                             CDR ;
                             COMPARE ;
                             EQ ;
                             IF { FAILWITH } { DROP } ;
                             { DIP 2 { DUP } ; DIG 3 } ;
                             { DIP 2 { DUP } ; DIG 3 } ;
                             CDR ;
                             CAR ;
                             { DIP 3 { DUP } ; DIG 4 } ;
                             CAR ;
                             CDR ;
                             DIG 2 ;
                             CDR ;
                             CAR ;
                             CDR ;
                             CAR ;
                             DUG 2 ;
                             PAIR ;
                             GET ;
                             IF_NONE { PUSH nat 0 ; SELF_ADDRESS ; PUSH nat 0 ; PAIR ; PAIR } {} ;
                             SENDER ;
                             SWAP ;
                             DUP ;
                             DUG 2 ;
                             CAR ;
                             CDR ;
                             COMPARE ;
                             EQ ;
                             DUP ;
                             IF { DIG 4 }
                                { { DIP 4 { DUP } ; DIG 5 } ;
                                  CDR ;
                                  CAR ;
                                  CDR ;
                                  CDR ;
                                  SENDER ;
                                  GET ;
                                  IF_NONE
                                    { PUSH nat 0 ; PUSH nat 0 ; PAIR ; PUSH nat 0 ; NOW ; PAIR ; PAIR }
                                    {} ;
                                  PUSH string "ACTIVE_SALES_LIMIT" ;
                                  SWAP ;
                                  DUP ;
                                  DUG 2 ;
                                  CDR ;
                                  CDR ;
                                  { DIP 7 { DUP } ; DIG 8 } ;
                                  CDR ;
                                  CDR ;
                                  CDR ;
                                  CAR ;
                                  MUL ;
                                  { DIP 7 { DUP } ; DIG 8 } ;
                                  CAR ;
                                  CAR ;
                                  CDR ;
                                  CDR ;
                                  CAR ;
                                  ADD ;
                                  { DIP 2 { DUP } ; DIG 3 } ;
                                  CDR ;
                                  CAR ;
                                  COMPARE ;
                                  GE ;
                                  IF { FAILWITH } { DROP } ;
                                  DUP ;
                                  CDR ;
                                  CDR ;
                                  PUSH nat 1 ;
                                  { DIP 2 { DUP } ; DIG 3 } ;
                                  CDR ;
                                  CAR ;
                                  ADD ;
                                  PAIR ;
                                  SWAP ;
                                  CAR ;
                                  PAIR ;
                                  { DIP 5 { DUP } ; DIG 6 } ;
                                  CDR ;
                                  CDR ;
                                  { DIP 6 { DUP } ; DIG 7 } ;
                                  CDR ;
                                  CAR ;
                                  CDR ;
                                  CDR ;
                                  DIG 2 ;
                                  SOME ;
                                  SENDER ;
                                  UPDATE ;
                                  { DIP 6 { DUP } ; DIG 7 } ;
                                  CDR ;
                                  CAR ;
                                  CDR ;
                                  CAR ;
                                  PAIR ;
                                  { DIP 6 { DUP } ; DIG 7 } ;
                                  CDR ;
                                  CAR ;
                                  CAR ;
                                  PAIR ;
                                  PAIR ;
                                  DIG 5 ;
                                  CAR ;
                                  PAIR } ;
                             PUSH nat 0 ;
                             SENDER ;
                             PAIR ;
                             { DIP 5 { DUP } ; DIG 6 } ;
                             CDR ;
                             CDR ;
                             { DIP 6 { DUP } ; DIG 7 } ;
                             CDR ;
                             CAR ;
                             PAIR ;
                             PAIR ;
                             PUSH nat 0 ;
                             SENDER ;
                             PAIR ;
                             DIG 3 ;
                             { DIP 6 { DUP } ; DIG 7 } ;
                             CAR ;
                             CDR ;
                             PAIR ;
                             PAIR ;
                             PAIR ;
                             DIG 5 ;
                             PUSH bool False ;
                             PAIR ;
                             DIG 3 ;
                             CAR ;
                             CAR ;
                             PUSH int 0 ;
                             PAIR ;
                             PAIR ;
                             PUSH timestamp 0 ;
                             PUSH mutez 0 ;
                             PAIR ;
                             PUSH mutez 0 ;
                             DIG 6 ;
                             CAR ;
                             CAR ;
                             PAIR ;
                             PAIR ;
                             PAIR ;
                             PAIR ;
                             DIG 2 ;
                             { DIP 2 { DUP } ; DIG 3 } ;
                             CDR ;
                             { DIP 3 { DUP } ; DIG 4 } ;
                             CAR ;
                             CDR ;
                             CDR ;
                             CDR ;
                             CDR ;
                             PUSH nat 1 ;
                             { DIP 3 { DUP } ; DIG 4 } ;
                             ADD ;
                             PAIR ;
                             { DIP 4 { DUP } ; DIG 5 } ;
                             CAR ;
                             CDR ;
                             CDR ;
                             CAR ;
                             PAIR ;
                             { DIP 4 { DUP } ; DIG 5 } ;
                             CAR ;
                             CDR ;
                             CAR ;
                             PAIR ;
                             DIG 4 ;
                             CAR ;
                             CAR ;
                             PAIR ;
                             PAIR ;
                             DUP ;
                             CDR ;
                             SWAP ;
                             DUP ;
                             DUG 2 ;
                             CAR ;
                             CDR ;
                             CDR ;
                             { DIP 2 { DUP } ; DIG 3 } ;
                             CAR ;
                             CDR ;
                             CAR ;
                             CDR ;
                             { DIP 3 { DUP } ; DIG 4 } ;
                             CAR ;
                             CDR ;
                             CAR ;
                             CAR ;
                             CDR ;
                             { DIP 4 { DUP } ; DIG 5 } ;
                             CAR ;
                             CDR ;
                             CAR ;
                             CAR ;
                             CAR ;
                             { DIP 7 { DUP } ; DIG 8 } ;
                             { DIP 7 { DUP } ; DIG 8 } ;
                             SWAP ;
                             SOME ;
                             SWAP ;
                             UPDATE ;
                             PAIR ;
                             PAIR ;
                             PAIR ;
                             DIG 2 ;
                             CAR ;
                             CAR ;
                             PAIR ;
                             PAIR ;
                             DUP ;
                             CDR ;
                             SWAP ;
                             DUP ;
                             DUG 2 ;
                             CAR ;
                             CDR ;
                             CDR ;
                             CDR ;
                             CDR ;
                             PUSH bool True ;
                             DIG 4 ;
                             PAIR ;
                             { DIP 4 { DUP } ; DIG 5 } ;
                             CDR ;
                             CDR ;
                             CAR ;
                             CAR ;
                             { DIP 5 { DUP } ; DIG 6 } ;
                             CDR ;
                             CAR ;
                             CAR ;
                             CAR ;
                             PAIR ;
                             { DIP 5 { DUP } ; DIG 6 } ;
                             CDR ;
                             CAR ;
                             CDR ;
                             CAR ;
                             PAIR ;
                             SWAP ;
                             SOME ;
                             SWAP ;
                             UPDATE ;
                             { DIP 2 { DUP } ; DIG 3 } ;
                             CAR ;
                             CDR ;
                             CDR ;
                             CDR ;
                             CAR ;
                             PAIR ;
                             { DIP 2 { DUP } ; DIG 3 } ;
                             CAR ;
                             CDR ;
                             CDR ;
                             CAR ;
                             PAIR ;
                             { DIP 2 { DUP } ; DIG 3 } ;
                             CAR ;
                             CDR ;
                             CAR ;
                             PAIR ;
                             DIG 2 ;
                             CAR ;
                             CAR ;
                             PAIR ;
                             PAIR ;
                             NIL operation ;
                             { DIP 2 { DUP } ; DIG 3 } ;
                             CDR ;
                             CDR ;
                             CAR ;
                             CDR ;
                             SELF_ADDRESS ;
                             { DIP 4 { DUP } ; DIG 5 } ;
                             CDR ;
                             CAR ;
                             CDR ;
                             CAR ;
                             PAIR ;
                             { DIP 4 { DUP } ; DIG 5 } ;
                             CDR ;
                             CDR ;
                             CAR ;
                             CAR ;
                             DIG 5 ;
                             CDR ;
                             CAR ;
                             CAR ;
                             CAR ;
                             DIG 2 ;
                             { { DUP ; CAR ; DIP { CDR } } } ;
                             DIG 2 ;
                             CONTRACT %transfer
                               (list (pair (address %from_)
                                           (list %txs (pair (address %to_) (pair (nat %token_id) (nat %amount)))))) ;
                             IF_NONE { PUSH string "NOT_FA2_CONTRACT" ; FAILWITH } {} ;
                             PUSH mutez 0 ;
                             NIL (pair address (list (pair address (pair nat nat)))) ;
                             DIG 3 ;
                             NIL (pair address (pair nat nat)) ;
                             DIG 5 ;
                             DIG 6 ;
                             DIG 7 ;
                             SWAP ;
                             PAIR ;
                             SWAP ;
                             PAIR ;
                             CONS ;
                             SWAP ;
                             PAIR ;
                             CONS ;
                             TRANSFER_TOKENS ;
                             CONS ;
                             PAIR } }
                       { DIG 3 ;
                         DIG 4 ;
                         DIG 5 ;
                         DIG 7 ;
                         DROP 4 ;
                         PUSH bool True ;
                         { DIP 2 { DUP } ; DIG 3 } ;
                         CDR ;
                         CAR ;
                         CAR ;
                         CAR ;
                         COMPARE ;
                         EQ ;
                         IF { PUSH string "PAUSED" ; FAILWITH } {} ;
                         PUSH mutez 0 ;
                         AMOUNT ;
                         COMPARE ;
                         GT ;
                         IF { PUSH string "NO_TEZ_ALLOWED" ; FAILWITH } {} ;
                         PUSH string "SIGN" ;
                         PUSH bool False ;
                         { DIP 2 { DUP } ; DIG 3 } ;
                         CAR ;
                         { DIP 3 { DUP } ; DIG 4 } ;
                         CDR ;
                         { DIP 5 { DUP } ; DIG 6 } ;
                         CAR ;
                         CAR ;
                         CDR ;
                         CDR ;
                         CDR ;
                         CHECK_SIGNATURE ;
                         COMPARE ;
                         EQ ;
                         IF { FAILWITH } { DROP } ;
                         CAR ;
                         UNPACK
                           (pair (pair (address %issuer) (address %kt)) (list %rlist (pair nat (pair nat nat)))) ;
                         IF_NONE { PUSH string "BAD_BYTES" ; FAILWITH } {} ;
                         DUP ;
                         CDR ;
                         MAP { SWAP ;
                               DUP ;
                               DUG 2 ;
                               CAR ;
                               CAR ;
                               { DIP 2 { DUP } ; DIG 3 } ;
                               CAR ;
                               CDR ;
                               { DIP 2 { DUP } ; DIG 3 } ;
                               CAR ;
                               { DIP 3 { DUP } ; DIG 4 } ;
                               CDR ;
                               CAR ;
                               DIG 4 ;
                               CDR ;
                               CDR ;
                               SWAP ;
                               PAIR ;
                               SWAP ;
                               PAIR ;
                               SWAP ;
                               PAIR ;
                               SWAP ;
                               PAIR } ;
                         SWAP ;
                         DROP ;
                         ITER { SWAP ;
                                PUSH string "ZERO_VOLUME" ;
                                PUSH nat 0 ;
                                { DIP 3 { DUP } ; DIG 4 } ;
                                GET 8 ;
                                COMPARE ;
                                EQ ;
                                IF { FAILWITH } { DROP } ;
                                PUSH string "BAD_ROYALTIES" ;
                                { DIP 4 { DUP } ; DIG 5 } ;
                                { DIP 3 { DUP } ; DIG 4 } ;
                                GET 7 ;
                                COMPARE ;
                                GT ;
                                IF { FAILWITH } { DROP } ;
                                DUP ;
                                CDR ;
                                CDR ;
                                SWAP ;
                                DUP ;
                                DUG 2 ;
                                CDR ;
                                CAR ;
                                CDR ;
                                CDR ;
                                { DIP 2 { DUP } ; DIG 3 } ;
                                CDR ;
                                CAR ;
                                CDR ;
                                CAR ;
                                { DIP 4 { DUP } ; DIG 5 } ;
                                GET 7 ;
                                { DIP 5 { DUP } ; DIG 6 } ;
                                CAR ;
                                { DIP 6 { DUP } ; DIG 7 } ;
                                GET 8 ;
                                PAIR ;
                                PAIR ;
                                { DIP 5 { DUP } ; DIG 6 } ;
                                GET 5 ;
                                DIG 6 ;
                                GET 3 ;
                                PAIR ;
                                SWAP ;
                                SOME ;
                                SWAP ;
                                UPDATE ;
                                PAIR ;
                                { DIP 2 { DUP } ; DIG 3 } ;
                                CDR ;
                                CAR ;
                                CAR ;
                                PAIR ;
                                PAIR ;
                                SWAP ;
                                CAR ;
                                PAIR } ;
                         DIG 2 ;
                         DROP ;
                         SWAP ;
                         PAIR } }
                   { DIG 3 ;
                     DIG 4 ;
                     DIG 5 ;
                     DIG 7 ;
                     DROP 4 ;
                     IF_LEFT
                       { DIG 2 ;
                         DROP ;
                         PUSH bool True ;
                         { DIP 2 { DUP } ; DIG 3 } ;
                         CDR ;
                         CAR ;
                         CAR ;
                         CAR ;
                         COMPARE ;
                         EQ ;
                         IF { PUSH string "PAUSED" ; FAILWITH } {} ;
                         PUSH mutez 0 ;
                         AMOUNT ;
                         COMPARE ;
                         GT ;
                         IF { PUSH string "NO_TEZ_ALLOWED" ; FAILWITH } {} ;
                         SWAP ;
                         DUP ;
                         DUG 2 ;
                         CDR ;
                         CAR ;
                         CDR ;
                         CDR ;
                         SENDER ;
                         GET ;
                         IF_NONE
                           { PUSH nat 0 ; PUSH nat 0 ; PAIR ; PUSH nat 0 ; NOW ; PAIR ; PAIR }
                           {} ;
                         { DIP 2 { DUP } ; DIG 3 } ;
                         CDR ;
                         CDR ;
                         CAR ;
                         CDR ;
                         SWAP ;
                         DUP ;
                         DUG 2 ;
                         CDR ;
                         CDR ;
                         MUL ;
                         { DIP 3 { DUP } ; DIG 4 } ;
                         CAR ;
                         CAR ;
                         CDR ;
                         CAR ;
                         CDR ;
                         ADD ;
                         PUSH string "NOT_ALLOWED" ;
                         PUSH nat 0 ;
                         { DIP 2 { DUP } ; DIG 3 } ;
                         COMPARE ;
                         EQ ;
                         IF { FAILWITH } { DROP } ;
                         PUSH string "ZERO_VOLUME" ;
                         PUSH nat 0 ;
                         { DIP 4 { DUP } ; DIG 5 } ;
                         GET 3 ;
                         COMPARE ;
                         EQ ;
                         IF { FAILWITH } { DROP } ;
                         PUSH string "BAD_ROYALTIES" ;
                         DIG 5 ;
                         { DIP 4 { DUP } ; DIG 5 } ;
                         GET 4 ;
                         COMPARE ;
                         GT ;
                         IF { FAILWITH } { DROP } ;
                         NOW ;
                         PUSH int 86400 ;
                         { DIP 3 { DUP } ; DIG 4 } ;
                         CAR ;
                         CAR ;
                         ADD ;
                         COMPARE ;
                         GT ;
                         IF { PUSH string "DAY_LIMIT_REACHED" ;
                              SWAP ;
                              { DIP 2 { DUP } ; DIG 3 } ;
                              CAR ;
                              CDR ;
                              COMPARE ;
                              GE ;
                              IF { FAILWITH } { DROP } }
                            { DROP ;
                              DUP ;
                              CDR ;
                              PUSH nat 0 ;
                              DIG 2 ;
                              CAR ;
                              CAR ;
                              PAIR ;
                              CDR ;
                              NOW ;
                              PAIR ;
                              PAIR } ;
                         DUP ;
                         CDR ;
                         PUSH nat 1 ;
                         { DIP 2 { DUP } ; DIG 3 } ;
                         CAR ;
                         CDR ;
                         ADD ;
                         DIG 2 ;
                         CAR ;
                         CAR ;
                         PAIR ;
                         PAIR ;
                         { DIP 2 { DUP } ; DIG 3 } ;
                         CDR ;
                         CDR ;
                         { DIP 3 { DUP } ; DIG 4 } ;
                         CDR ;
                         CAR ;
                         CDR ;
                         CDR ;
                         DIG 2 ;
                         SOME ;
                         SENDER ;
                         UPDATE ;
                         { DIP 3 { DUP } ; DIG 4 } ;
                         CDR ;
                         CAR ;
                         CDR ;
                         CAR ;
                         PAIR ;
                         { DIP 3 { DUP } ; DIG 4 } ;
                         CDR ;
                         CAR ;
                         CAR ;
                         PAIR ;
                         PAIR ;
                         DIG 2 ;
                         CAR ;
                         PAIR ;
                         DUP ;
                         CAR ;
                         CDR ;
                         CDR ;
                         CAR ;
                         CDR ;
                         CONTRACT %mint
                           (pair (nat %token_id) (pair (nat %volume) (pair (address %issuer) (bytes %metadata)))) ;
                         IF_NONE { PUSH string "NO_CONTRACT" ; FAILWITH } {} ;
                         PUSH nat 1 ;
                         { DIP 2 { DUP } ; DIG 3 } ;
                         CAR ;
                         CDR ;
                         CDR ;
                         CAR ;
                         CAR ;
                         ADD ;
                         { DIP 2 { DUP } ; DIG 3 } ;
                         CDR ;
                         CDR ;
                         { DIP 3 { DUP } ; DIG 4 } ;
                         CDR ;
                         CAR ;
                         CDR ;
                         CDR ;
                         { DIP 4 { DUP } ; DIG 5 } ;
                         CDR ;
                         CAR ;
                         CDR ;
                         CAR ;
                         { DIP 6 { DUP } ; DIG 7 } ;
                         GET 4 ;
                         SENDER ;
                         { DIP 8 { DUP } ; DIG 9 } ;
                         GET 3 ;
                         PAIR ;
                         PAIR ;
                         { DIP 4 { DUP } ; DIG 5 } ;
                         { DIP 7 { DUP } ; DIG 8 } ;
                         CAR ;
                         CDR ;
                         CDR ;
                         CAR ;
                         CDR ;
                         PAIR ;
                         SWAP ;
                         SOME ;
                         SWAP ;
                         UPDATE ;
                         PAIR ;
                         { DIP 4 { DUP } ; DIG 5 } ;
                         CDR ;
                         CAR ;
                         CAR ;
                         PAIR ;
                         PAIR ;
                         DIG 3 ;
                         CAR ;
                         PAIR ;
                         NIL operation ;
                         DIG 3 ;
                         PUSH mutez 0 ;
                         { DIP 4 { DUP } ; DIG 5 } ;
                         { DIP 6 { DUP } ; DIG 7 } ;
                         GET 3 ;
                         SENDER ;
                         DIG 8 ;
                         CAR ;
                         SWAP ;
                         PAIR ;
                         SWAP ;
                         PAIR ;
                         SWAP ;
                         PAIR ;
                         TRANSFER_TOKENS ;
                         CONS ;
                         SWAP ;
                         DUP ;
                         DUG 2 ;
                         CDR ;
                         { DIP 2 { DUP } ; DIG 3 } ;
                         CAR ;
                         CDR ;
                         CDR ;
                         CDR ;
                         { DIP 3 { DUP } ; DIG 4 } ;
                         CAR ;
                         CDR ;
                         CDR ;
                         CAR ;
                         CDR ;
                         DIG 5 ;
                         PAIR ;
                         PAIR ;
                         { DIP 3 { DUP } ; DIG 4 } ;
                         CAR ;
                         CDR ;
                         CAR ;
                         PAIR ;
                         DIG 3 ;
                         CAR ;
                         CAR ;
                         PAIR ;
                         PAIR ;
                         SWAP ;
                         PAIR }
                       { DIG 3 ;
                         DROP ;
                         SWAP ;
                         DUP ;
                         DUG 2 ;
                         CAR ;
                         CAR ;
                         CAR ;
                         CAR ;
                         CAR ;
                         SENDER ;
                         COMPARE ;
                         NEQ ;
                         IF { PUSH string "NOT_ADMIN" ; FAILWITH } {} ;
                         PUSH mutez 0 ;
                         AMOUNT ;
                         COMPARE ;
                         GT ;
                         IF { PUSH string "NO_TEZ_ALLOWED" ; FAILWITH } {} ;
                         SWAP ;
                         DUP ;
                         DUG 2 ;
                         CDR ;
                         CDR ;
                         { DIP 2 { DUP } ; DIG 3 } ;
                         CDR ;
                         CAR ;
                         CDR ;
                         { DIP 3 { DUP } ; DIG 4 } ;
                         CDR ;
                         CAR ;
                         CAR ;
                         CDR ;
                         DIG 3 ;
                         PAIR ;
                         PAIR ;
                         PAIR ;
                         SWAP ;
                         CAR ;
                         PAIR ;
                         SWAP ;
                         PAIR } } } }
           { DIG 3 ;
             DIG 4 ;
             DIG 7 ;
             DROP 3 ;
             IF_LEFT
               { IF_LEFT
                   { IF_LEFT
                       { DIG 3 ;
                         DROP ;
                         PUSH mutez 0 ;
                         AMOUNT ;
                         COMPARE ;
                         GT ;
                         IF { PUSH string "NO_TEZ_ALLOWED" ; FAILWITH } {} ;
                         SWAP ;
                         DUP ;
                         DUG 2 ;
                         CAR ;
                         CAR ;
                         CAR ;
                         CAR ;
                         CAR ;
                         SENDER ;
                         COMPARE ;
                         NEQ ;
                         IF { PUSH string "NOT_ADMIN" ; FAILWITH } {} ;
                         ITER { SWAP ;
                                PUSH string "ZERO_VOLUME" ;
                                PUSH nat 0 ;
                                { DIP 3 { DUP } ; DIG 4 } ;
                                GET 8 ;
                                COMPARE ;
                                EQ ;
                                IF { FAILWITH } { DROP } ;
                                PUSH string "BAD_ROYALTIES" ;
                                { DIP 4 { DUP } ; DIG 5 } ;
                                { DIP 3 { DUP } ; DIG 4 } ;
                                GET 7 ;
                                COMPARE ;
                                GT ;
                                IF { FAILWITH } { DROP } ;
                                DUP ;
                                CDR ;
                                CDR ;
                                SWAP ;
                                DUP ;
                                DUG 2 ;
                                CDR ;
                                CAR ;
                                CDR ;
                                CDR ;
                                { DIP 2 { DUP } ; DIG 3 } ;
                                CDR ;
                                CAR ;
                                CDR ;
                                CAR ;
                                { DIP 4 { DUP } ; DIG 5 } ;
                                GET 7 ;
                                { DIP 5 { DUP } ; DIG 6 } ;
                                CAR ;
                                { DIP 6 { DUP } ; DIG 7 } ;
                                GET 8 ;
                                PAIR ;
                                PAIR ;
                                { DIP 5 { DUP } ; DIG 6 } ;
                                GET 5 ;
                                DIG 6 ;
                                GET 3 ;
                                PAIR ;
                                SWAP ;
                                SOME ;
                                SWAP ;
                                UPDATE ;
                                PAIR ;
                                { DIP 2 { DUP } ; DIG 3 } ;
                                CDR ;
                                CAR ;
                                CAR ;
                                PAIR ;
                                PAIR ;
                                SWAP ;
                                CAR ;
                                PAIR } ;
                         DIG 2 ;
                         DROP ;
                         SWAP ;
                         PAIR }
                       { DIG 4 ;
                         DROP ;
                         PUSH bool True ;
                         { DIP 2 { DUP } ; DIG 3 } ;
                         CDR ;
                         CAR ;
                         CAR ;
                         CAR ;
                         COMPARE ;
                         EQ ;
                         IF { PUSH string "PAUSED" ; FAILWITH } {} ;
                         PUSH mutez 0 ;
                         AMOUNT ;
                         COMPARE ;
                         GT ;
                         IF { PUSH string "NO_TEZ_ALLOWED" ; FAILWITH } {} ;
                         SWAP ;
                         DUP ;
                         DUG 2 ;
                         CAR ;
                         CDR ;
                         CAR ;
                         CAR ;
                         CAR ;
                         SWAP ;
                         DUP ;
                         DUG 2 ;
                         GET ;
                         IF_NONE { PUSH string "NOT_FOUND" ; FAILWITH } {} ;
                         PUSH string "ENDED_ALREADY" ;
                         SWAP ;
                         DUP ;
                         DUG 2 ;
                         CAR ;
                         CDR ;
                         CDR ;
                         CAR ;
                         IF { FAILWITH } { DROP } ;
                         { DIP 2 { DUP } ; DIG 3 } ;
                         CDR ;
                         CAR ;
                         CDR ;
                         CDR ;
                         SWAP ;
                         DUP ;
                         DUG 2 ;
                         CDR ;
                         CAR ;
                         CDR ;
                         CAR ;
                         GET ;
                         IF_NONE
                           { PUSH nat 0 ; PUSH nat 0 ; PAIR ; PUSH nat 0 ; NOW ; PAIR ; PAIR }
                           {} ;
                         SWAP ;
                         DUP ;
                         DUG 2 ;
                         CDR ;
                         CDR ;
                         CDR ;
                         CAR ;
                         { DIP 2 { DUP } ; DIG 3 } ;
                         CDR ;
                         CAR ;
                         CDR ;
                         CAR ;
                         COMPARE ;
                         NEQ ;
                         DIG 6 ;
                         { DIP 3 { DUP } ; DIG 4 } ;
                         CAR ;
                         CDR ;
                         CDR ;
                         CDR ;
                         COMPARE ;
                         NEQ ;
                         AND ;
                         IF { PUSH string "AUCTION_NOT_ENDED" ;
                              PUSH timestamp 0 ;
                              { DIP 3 { DUP } ; DIG 4 } ;
                              CAR ;
                              CAR ;
                              CDR ;
                              CDR ;
                              COMPARE ;
                              EQ ;
                              NOW ;
                              { DIP 4 { DUP } ; DIG 5 } ;
                              CAR ;
                              CAR ;
                              CDR ;
                              CDR ;
                              COMPARE ;
                              GE ;
                              OR ;
                              IF { FAILWITH } { DROP } ;
                              { DIP 3 { DUP } ; DIG 4 } ;
                              { DIP 2 { DUP } ; DIG 3 } ;
                              CDR ;
                              CDR ;
                              CAR ;
                              CAR ;
                              { DIP 3 { DUP } ; DIG 4 } ;
                              CDR ;
                              CAR ;
                              CAR ;
                              CAR ;
                              DIG 2 ;
                              CDR ;
                              CAR ;
                              CDR ;
                              CAR ;
                              DUG 2 ;
                              PAIR ;
                              GET ;
                              IF_NONE { PUSH nat 0 ; SELF_ADDRESS ; PUSH nat 0 ; PAIR ; PAIR } {} ;
                              { DIP 2 { DUP } ; DIG 3 } ;
                              CAR ;
                              CAR ;
                              CAR ;
                              CDR ;
                              { DIP 5 { DUP } ; DIG 6 } ;
                              CAR ;
                              CAR ;
                              CDR ;
                              CAR ;
                              CAR ;
                              { DIP 3 { DUP } ; DIG 4 } ;
                              CDR ;
                              CDR ;
                              SWAP ;
                              PUSH nat 1000 ;
                              DIG 3 ;
                              EDIV ;
                              IF_NONE { PUSH string "DIV by 0" ; FAILWITH } {} ;
                              CAR ;
                              MUL ;
                              PUSH nat 4 ;
                              { DIP 2 { DUP } ; DIG 3 } ;
                              COMPARE ;
                              GE ;
                              IF { SWAP ;
                                   DROP ;
                                   PUSH nat 2 ;
                                   SWAP ;
                                   EDIV ;
                                   IF_NONE { PUSH string "DIV by 0" ; FAILWITH } {} ;
                                   CAR }
                                 { SWAP ;
                                   PUSH nat 8 ;
                                   { DIP 2 { DUP } ; DIG 3 } ;
                                   EDIV ;
                                   IF_NONE { PUSH string "DIV by 0" ; FAILWITH } {} ;
                                   CAR ;
                                   MUL ;
                                   SWAP ;
                                   SUB } ;
                              { DIP 3 { DUP } ; DIG 4 } ;
                              CDR ;
                              CAR ;
                              CAR ;
                              CDR ;
                              IF { PUSH mutez 0 }
                                 { SWAP ;
                                   DUP ;
                                   DUG 2 ;
                                   CDR ;
                                   PUSH nat 100 ;
                                   { DIP 2 { DUP } ; DIG 3 } ;
                                   { DIP 6 { DUP } ; DIG 7 } ;
                                   CAR ;
                                   CAR ;
                                   CAR ;
                                   CDR ;
                                   SUB ;
                                   EDIV ;
                                   IF_NONE { PUSH string "DIV by 0" ; FAILWITH } {} ;
                                   CAR ;
                                   MUL } ;
                              DUP ;
                              { DIP 2 { DUP } ; DIG 3 } ;
                              { DIP 6 { DUP } ; DIG 7 } ;
                              CAR ;
                              CAR ;
                              CAR ;
                              CDR ;
                              SUB ;
                              SUB ;
                              { DIP 5 { DUP } ; DIG 6 } ;
                              CDR ;
                              CDR ;
                              CDR ;
                              CDR ;
                              PUSH nat 100 ;
                              { DIP 2 { DUP } ; DIG 3 } ;
                              EDIV ;
                              IF_NONE { PUSH string "DIV by 0" ; FAILWITH } {} ;
                              CAR ;
                              MUL ;
                              { DIP 6 { DUP } ; DIG 7 } ;
                              CDR ;
                              CDR ;
                              { DIP 7 { DUP } ; DIG 8 } ;
                              CDR ;
                              CDR ;
                              CAR ;
                              CDR ;
                              { DIP 8 { DUP } ; DIG 9 } ;
                              CDR ;
                              CAR ;
                              CDR ;
                              CAR ;
                              PAIR ;
                              { DIP 8 { DUP } ; DIG 9 } ;
                              CDR ;
                              CAR ;
                              CAR ;
                              PAIR ;
                              PAIR ;
                              DIG 7 ;
                              CAR ;
                              PAIR ;
                              DIG 9 ;
                              DIG 5 ;
                              { DIP 9 { DUP } ; DIG 10 } ;
                              CAR ;
                              CAR ;
                              CAR ;
                              CDR ;
                              CDR ;
                              PUSH mutez 0 ;
                              { DIP 2 { DUP } ; DIG 3 } ;
                              COMPARE ;
                              GT ;
                              IF { DIG 2 ;
                                   SWAP ;
                                   CONTRACT unit ;
                                   IF_NONE { PUSH string "BAD_TO" ; FAILWITH } {} ;
                                   DIG 2 ;
                                   UNIT ;
                                   TRANSFER_TOKENS ;
                                   CONS }
                                 { DROP 2 } ;
                              { DIP 2 { DUP } ; DIG 3 } ;
                              { DIP 2 { DUP } ; DIG 3 } ;
                              CDR ;
                              CDR ;
                              CDR ;
                              CAR ;
                              PUSH mutez 0 ;
                              { DIP 2 { DUP } ; DIG 3 } ;
                              COMPARE ;
                              GT ;
                              IF { DIG 2 ;
                                   SWAP ;
                                   CONTRACT unit ;
                                   IF_NONE { PUSH string "BAD_TO" ; FAILWITH } {} ;
                                   DIG 2 ;
                                   UNIT ;
                                   TRANSFER_TOKENS ;
                                   CONS }
                                 { DROP 2 } ;
                              DIG 4 ;
                              DIG 5 ;
                              CAR ;
                              CDR ;
                              PUSH mutez 0 ;
                              { DIP 2 { DUP } ; DIG 3 } ;
                              COMPARE ;
                              GT ;
                              IF { DIG 2 ;
                                   SWAP ;
                                   CONTRACT unit ;
                                   IF_NONE { PUSH string "BAD_TO" ; FAILWITH } {} ;
                                   DIG 2 ;
                                   UNIT ;
                                   TRANSFER_TOKENS ;
                                   CONS }
                                 { DROP 2 } ;
                              DIG 2 ;
                              DIG 3 ;
                              SUB ;
                              { DIP 2 { DUP } ; DIG 3 } ;
                              CDR ;
                              CAR ;
                              CDR ;
                              CAR ;
                              PUSH mutez 0 ;
                              { DIP 2 { DUP } ; DIG 3 } ;
                              COMPARE ;
                              GT ;
                              IF { DIG 2 ;
                                   SWAP ;
                                   CONTRACT unit ;
                                   IF_NONE { PUSH string "BAD_TO" ; FAILWITH } {} ;
                                   DIG 2 ;
                                   UNIT ;
                                   TRANSFER_TOKENS ;
                                   CONS }
                                 { DROP 2 } ;
                              SWAP ;
                              DUP ;
                              DUG 2 ;
                              CDR ;
                              CDR ;
                              CAR ;
                              CDR ;
                              { DIP 2 { DUP } ; DIG 3 } ;
                              CDR ;
                              CDR ;
                              CDR ;
                              CAR ;
                              SELF_ADDRESS ;
                              PAIR ;
                              { DIP 3 { DUP } ; DIG 4 } ;
                              CDR ;
                              CDR ;
                              CAR ;
                              CAR ;
                              { DIP 4 { DUP } ; DIG 5 } ;
                              CDR ;
                              CAR ;
                              CAR ;
                              CAR ;
                              DIG 2 ;
                              { { DUP ; CAR ; DIP { CDR } } } ;
                              DIG 2 ;
                              CONTRACT %transfer
                                (list (pair (address %from_)
                                            (list %txs (pair (address %to_) (pair (nat %token_id) (nat %amount)))))) ;
                              IF_NONE { PUSH string "NOT_FA2_CONTRACT" ; FAILWITH } {} ;
                              PUSH mutez 0 ;
                              NIL (pair address (list (pair address (pair nat nat)))) ;
                              DIG 3 ;
                              NIL (pair address (pair nat nat)) ;
                              DIG 5 ;
                              DIG 6 ;
                              DIG 7 ;
                              SWAP ;
                              PAIR ;
                              SWAP ;
                              PAIR ;
                              CONS ;
                              SWAP ;
                              PAIR ;
                              CONS ;
                              TRANSFER_TOKENS ;
                              CONS ;
                              SWAP ;
                              PAIR }
                            { DIG 4 ;
                              DROP ;
                              PUSH string "NOT_A_SELLER" ;
                              SENDER ;
                              { DIP 3 { DUP } ; DIG 4 } ;
                              CDR ;
                              CAR ;
                              CDR ;
                              CAR ;
                              COMPARE ;
                              NEQ ;
                              IF { FAILWITH } { DROP } ;
                              NIL operation ;
                              { DIP 2 { DUP } ; DIG 3 } ;
                              CDR ;
                              CDR ;
                              CAR ;
                              CDR ;
                              { DIP 3 { DUP } ; DIG 4 } ;
                              CDR ;
                              CAR ;
                              CDR ;
                              CAR ;
                              SELF_ADDRESS ;
                              PAIR ;
                              { DIP 4 { DUP } ; DIG 5 } ;
                              CDR ;
                              CDR ;
                              CAR ;
                              CAR ;
                              { DIP 5 { DUP } ; DIG 6 } ;
                              CDR ;
                              CAR ;
                              CAR ;
                              CAR ;
                              DIG 2 ;
                              { { DUP ; CAR ; DIP { CDR } } } ;
                              DIG 2 ;
                              CONTRACT %transfer
                                (list (pair (address %from_)
                                            (list %txs (pair (address %to_) (pair (nat %token_id) (nat %amount)))))) ;
                              IF_NONE { PUSH string "NOT_FA2_CONTRACT" ; FAILWITH } {} ;
                              PUSH mutez 0 ;
                              NIL (pair address (list (pair address (pair nat nat)))) ;
                              DIG 3 ;
                              NIL (pair address (pair nat nat)) ;
                              DIG 5 ;
                              DIG 6 ;
                              DIG 7 ;
                              SWAP ;
                              PAIR ;
                              SWAP ;
                              PAIR ;
                              CONS ;
                              SWAP ;
                              PAIR ;
                              CONS ;
                              TRANSFER_TOKENS ;
                              CONS ;
                              DIG 2 ;
                              PAIR } ;
                         DUP ;
                         CAR ;
                         DUP ;
                         CDR ;
                         SWAP ;
                         DUP ;
                         DUG 2 ;
                         CAR ;
                         CDR ;
                         CDR ;
                         CDR ;
                         PUSH bool True ;
                         PAIR ;
                         { DIP 2 { DUP } ; DIG 3 } ;
                         CAR ;
                         CDR ;
                         CAR ;
                         PAIR ;
                         DIG 2 ;
                         CAR ;
                         CAR ;
                         PAIR ;
                         PAIR ;
                         { DIP 4 { DUP } ; DIG 5 } ;
                         CDR ;
                         { DIP 5 { DUP } ; DIG 6 } ;
                         CAR ;
                         CDR ;
                         CDR ;
                         CDR ;
                         CDR ;
                         PUSH bool False ;
                         { DIP 6 { DUP } ; DIG 7 } ;
                         PAIR ;
                         { DIP 3 { DUP } ; DIG 4 } ;
                         CDR ;
                         CDR ;
                         CAR ;
                         CAR ;
                         { DIP 4 { DUP } ; DIG 5 } ;
                         CDR ;
                         CAR ;
                         CAR ;
                         CAR ;
                         PAIR ;
                         { DIP 4 { DUP } ; DIG 5 } ;
                         CDR ;
                         CAR ;
                         CDR ;
                         CAR ;
                         PAIR ;
                         SWAP ;
                         SOME ;
                         SWAP ;
                         UPDATE ;
                         { DIP 6 { DUP } ; DIG 7 } ;
                         CAR ;
                         CDR ;
                         CDR ;
                         CDR ;
                         CAR ;
                         PAIR ;
                         { DIP 6 { DUP } ; DIG 7 } ;
                         CAR ;
                         CDR ;
                         CDR ;
                         CAR ;
                         PAIR ;
                         { DIP 6 { DUP } ; DIG 7 } ;
                         CAR ;
                         CDR ;
                         CAR ;
                         PAIR ;
                         DIG 6 ;
                         CAR ;
                         CAR ;
                         PAIR ;
                         PAIR ;
                         DUP ;
                         CDR ;
                         SWAP ;
                         DUP ;
                         DUG 2 ;
                         CAR ;
                         CDR ;
                         CDR ;
                         { DIP 2 { DUP } ; DIG 3 } ;
                         CAR ;
                         CDR ;
                         CAR ;
                         CDR ;
                         { DIP 3 { DUP } ; DIG 4 } ;
                         CAR ;
                         CDR ;
                         CAR ;
                         CAR ;
                         CDR ;
                         { DIP 4 { DUP } ; DIG 5 } ;
                         CAR ;
                         CDR ;
                         CAR ;
                         CAR ;
                         CAR ;
                         { DIP 6 { DUP } ; DIG 7 } ;
                         DIG 10 ;
                         SWAP ;
                         SOME ;
                         SWAP ;
                         UPDATE ;
                         PAIR ;
                         PAIR ;
                         PAIR ;
                         DIG 2 ;
                         CAR ;
                         CAR ;
                         PAIR ;
                         PAIR ;
                         SWAP ;
                         DUP ;
                         DUG 2 ;
                         CDR ;
                         CAR ;
                         CAR ;
                         CDR ;
                         IF { SWAP ; DIG 3 ; DROP 2 }
                            { DUP ;
                              CDR ;
                              CDR ;
                              SWAP ;
                              DUP ;
                              DUG 2 ;
                              CDR ;
                              CAR ;
                              CDR ;
                              CDR ;
                              { DIP 5 { DUP } ; DIG 6 } ;
                              CDR ;
                              CDR ;
                              PUSH nat 1 ;
                              { DIP 7 { DUP } ; DIG 8 } ;
                              CDR ;
                              CAR ;
                              SUB ;
                              ABS ;
                              PAIR ;
                              DIG 6 ;
                              CAR ;
                              PAIR ;
                              DIG 4 ;
                              CDR ;
                              CAR ;
                              CDR ;
                              CAR ;
                              SWAP ;
                              SOME ;
                              SWAP ;
                              UPDATE ;
                              { DIP 2 { DUP } ; DIG 3 } ;
                              CDR ;
                              CAR ;
                              CDR ;
                              CAR ;
                              PAIR ;
                              { DIP 2 { DUP } ; DIG 3 } ;
                              CDR ;
                              CAR ;
                              CAR ;
                              PAIR ;
                              PAIR ;
                              SWAP ;
                              CAR ;
                              PAIR } ;
                         SWAP ;
                         CDR ;
                         PAIR } }
                   { DIG 3 ;
                     DIG 4 ;
                     DROP 2 ;
                     IF_LEFT
                       { SWAP ;
                         DUP ;
                         DUG 2 ;
                         CAR ;
                         CAR ;
                         CAR ;
                         CAR ;
                         CAR ;
                         SENDER ;
                         COMPARE ;
                         NEQ ;
                         IF { PUSH string "NOT_ADMIN" ; FAILWITH } {} ;
                         PUSH mutez 0 ;
                         AMOUNT ;
                         COMPARE ;
                         GT ;
                         IF { PUSH string "NO_TEZ_ALLOWED" ; FAILWITH } {} ;
                         SWAP ;
                         DUP ;
                         DUG 2 ;
                         CDR ;
                         CDR ;
                         { DIP 2 { DUP } ; DIG 3 } ;
                         CDR ;
                         CAR ;
                         CDR ;
                         DIG 2 ;
                         SOME ;
                         { DIP 3 { DUP } ; DIG 4 } ;
                         CDR ;
                         CAR ;
                         CAR ;
                         CAR ;
                         PAIR ;
                         PAIR ;
                         PAIR ;
                         SWAP ;
                         CAR ;
                         PAIR ;
                         SWAP ;
                         PAIR }
                       { DIG 2 ;
                         DROP ;
                         PUSH bool True ;
                         { DIP 2 { DUP } ; DIG 3 } ;
                         CDR ;
                         CAR ;
                         CAR ;
                         CAR ;
                         COMPARE ;
                         EQ ;
                         IF { PUSH string "PAUSED" ; FAILWITH } {} ;
                         PUSH mutez 0 ;
                         AMOUNT ;
                         COMPARE ;
                         GT ;
                         IF { PUSH string "NO_TEZ_ALLOWED" ; FAILWITH } {} ;
                         PUSH string "STAKED_ALREADY" ;
                         { DIP 2 { DUP } ; DIG 3 } ;
                         CDR ;
                         CDR ;
                         CDR ;
                         CDR ;
                         { DIP 2 { DUP } ; DIG 3 } ;
                         SENDER ;
                         PAIR ;
                         MEM ;
                         IF { FAILWITH } { DROP } ;
                         SWAP ;
                         DUP ;
                         DUG 2 ;
                         CDR ;
                         CAR ;
                         CDR ;
                         CDR ;
                         SENDER ;
                         GET ;
                         IF_NONE
                           { PUSH nat 0 ; PUSH nat 0 ; PAIR ; PUSH nat 0 ; NOW ; PAIR ; PAIR }
                           {} ;
                         PUSH nat 1 ;
                         SWAP ;
                         DUP ;
                         DUG 2 ;
                         CDR ;
                         CDR ;
                         ADD ;
                         SWAP ;
                         DUP ;
                         DUG 2 ;
                         CDR ;
                         CAR ;
                         PAIR ;
                         SWAP ;
                         CAR ;
                         PAIR ;
                         { DIP 2 { DUP } ; DIG 3 } ;
                         CDR ;
                         CDR ;
                         CDR ;
                         CDR ;
                         { DIP 3 { DUP } ; DIG 4 } ;
                         CAR ;
                         CAR ;
                         CAR ;
                         CDR ;
                         CAR ;
                         NOW ;
                         ADD ;
                         { DIP 3 { DUP } ; DIG 4 } ;
                         SENDER ;
                         PAIR ;
                         SWAP ;
                         SOME ;
                         SWAP ;
                         UPDATE ;
                         { DIP 3 { DUP } ; DIG 4 } ;
                         CDR ;
                         CDR ;
                         CDR ;
                         CAR ;
                         PAIR ;
                         { DIP 3 { DUP } ; DIG 4 } ;
                         CDR ;
                         CDR ;
                         CAR ;
                         PAIR ;
                         { DIP 3 { DUP } ; DIG 4 } ;
                         CDR ;
                         CAR ;
                         PAIR ;
                         DIG 3 ;
                         CAR ;
                         PAIR ;
                         DUP ;
                         CDR ;
                         CDR ;
                         SWAP ;
                         DUP ;
                         DUG 2 ;
                         CDR ;
                         CAR ;
                         CDR ;
                         CDR ;
                         DIG 3 ;
                         SOME ;
                         SENDER ;
                         UPDATE ;
                         { DIP 2 { DUP } ; DIG 3 } ;
                         CDR ;
                         CAR ;
                         CDR ;
                         CAR ;
                         PAIR ;
                         { DIP 2 { DUP } ; DIG 3 } ;
                         CDR ;
                         CAR ;
                         CAR ;
                         PAIR ;
                         PAIR ;
                         SWAP ;
                         CAR ;
                         PAIR ;
                         NIL (pair address (pair nat nat)) ;
                         SELF_ADDRESS ;
                         DIG 3 ;
                         PUSH nat 1 ;
                         SWAP ;
                         PAIR ;
                         SWAP ;
                         PAIR ;
                         CONS ;
                         SENDER ;
                         { DIP 2 { DUP } ; DIG 3 } ;
                         NIL operation ;
                         DIG 4 ;
                         CDR ;
                         CDR ;
                         CAR ;
                         CAR ;
                         CONTRACT %transfer
                           (list (pair (address %from_)
                                       (list %txs (pair (address %to_) (pair (nat %token_id) (nat %amount)))))) ;
                         IF_NONE { PUSH string "NO_CONTRACT" ; FAILWITH } {} ;
                         PUSH mutez 0 ;
                         NIL (pair address (list (pair address (pair nat nat)))) ;
                         DIG 5 ;
                         DIG 6 ;
                         SWAP ;
                         PAIR ;
                         CONS ;
                         TRANSFER_TOKENS ;
                         CONS ;
                         PAIR } } }
               { DIG 3 ;
                 DIG 4 ;
                 DROP 2 ;
                 IF_LEFT
                   { IF_LEFT
                       { PUSH string "BAD_CALLER" ;
                         { DIP 2 { DUP } ; DIG 3 } ;
                         CAR ;
                         CDR ;
                         CDR ;
                         CAR ;
                         CDR ;
                         SENDER ;
                         COMPARE ;
                         NEQ ;
                         IF { FAILWITH } { DROP } ;
                         SWAP ;
                         DUP ;
                         DUG 2 ;
                         CDR ;
                         { DIP 2 { DUP } ; DIG 3 } ;
                         CAR ;
                         CDR ;
                         CDR ;
                         CDR ;
                         { DIP 3 { DUP } ; DIG 4 } ;
                         CAR ;
                         CDR ;
                         CDR ;
                         CAR ;
                         CDR ;
                         DIG 3 ;
                         PAIR ;
                         PAIR ;
                         { DIP 2 { DUP } ; DIG 3 } ;
                         CAR ;
                         CDR ;
                         CAR ;
                         PAIR ;
                         DIG 2 ;
                         CAR ;
                         CAR ;
                         PAIR ;
                         PAIR ;
                         SWAP ;
                         PAIR }
                       { DIG 2 ;
                         DROP ;
                         PUSH bool True ;
                         { DIP 2 { DUP } ; DIG 3 } ;
                         CDR ;
                         CAR ;
                         CAR ;
                         CAR ;
                         COMPARE ;
                         EQ ;
                         IF { PUSH string "PAUSED" ; FAILWITH } {} ;
                         PUSH mutez 0 ;
                         AMOUNT ;
                         COMPARE ;
                         GT ;
                         IF { PUSH string "NO_TEZ_ALLOWED" ; FAILWITH } {} ;
                         SWAP ;
                         DUP ;
                         DUG 2 ;
                         CDR ;
                         CDR ;
                         CDR ;
                         CDR ;
                         SWAP ;
                         DUP ;
                         DUG 2 ;
                         SENDER ;
                         PAIR ;
                         GET ;
                         IF_NONE { PUSH string "NOT_STAKED" ; FAILWITH } {} ;
                         PUSH string "COOLDOWN_PERIOD" ;
                         NOW ;
                         DIG 2 ;
                         COMPARE ;
                         GT ;
                         IF { FAILWITH } { DROP } ;
                         SWAP ;
                         DUP ;
                         DUG 2 ;
                         CDR ;
                         CAR ;
                         CDR ;
                         CDR ;
                         SENDER ;
                         GET ;
                         IF_NONE
                           { PUSH nat 0 ; PUSH nat 0 ; PAIR ; PUSH nat 0 ; NOW ; PAIR ; PAIR }
                           {} ;
                         PUSH nat 1 ;
                         SWAP ;
                         DUP ;
                         DUG 2 ;
                         CDR ;
                         CDR ;
                         SUB ;
                         ABS ;
                         SWAP ;
                         DUP ;
                         DUG 2 ;
                         CDR ;
                         CAR ;
                         PAIR ;
                         SWAP ;
                         CAR ;
                         PAIR ;
                         { DIP 2 { DUP } ; DIG 3 } ;
                         CDR ;
                         CDR ;
                         CDR ;
                         CDR ;
                         { DIP 2 { DUP } ; DIG 3 } ;
                         SENDER ;
                         PAIR ;
                         NONE timestamp ;
                         SWAP ;
                         UPDATE ;
                         { DIP 3 { DUP } ; DIG 4 } ;
                         CDR ;
                         CDR ;
                         CDR ;
                         CAR ;
                         PAIR ;
                         { DIP 3 { DUP } ; DIG 4 } ;
                         CDR ;
                         CDR ;
                         CAR ;
                         PAIR ;
                         { DIP 3 { DUP } ; DIG 4 } ;
                         CDR ;
                         CAR ;
                         PAIR ;
                         DIG 3 ;
                         CAR ;
                         PAIR ;
                         DUP ;
                         CDR ;
                         CDR ;
                         SWAP ;
                         DUP ;
                         DUG 2 ;
                         CDR ;
                         CAR ;
                         CDR ;
                         CDR ;
                         DIG 3 ;
                         SOME ;
                         SENDER ;
                         UPDATE ;
                         { DIP 2 { DUP } ; DIG 3 } ;
                         CDR ;
                         CAR ;
                         CDR ;
                         CAR ;
                         PAIR ;
                         { DIP 2 { DUP } ; DIG 3 } ;
                         CDR ;
                         CAR ;
                         CAR ;
                         PAIR ;
                         PAIR ;
                         SWAP ;
                         CAR ;
                         PAIR ;
                         NIL (pair address (pair nat nat)) ;
                         SENDER ;
                         DIG 3 ;
                         PUSH nat 1 ;
                         SWAP ;
                         PAIR ;
                         SWAP ;
                         PAIR ;
                         CONS ;
                         SELF_ADDRESS ;
                         { DIP 2 { DUP } ; DIG 3 } ;
                         NIL operation ;
                         DIG 4 ;
                         CDR ;
                         CDR ;
                         CAR ;
                         CAR ;
                         CONTRACT %transfer
                           (list (pair (address %from_)
                                       (list %txs (pair (address %to_) (pair (nat %token_id) (nat %amount)))))) ;
                         IF_NONE { PUSH string "NO_CONTRACT" ; FAILWITH } {} ;
                         PUSH mutez 0 ;
                         NIL (pair address (list (pair address (pair nat nat)))) ;
                         DIG 5 ;
                         DIG 6 ;
                         SWAP ;
                         PAIR ;
                         CONS ;
                         TRANSFER_TOKENS ;
                         CONS ;
                         PAIR } }
                   { DIG 2 ;
                     DROP ;
                     SWAP ;
                     DUP ;
                     DUG 2 ;
                     CAR ;
                     CAR ;
                     CAR ;
                     CAR ;
                     CAR ;
                     SENDER ;
                     COMPARE ;
                     NEQ ;
                     IF { PUSH string "NOT_ADMIN" ; FAILWITH } {} ;
                     SWAP ;
                     DUP ;
                     DUG 2 ;
                     CAR ;
                     CDR ;
                     CDR ;
                     CAR ;
                     CDR ;
                     CONTRACT %switch_frontend (pair (nat %last_mint_id) (address %new_frontend)) ;
                     IF_NONE { PUSH string "BAD_CONTRACT" ; FAILWITH } {} ;
                     { DIP 2 { DUP } ; DIG 3 } ;
                     NIL operation ;
                     DIG 2 ;
                     PUSH mutez 0 ;
                     DIG 4 ;
                     DIG 5 ;
                     CAR ;
                     CDR ;
                     CDR ;
                     CAR ;
                     CAR ;
                     PAIR ;
                     TRANSFER_TOKENS ;
                     CONS ;
                     PAIR } } } } }
