{ parameter
    (list (pair (address %fa2_address) (list %fa2_batch (pair (nat %token_id) (nat %amount))))) ;
  storage
    (pair (pair %bid_currency (address %fa2_address) (nat %token_id))
          (pair (nat %salsa_out)
                (pair (bool %happy_hour)
                      (pair (timestamp %happy_hr_start_time) (pair (int %hh_time) (int %time_between_hh)))))) ;
  code { LAMBDA
           (list (pair address (list (pair nat nat))))
           nat
           { PUSH nat 0 ; SWAP ; ITER { CDR ; SIZE ; ADD } } ;
         LAMBDA
           address
           (contract (list (pair address (list (pair address (pair nat nat))))))
           { CONTRACT %transfer
               (list (pair (address %from_)
                           (list %txs (pair (address %to_) (pair (nat %token_id) (nat %amount)))))) ;
             IF_NONE { PUSH string "Invalid FA2 Address" ; FAILWITH } {} } ;
         DIG 2 ;
         UNPAIR ;
         PUSH string "Amount must be 0mutez" ;
         PUSH mutez 0 ;
         AMOUNT ;
         COMPARE ;
         EQ ;
         NOT ;
         IF { FAILWITH } { DROP } ;
         SWAP ;
         DUP ;
         DUG 2 ;
         CDR ;
         CDR ;
         CDR ;
         CAR ;
         NOW ;
         COMPARE ;
         GT ;
         IF { SWAP ;
              DUP ;
              DUG 2 ;
              CDR ;
              CDR ;
              CDR ;
              PUSH bool True ;
              PAIR ;
              DIG 2 ;
              DUP ;
              DUG 3 ;
              CDR ;
              CAR ;
              PAIR ;
              DIG 2 ;
              CAR ;
              PAIR }
            { SWAP ;
              DUP ;
              DUG 2 ;
              CDR ;
              CDR ;
              CDR ;
              CDR ;
              CAR ;
              DIG 2 ;
              DUP ;
              DUG 3 ;
              CDR ;
              CDR ;
              CDR ;
              CAR ;
              ADD ;
              NOW ;
              COMPARE ;
              GT ;
              IF { SWAP ;
                   DUP ;
                   DUG 2 ;
                   CDR ;
                   CDR ;
                   CDR ;
                   PUSH bool False ;
                   PAIR ;
                   DIG 2 ;
                   DUP ;
                   DUG 3 ;
                   CDR ;
                   CAR ;
                   PAIR ;
                   DIG 2 ;
                   DUP ;
                   DUG 3 ;
                   CAR ;
                   PAIR ;
                   DUP ;
                   CDR ;
                   CDR ;
                   CDR ;
                   CDR ;
                   DIG 3 ;
                   CDR ;
                   CDR ;
                   CDR ;
                   CDR ;
                   CDR ;
                   NOW ;
                   ADD ;
                   PAIR ;
                   SWAP ;
                   DUP ;
                   DUG 2 ;
                   CDR ;
                   CDR ;
                   CAR ;
                   PAIR ;
                   SWAP ;
                   DUP ;
                   DUG 2 ;
                   CDR ;
                   CAR ;
                   PAIR ;
                   SWAP ;
                   CAR ;
                   PAIR }
                 { SWAP } } ;
         SELF_ADDRESS ;
         SENDER ;
         DIG 3 ;
         DUP ;
         DUG 4 ;
         MAP { DIG 2 ;
               DUP ;
               DUG 3 ;
               DIG 2 ;
               DUP ;
               DUG 3 ;
               DIG 7 ;
               DUP ;
               DUG 8 ;
               DUG 2 ;
               PAIR ;
               PAIR ;
               LAMBDA
                 (pair (pair (pair address address)
                             (lambda address (contract (list (pair address (list (pair address (pair nat nat))))))))
                       (pair address (list (pair nat nat))))
                 operation
                 { DUP ;
                   CDR ;
                   SWAP ;
                   CAR ;
                   DUP ;
                   CDR ;
                   SWAP ;
                   CAR ;
                   DUP ;
                   CDR ;
                   SWAP ;
                   CAR ;
                   DIG 3 ;
                   PUSH address "KT1JYWuC4eWqYkNC1Sh6BiD89vZzytVoV2Ae" ;
                   SWAP ;
                   DUP ;
                   DUG 2 ;
                   CAR ;
                   COMPARE ;
                   EQ ;
                   IF { DUP ;
                        CDR ;
                        MAP { DIG 3 ; DUP ; DUG 4 ; PAIR } ;
                        DIG 3 ;
                        DROP ;
                        SWAP ;
                        CAR ;
                        DIG 3 ;
                        SWAP ;
                        EXEC ;
                        PUSH mutez 0 ;
                        NIL (pair address (list (pair address (pair nat nat)))) ;
                        DIG 3 ;
                        DIG 4 ;
                        PAIR ;
                        CONS ;
                        TRANSFER_TOKENS }
                      { DROP 4 ; PUSH string "WRONG_CONTRACT" ; FAILWITH } } ;
               SWAP ;
               APPLY ;
               SWAP ;
               EXEC } ;
         SWAP ;
         DROP ;
         SWAP ;
         DROP ;
         SWAP ;
         DUP ;
         DUG 2 ;
         CDR ;
         CDR ;
         CAR ;
         DIG 2 ;
         DUP ;
         DUG 3 ;
         CAR ;
         PAIR ;
         DIG 2 ;
         DUP ;
         DUG 3 ;
         CDR ;
         CAR ;
         SENDER ;
         PAIR ;
         SELF_ADDRESS ;
         DIG 5 ;
         DIG 2 ;
         UNPAIR ;
         DIG 4 ;
         UNPAIR ;
         PUSH bool True ;
         DIG 2 ;
         COMPARE ;
         EQ ;
         IF { PUSH nat 2 ; DIG 3 ; DIG 4 ; DIG 9 ; SWAP ; EXEC ; MUL ; MUL }
            { DIG 2 ; DIG 3 ; DIG 8 ; SWAP ; EXEC ; MUL } ;
         NIL (pair nat nat) ;
         SWAP ;
         DIG 2 ;
         DUP ;
         DUG 3 ;
         CDR ;
         PAIR ;
         CONS ;
         SWAP ;
         CAR ;
         PAIR ;
         SWAP ;
         PUSH address "KT19ovJhcsUn4YU8Q5L3BGovKSixfbWcecEA" ;
         DIG 2 ;
         DUP ;
         DUG 3 ;
         CAR ;
         COMPARE ;
         EQ ;
         IF { SWAP ;
              DUP ;
              DUG 2 ;
              CDR ;
              MAP { SWAP ; DUP ; DUG 2 ; PAIR } ;
              SWAP ;
              DROP ;
              SWAP ;
              CAR ;
              DIG 5 ;
              SWAP ;
              EXEC ;
              PUSH mutez 0 ;
              NIL (pair address (list (pair address (pair nat nat)))) ;
              DIG 3 ;
              DIG 4 ;
              PAIR ;
              CONS ;
              TRANSFER_TOKENS }
            { DROP 3 ; DIG 2 ; DROP ; PUSH string "WRONG_CONTRACT" ; FAILWITH } ;
         CONS ;
         PAIR } }
