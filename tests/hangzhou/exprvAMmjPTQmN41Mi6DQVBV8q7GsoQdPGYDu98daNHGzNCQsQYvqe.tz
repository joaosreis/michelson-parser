{ parameter
    (or (option %setRate (pair int nat))
        (or (int %setDelay)
            (or (list %checkowner (pair (pair (address %owner) (nat %token_id)) (nat %balance)))
                (or (unit %clearBids)
                    (or (pair %upforsale (nat %minbid) (nat %ibuynow))
                        (or (pair %bidInternal
                               (or %paymentid bytes timestamp)
                               (pair (address %ibidder) (nat %value)))
                            (or (nat %bid)
                                (or (nat %buyNow)
                                    (or (nat %makeOfferSBK)
                                        (or (pair %bidAs (or %paymentid bytes timestamp) (pair (address %ibidder) (nat %value)))
                                            (or (pair %buyNowAs
                                                   (or %paymentid bytes timestamp)
                                                   (pair (address %ibidder) (nat %value)))
                                                (or (pair %makeOfferAs
                                                       (or %paymentid bytes timestamp)
                                                       (pair (address %ibuyer) (nat %value)))
                                                    (or (pair %removeBidder (nat %a) (or %paymentid bytes timestamp))
                                                        (or (pair %refuseOffer (nat %a) (or %k bytes timestamp))
                                                            (or (pair %acceptInternal (address %iowner) (or %paymentid bytes timestamp))
                                                                (or (pair %acceptOffer (nat %a) (or %paymentid bytes timestamp))
                                                                    (or (unit %claim) (unit %closeBidding)))))))))))))))))) ;
  storage
    (pair (address %owner)
          (pair (nat %tokenid)
                (pair (address %nft)
                      (pair (address %token)
                            (pair (address %admin)
                                  (pair (nat %initbid)
                                        (pair (nat %bestbid)
                                              (pair (nat %buynow)
                                                    (pair (timestamp %endofbid)
                                                          (pair (nat %tobeburnt)
                                                                (pair (int %delay)
                                                                      (pair (option %bestpaymentid (or bytes timestamp))
                                                                            (pair (map %bids
                                                                                     (or bytes timestamp)
                                                                                     (pair (address %bidder) (pair (timestamp %b_date) (nat %amount))))
                                                                                  (pair (nat %_state)
                                                                                        (pair (option %rate (pair int nat)) (big_map %metadata string bytes)))))))))))))))) ;
  code { LAMBDA
           (pair (option (pair int nat)) nat)
           nat
           { { { DUP ; CAR ; DIP { CDR } } } ;
             SWAP ;
             PUSH unit Unit ;
             DIG 2 ;
             DUP ;
             DUG 3 ;
             IF_NONE
               { PUSH nat 100 ;
                 DIG 2 ;
                 DUP ;
                 DUG 3 ;
                 COMPARE ;
                 LT ;
                 IF { PUSH nat 5 }
                    { PUSH nat 1000 ;
                      DIG 2 ;
                      DUP ;
                      DUG 3 ;
                      COMPARE ;
                      LT ;
                      IF { PUSH nat 10 }
                         { PUSH nat 5000 ;
                           DIG 2 ;
                           DUP ;
                           DUG 3 ;
                           COMPARE ;
                           LT ;
                           IF { PUSH nat 25 } { PUSH nat 50 } } } }
               { PUSH nat 1 ;
                 DIG 3 ;
                 DUP ;
                 DUG 4 ;
                 INT ;
                 PAIR ;
                 DIG 1 ;
                 DUP ;
                 DUG 2 ;
                 PAIR ;
                 { { DUP ; CAR ; DIP { CDR } } } ;
                 DIP 1 { { { DUP ; CAR ; DIP { CDR } } } } ;
                 { { DUP ; CAR ; DIP { CDR } } } ;
                 DIP 1 { SWAP } ;
                 MUL ;
                 DIP 1
                     { MUL ;
                       DUP ;
                       PUSH nat 0 ;
                       COMPARE ;
                       EQ ;
                       IF { PUSH string "DivByZero" ; FAILWITH } {} } ;
                 PAIR ;
                 { { DUP ; CAR ; DIP { CDR } } } ;
                 EDIV ;
                 IF_NONE { PUSH string "DivByZero" ; FAILWITH } { CAR } ;
                 ABS ;
                 SWAP ;
                 DROP 1 } ;
             SWAP ;
             DROP 1 ;
             DUG 2 ;
             DROP 2 } ;
         LAMBDA
           (list (pair (pair (address %owner) (nat %token_id)) (nat %balance)))
           bool
           { PUSH unit Unit ;
             DIG 1 ;
             DUP ;
             DUG 2 ;
             IF_CONS
               { PUSH nat 1 ; DIG 1 ; DUP ; DUG 2 ; CDR ; COMPARE ; EQ ; DUG 2 ; DROP 2 }
               { PUSH bool False } ;
             SWAP ;
             DROP 1 ;
             DUG 1 ;
             DROP 1 } ;
         LAMBDA
           (or bytes timestamp)
           bool
           { PUSH unit Unit ;
             DIG 1 ;
             DUP ;
             DUG 2 ;
             IF_LEFT
               { PUSH bool True ; SWAP ; DROP 1 }
               { PUSH bool False ; SWAP ; DROP 1 } ;
             SWAP ;
             DROP 1 ;
             DUG 1 ;
             DROP 1 } ;
         LAMBDA
           (map (or bytes timestamp)
                (pair (address %bidder) (pair (timestamp %b_date) (nat %amount))))
           (option (or bytes timestamp))
           { PUSH unit Unit ;
             NIL (or bytes timestamp) ;
             DIG 2 ;
             DUP ;
             DUG 3 ;
             ITER { { { DUP ; CAR ; DIP { CDR } } } ;
                    NIL (or bytes timestamp) ;
                    DIG 1 ;
                    DUP ;
                    DUG 2 ;
                    SOME ;
                    PAIR ;
                    DIG 3 ;
                    DUP ;
                    DUG 4 ;
                    ITER { DIG 1 ;
                           DUP ;
                           DUG 2 ;
                           CAR ;
                           DIG 2 ;
                           DUP ;
                           DUG 3 ;
                           CDR ;
                           DIG 1 ;
                           DUP ;
                           DUG 2 ;
                           IF_NONE
                             { DUP ; DIG 3 ; DUP ; DUG 4 ; CONS ; DIG 2 ; DUP ; DUG 3 ; PAIR }
                             { PUSH int 0 ;
                               DIG 10 ;
                               DUP ;
                               DUG 11 ;
                               DIG 5 ;
                               DUP ;
                               DUG 6 ;
                               GET ;
                               IF_NONE { PUSH string "NotFound" ; FAILWITH } {} ;
                               DIG 8 ;
                               DUP ;
                               DUG 9 ;
                               CDR ;
                               CDR ;
                               DIG 1 ;
                               DUP ;
                               DUG 2 ;
                               CDR ;
                               CDR ;
                               COMPARE ;
                               LT ;
                               IF { PUSH int 1 } { PUSH int 0 } ;
                               DIP 1 { DROP 1 } ;
                               COMPARE ;
                               GT ;
                               IF { DIG 1 ;
                                    DUP ;
                                    DUG 2 ;
                                    DIG 6 ;
                                    DUP ;
                                    DUG 7 ;
                                    CONS ;
                                    DIG 4 ;
                                    DUP ;
                                    DUG 5 ;
                                    CONS ;
                                    NONE (or bytes timestamp) ;
                                    PAIR }
                                  { DIG 1 ;
                                    DUP ;
                                    DUG 2 ;
                                    DIG 4 ;
                                    DUP ;
                                    DUG 5 ;
                                    CONS ;
                                    DIG 3 ;
                                    DUP ;
                                    DUG 4 ;
                                    PAIR } ;
                               SWAP ;
                               DROP 1 } ;
                           DIP 1 { DROP 1 } ;
                           DIP 1 { DROP 1 } ;
                           DIP 1 { DIG 1 ; DROP 1 } ;
                           DUG 1 ;
                           DROP 1 } ;
                    DUP ;
                    CAR ;
                    DIG 1 ;
                    DUP ;
                    DUG 2 ;
                    CDR ;
                    NIL (or bytes timestamp) ;
                    DIG 2 ;
                    DUP ;
                    DUG 3 ;
                    IF_NONE
                      { DIG 1 ; DUP ; DUG 2 }
                      { DIG 2 ; DUP ; DUG 3 ; DIG 6 ; DUP ; DUG 7 ; CONS ; SWAP ; DROP 1 } ;
                    ITER { DIG 1 ;
                           DUP ;
                           DUG 2 ;
                           DIG 1 ;
                           DUP ;
                           DUG 2 ;
                           CONS ;
                           DIP 1 { DIG 1 ; DROP 1 } ;
                           DUG 1 ;
                           DROP 1 } ;
                    DIP 1 { DROP 1 } ;
                    DIP 1 { DROP 1 } ;
                    DIP 1 { DROP 1 } ;
                    DIP 1 { DIG 2 ; DROP 1 } ;
                    DUG 2 ;
                    DROP 2 } ;
             PUSH nat 0 ;
             DIG 1 ;
             DUP ;
             DUG 2 ;
             SIZE ;
             COMPARE ;
             EQ ;
             IF { NONE (or bytes timestamp) }
                { NONE (or bytes timestamp) ;
                  PUSH nat 0 ;
                  PAIR ;
                  DIG 1 ;
                  DUP ;
                  DUG 2 ;
                  ITER { PUSH nat 0 ;
                         DIG 2 ;
                         DUP ;
                         DUG 3 ;
                         CAR ;
                         COMPARE ;
                         EQ ;
                         IF { DUP ; SOME ; PUSH nat 1 ; DIG 3 ; DUP ; DUG 4 ; CAR ; ADD ; PAIR }
                            { DIG 1 ;
                              DUP ;
                              DUG 2 ;
                              CDR ;
                              PUSH nat 1 ;
                              DIG 3 ;
                              DUP ;
                              DUG 4 ;
                              CAR ;
                              ADD ;
                              PAIR } ;
                         DIP 1 { DIG 1 ; DROP 1 } ;
                         DUG 1 ;
                         DROP 1 } ;
                  CDR ;
                  IF_NONE { PUSH string "NotFound" ; FAILWITH } {} ;
                  SOME } ;
             DUP ;
             DIP 1 { DIG 2 ; DROP 1 } ;
             DUG 2 ;
             DROP 2 ;
             DUG 1 ;
             DROP 1 } ;
         NIL operation ;
         DIG 5 ;
         { { DUP ; CAR ; DIP { CDR } } } ;
         DIP 1
             { { { DUP ; CAR ; DIP { CDR } } } ;
               SWAP ;
               { { DUP ; CAR ; DIP { CDR } } } ;
               SWAP ;
               { { DUP ; CAR ; DIP { CDR } } } ;
               SWAP ;
               { { DUP ; CAR ; DIP { CDR } } } ;
               SWAP ;
               { { DUP ; CAR ; DIP { CDR } } } ;
               SWAP ;
               { { DUP ; CAR ; DIP { CDR } } } ;
               SWAP ;
               { { DUP ; CAR ; DIP { CDR } } } ;
               SWAP ;
               { { DUP ; CAR ; DIP { CDR } } } ;
               SWAP ;
               { { DUP ; CAR ; DIP { CDR } } } ;
               SWAP ;
               { { DUP ; CAR ; DIP { CDR } } } ;
               SWAP ;
               { { DUP ; CAR ; DIP { CDR } } } ;
               SWAP ;
               { { DUP ; CAR ; DIP { CDR } } } ;
               SWAP ;
               { { DUP ; CAR ; DIP { CDR } } } ;
               SWAP ;
               { { DUP ; CAR ; DIP { CDR } } } ;
               SWAP ;
               { { DUP ; CAR ; DIP { CDR } } } ;
               SWAP } ;
         IF_LEFT
           { DIG 12 ;
             DUP ;
             DUG 13 ;
             SENDER ;
             COMPARE ;
             EQ ;
             NOT ;
             IF { PUSH string "InvalidCaller" ; FAILWITH } {} ;
             DUP ;
             DIP 1 { DIG 2 ; DROP 1 } ;
             DUG 2 ;
             DROP 1 ;
             SWAP ;
             PAIR ;
             SWAP ;
             PAIR ;
             SWAP ;
             PAIR ;
             SWAP ;
             PAIR ;
             SWAP ;
             PAIR ;
             SWAP ;
             PAIR ;
             SWAP ;
             PAIR ;
             SWAP ;
             PAIR ;
             SWAP ;
             PAIR ;
             SWAP ;
             PAIR ;
             SWAP ;
             PAIR ;
             SWAP ;
             PAIR ;
             SWAP ;
             PAIR ;
             SWAP ;
             PAIR ;
             SWAP ;
             PAIR ;
             DIG 1 ;
             PAIR }
           { IF_LEFT
               { DIG 12 ;
                 DUP ;
                 DUG 13 ;
                 SENDER ;
                 COMPARE ;
                 EQ ;
                 NOT ;
                 IF { PUSH string "InvalidCaller" ; FAILWITH } {} ;
                 DUP ;
                 DIP 1 { DIG 6 ; DROP 1 } ;
                 DUG 6 ;
                 DIG 6 ;
                 DUP ;
                 DUG 7 ;
                 NOW ;
                 ADD ;
                 DIP 1 { DIG 8 ; DROP 1 } ;
                 DUG 8 ;
                 DROP 1 ;
                 SWAP ;
                 PAIR ;
                 SWAP ;
                 PAIR ;
                 SWAP ;
                 PAIR ;
                 SWAP ;
                 PAIR ;
                 SWAP ;
                 PAIR ;
                 SWAP ;
                 PAIR ;
                 SWAP ;
                 PAIR ;
                 SWAP ;
                 PAIR ;
                 SWAP ;
                 PAIR ;
                 SWAP ;
                 PAIR ;
                 SWAP ;
                 PAIR ;
                 SWAP ;
                 PAIR ;
                 SWAP ;
                 PAIR ;
                 SWAP ;
                 PAIR ;
                 SWAP ;
                 PAIR ;
                 DIG 1 ;
                 PAIR }
               { IF_LEFT
                   { DIG 14 ;
                     DUP ;
                     DUG 15 ;
                     SENDER ;
                     COMPARE ;
                     EQ ;
                     NOT ;
                     IF { PUSH string "InvalidCaller" ; FAILWITH } {} ;
                     DIG 20 ;
                     DUP ;
                     DUG 21 ;
                     DIG 1 ;
                     DUP ;
                     DUG 2 ;
                     EXEC ;
                     NOT ;
                     IF { PUSH string "Source Not Owner" ; FAILWITH } {} ;
                     DROP 1 ;
                     SWAP ;
                     PAIR ;
                     SWAP ;
                     PAIR ;
                     SWAP ;
                     PAIR ;
                     SWAP ;
                     PAIR ;
                     SWAP ;
                     PAIR ;
                     SWAP ;
                     PAIR ;
                     SWAP ;
                     PAIR ;
                     SWAP ;
                     PAIR ;
                     SWAP ;
                     PAIR ;
                     SWAP ;
                     PAIR ;
                     SWAP ;
                     PAIR ;
                     SWAP ;
                     PAIR ;
                     SWAP ;
                     PAIR ;
                     SWAP ;
                     PAIR ;
                     SWAP ;
                     PAIR ;
                     DIG 1 ;
                     PAIR }
                   { IF_LEFT
                       { DROP 1 ;
                         SELF ;
                         ADDRESS ;
                         SENDER ;
                         COMPARE ;
                         EQ ;
                         NOT ;
                         IF { PUSH string "InvalidCaller" ; FAILWITH } {} ;
                         DIG 3 ;
                         DUP ;
                         DUG 4 ;
                         ITER { { { DUP ; CAR ; DIP { CDR } } } ;
                                DUP ;
                                IF_LEFT
                                  { DIG 6 ;
                                    DUP ;
                                    DUG 7 ;
                                    DIG 2 ;
                                    DUP ;
                                    DUG 3 ;
                                    GET ;
                                    IF_NONE { PUSH string "NotFound" ; FAILWITH } {} ;
                                    CDR ;
                                    CDR ;
                                    DIG 10 ;
                                    DUP ;
                                    DUG 11 ;
                                    ADD ;
                                    DIP 1 { DIG 9 ; DROP 1 } ;
                                    DUG 9 ;
                                    DROP 1 }
                                  { DIG 19 ;
                                    DUP ;
                                    DUG 20 ;
                                    DIG 16 ;
                                    DUP ;
                                    DUG 17 ;
                                    CONTRACT %transfer (pair address (pair address nat)) ;
                                    IF_NONE { PUSH string "NotFound" ; FAILWITH } {} ;
                                    PUSH mutez 0 ;
                                    DIG 9 ;
                                    DUP ;
                                    DUG 10 ;
                                    DIG 5 ;
                                    DUP ;
                                    DUG 6 ;
                                    GET ;
                                    IF_NONE { PUSH string "NotFound" ; FAILWITH } {} ;
                                    CDR ;
                                    CDR ;
                                    DIG 10 ;
                                    DUP ;
                                    DUG 11 ;
                                    DIG 6 ;
                                    DUP ;
                                    DUG 7 ;
                                    GET ;
                                    IF_NONE { PUSH string "NotFound" ; FAILWITH } {} ;
                                    CAR ;
                                    PAIR ;
                                    SELF ;
                                    ADDRESS ;
                                    PAIR ;
                                    TRANSFER_TOKENS ;
                                    CONS ;
                                    DIP 1 { DIG 19 ; DROP 1 } ;
                                    DUG 19 ;
                                    DROP 1 } ;
                                DROP 2 } ;
                         PUSH nat 0 ;
                         DIG 7 ;
                         DUP ;
                         DUG 8 ;
                         COMPARE ;
                         GT ;
                         IF { DIG 16 ;
                              DUP ;
                              DUG 17 ;
                              DIG 13 ;
                              DUP ;
                              DUG 14 ;
                              CONTRACT %transfer (pair address (pair address nat)) ;
                              IF_NONE { PUSH string "NotFound" ; FAILWITH } {} ;
                              PUSH mutez 0 ;
                              DIG 9 ;
                              DUP ;
                              DUG 10 ;
                              DIG 15 ;
                              DUP ;
                              DUG 16 ;
                              PAIR ;
                              SELF ;
                              ADDRESS ;
                              PAIR ;
                              TRANSFER_TOKENS ;
                              CONS ;
                              DIP 1 { DIG 16 ; DROP 1 } ;
                              DUG 16 }
                            {} ;
                         EMPTY_MAP
                           (or bytes timestamp)
                           (pair (address %bidder) (pair (timestamp %b_date) (nat %amount))) ;
                         DIP 1 { DIG 3 ; DROP 1 } ;
                         DUG 3 ;
                         PUSH nat 0 ;
                         DIP 1 { DIG 6 ; DROP 1 } ;
                         DUG 6 ;
                         NONE (or bytes timestamp) ;
                         DIP 1 { DIG 4 ; DROP 1 } ;
                         DUG 4 ;
                         SWAP ;
                         PAIR ;
                         SWAP ;
                         PAIR ;
                         SWAP ;
                         PAIR ;
                         SWAP ;
                         PAIR ;
                         SWAP ;
                         PAIR ;
                         SWAP ;
                         PAIR ;
                         SWAP ;
                         PAIR ;
                         SWAP ;
                         PAIR ;
                         SWAP ;
                         PAIR ;
                         SWAP ;
                         PAIR ;
                         SWAP ;
                         PAIR ;
                         SWAP ;
                         PAIR ;
                         SWAP ;
                         PAIR ;
                         SWAP ;
                         PAIR ;
                         SWAP ;
                         PAIR ;
                         DIG 1 ;
                         PAIR }
                       { IF_LEFT
                           { { { DUP ; CAR ; DIP { CDR } } } ;
                             SWAP ;
                             DIG 4 ;
                             DUP ;
                             DUG 5 ;
                             DUP ;
                             PUSH nat 0 ;
                             COMPARE ;
                             EQ ;
                             IF { SOURCE ;
                                  DIP 1 { DIG 18 ; DROP 1 } ;
                                  DUG 18 ;
                                  DIG 2 ;
                                  DUP ;
                                  DUG 3 ;
                                  DIP 1 { DIG 13 ; DROP 1 } ;
                                  DUG 13 ;
                                  DIG 2 ;
                                  DUP ;
                                  DUG 3 ;
                                  DIP 1 { DIG 12 ; DROP 1 } ;
                                  DUG 12 ;
                                  DIG 1 ;
                                  DUP ;
                                  DUG 2 ;
                                  DIP 1 { DIG 11 ; DROP 1 } ;
                                  DUG 11 ;
                                  DIG 8 ;
                                  DUP ;
                                  DUG 9 ;
                                  NOW ;
                                  ADD ;
                                  DIP 1 { DIG 10 ; DROP 1 } ;
                                  DUG 10 ;
                                  DIG 17 ;
                                  DUP ;
                                  DUG 18 ;
                                  DIG 19 ;
                                  DUP ;
                                  DUG 20 ;
                                  PAIR ;
                                  DIG 20 ;
                                  DUP ;
                                  DUG 21 ;
                                  DIG 18 ;
                                  DUP ;
                                  DUG 19 ;
                                  CONTRACT %balance_of
                                    (pair (list (pair address nat)) (contract (list (pair (pair address nat) nat)))) ;
                                  IF_NONE { PUSH string "NotFound" ; FAILWITH } {} ;
                                  PUSH mutez 0 ;
                                  SELF ;
                                  ADDRESS ;
                                  CONTRACT %checkowner (list (pair (pair address nat) nat)) ;
                                  IF_NONE { PUSH string "NotFound" ; FAILWITH } {} ;
                                  NIL (pair (address %owner) (nat %token_id)) ;
                                  DIG 5 ;
                                  DUP ;
                                  DUG 6 ;
                                  CONS ;
                                  PAIR ;
                                  TRANSFER_TOKENS ;
                                  CONS ;
                                  DIP 1 { DIG 20 ; DROP 1 } ;
                                  DUG 20 ;
                                  DIG 18 ;
                                  DUP ;
                                  DUG 19 ;
                                  DIG 18 ;
                                  DUP ;
                                  DUG 19 ;
                                  PAIR ;
                                  DIG 20 ;
                                  DUP ;
                                  DUG 21 ;
                                  PAIR ;
                                  DIG 21 ;
                                  DUP ;
                                  DUG 22 ;
                                  DIG 19 ;
                                  DUP ;
                                  DUG 20 ;
                                  CONTRACT %update_operators
                                    (list (or (pair address (pair address nat)) (pair address (pair address nat)))) ;
                                  IF_NONE { PUSH string "NotFound" ; FAILWITH } {} ;
                                  PUSH mutez 0 ;
                                  NIL (or (pair (address %owner) (pair (address %operator) (nat %token_id)))
                                          (pair (address %owner) (pair (address %operator) (nat %token_id)))) ;
                                  DIG 4 ;
                                  DUP ;
                                  DUG 5 ;
                                  LEFT (pair address (pair address nat)) ;
                                  CONS ;
                                  TRANSFER_TOKENS ;
                                  CONS ;
                                  DIP 1 { DIG 21 ; DROP 1 } ;
                                  DUG 21 ;
                                  DIG 21 ;
                                  DUP ;
                                  DUG 22 ;
                                  SELF ;
                                  ADDRESS ;
                                  CONTRACT %clearBids unit ;
                                  IF_NONE { PUSH string "NotFound" ; FAILWITH } {} ;
                                  PUSH mutez 0 ;
                                  UNIT ;
                                  TRANSFER_TOKENS ;
                                  CONS ;
                                  DIP 1 { DIG 21 ; DROP 1 } ;
                                  DUG 21 ;
                                  DROP 2 ;
                                  PUSH nat 1 ;
                                  DIP 1 { DIG 5 ; DROP 1 } ;
                                  DUG 5 }
                                { PUSH string "InvalidState" ; FAILWITH } ;
                             DROP 3 ;
                             SWAP ;
                             PAIR ;
                             SWAP ;
                             PAIR ;
                             SWAP ;
                             PAIR ;
                             SWAP ;
                             PAIR ;
                             SWAP ;
                             PAIR ;
                             SWAP ;
                             PAIR ;
                             SWAP ;
                             PAIR ;
                             SWAP ;
                             PAIR ;
                             SWAP ;
                             PAIR ;
                             SWAP ;
                             PAIR ;
                             SWAP ;
                             PAIR ;
                             SWAP ;
                             PAIR ;
                             SWAP ;
                             PAIR ;
                             SWAP ;
                             PAIR ;
                             SWAP ;
                             PAIR ;
                             DIG 1 ;
                             PAIR }
                           { IF_LEFT
                               { { { DUP ; CAR ; DIP { CDR } } } ;
                                 SWAP ;
                                 { { DUP ; CAR ; DIP { CDR } } } ;
                                 SWAP ;
                                 SELF ;
                                 ADDRESS ;
                                 SENDER ;
                                 COMPARE ;
                                 EQ ;
                                 NOT ;
                                 IF { PUSH string "InvalidCaller" ; FAILWITH } {} ;
                                 DIG 6 ;
                                 DUP ;
                                 DUG 7 ;
                                 DIG 3 ;
                                 DUP ;
                                 DUG 4 ;
                                 MEM ;
                                 IF { PUSH string "KeyExists" ; FAILWITH }
                                    { DIG 6 ;
                                      DUP ;
                                      DUG 7 ;
                                      DIG 1 ;
                                      DUP ;
                                      DUG 2 ;
                                      NOW ;
                                      PAIR ;
                                      DIG 3 ;
                                      DUP ;
                                      DUG 4 ;
                                      PAIR ;
                                      SOME ;
                                      DIG 4 ;
                                      DUP ;
                                      DUG 5 ;
                                      UPDATE ;
                                      DIP 1 { DIG 6 ; DROP 1 } ;
                                      DUG 6 } ;
                                 DIG 8 ;
                                 DUP ;
                                 DUG 9 ;
                                 NOW ;
                                 ADD ;
                                 DIP 1 { DIG 10 ; DROP 1 } ;
                                 DUG 10 ;
                                 DIG 7 ;
                                 DUP ;
                                 DUG 8 ;
                                 IF_NONE
                                   {}
                                   { DUP ;
                                     IF_LEFT
                                       { DROP 1 }
                                       { DIG 21 ;
                                         DUP ;
                                         DUG 22 ;
                                         DIG 18 ;
                                         DUP ;
                                         DUG 19 ;
                                         CONTRACT %transfer (pair address (pair address nat)) ;
                                         IF_NONE { PUSH string "NotFound" ; FAILWITH } {} ;
                                         PUSH mutez 0 ;
                                         DIG 11 ;
                                         DUP ;
                                         DUG 12 ;
                                         DIG 5 ;
                                         DUP ;
                                         DUG 6 ;
                                         GET ;
                                         IF_NONE { PUSH string "NotFound" ; FAILWITH } {} ;
                                         CDR ;
                                         CDR ;
                                         DIG 12 ;
                                         DUP ;
                                         DUG 13 ;
                                         DIG 6 ;
                                         DUP ;
                                         DUG 7 ;
                                         GET ;
                                         IF_NONE { PUSH string "NotFound" ; FAILWITH } {} ;
                                         CAR ;
                                         PAIR ;
                                         SELF ;
                                         ADDRESS ;
                                         PAIR ;
                                         TRANSFER_TOKENS ;
                                         CONS ;
                                         DIP 1 { DIG 21 ; DROP 1 } ;
                                         DUG 21 ;
                                         DROP 1 } ;
                                     DROP 1 } ;
                                 DIG 2 ;
                                 DUP ;
                                 DUG 3 ;
                                 SOME ;
                                 DIP 1 { DIG 7 ; DROP 1 } ;
                                 DUG 7 ;
                                 DUP ;
                                 DIP 1 { DIG 12 ; DROP 1 } ;
                                 DUG 12 ;
                                 DROP 3 ;
                                 SWAP ;
                                 PAIR ;
                                 SWAP ;
                                 PAIR ;
                                 SWAP ;
                                 PAIR ;
                                 SWAP ;
                                 PAIR ;
                                 SWAP ;
                                 PAIR ;
                                 SWAP ;
                                 PAIR ;
                                 SWAP ;
                                 PAIR ;
                                 SWAP ;
                                 PAIR ;
                                 SWAP ;
                                 PAIR ;
                                 SWAP ;
                                 PAIR ;
                                 SWAP ;
                                 PAIR ;
                                 SWAP ;
                                 PAIR ;
                                 SWAP ;
                                 PAIR ;
                                 SWAP ;
                                 PAIR ;
                                 SWAP ;
                                 PAIR ;
                                 DIG 1 ;
                                 PAIR }
                               { IF_LEFT
                                   { DIG 3 ;
                                     DUP ;
                                     DUG 4 ;
                                     PUSH nat 1 ;
                                     COMPARE ;
                                     NEQ ;
                                     IF { PUSH string "InvalidState" ; FAILWITH } {} ;
                                     DIG 8 ;
                                     DUP ;
                                     DUG 9 ;
                                     NOW ;
                                     COMPARE ;
                                     LT ;
                                     NOT ;
                                     IF { PUSH string "Bid Period Is Over" ; FAILWITH } {} ;
                                     DIG 9 ;
                                     DUP ;
                                     DUG 10 ;
                                     DIG 1 ;
                                     DUP ;
                                     DUG 2 ;
                                     COMPARE ;
                                     EQ ;
                                     DIG 10 ;
                                     DUP ;
                                     DUG 11 ;
                                     DIG 2 ;
                                     DUP ;
                                     DUG 3 ;
                                     COMPARE ;
                                     LE ;
                                     DIG 2 ;
                                     DUP ;
                                     DUG 3 ;
                                     DIG 24 ;
                                     DUP ;
                                     DUG 25 ;
                                     DIG 14 ;
                                     DUP ;
                                     DUG 15 ;
                                     DIG 7 ;
                                     DUP ;
                                     DUG 8 ;
                                     PAIR ;
                                     EXEC ;
                                     DIG 14 ;
                                     DUP ;
                                     DUG 15 ;
                                     ADD ;
                                     COMPARE ;
                                     LE ;
                                     AND ;
                                     OR ;
                                     NOT ;
                                     IF { PUSH string "Invalid Bid Value" ; FAILWITH } {} ;
                                     NOW ;
                                     RIGHT bytes ;
                                     DIG 18 ;
                                     DUP ;
                                     DUG 19 ;
                                     DIG 15 ;
                                     DUP ;
                                     DUG 16 ;
                                     CONTRACT %transfer (pair address (pair address nat)) ;
                                     IF_NONE { PUSH string "NotFound" ; FAILWITH } {} ;
                                     PUSH mutez 0 ;
                                     DIG 4 ;
                                     DUP ;
                                     DUG 5 ;
                                     SELF ;
                                     ADDRESS ;
                                     PAIR ;
                                     SENDER ;
                                     PAIR ;
                                     TRANSFER_TOKENS ;
                                     CONS ;
                                     DIP 1 { DIG 18 ; DROP 1 } ;
                                     DUG 18 ;
                                     DIG 18 ;
                                     DUP ;
                                     DUG 19 ;
                                     SELF ;
                                     ADDRESS ;
                                     CONTRACT %bidInternal (pair (or bytes timestamp) (pair address nat)) ;
                                     IF_NONE { PUSH string "NotFound" ; FAILWITH } {} ;
                                     PUSH mutez 0 ;
                                     DIG 4 ;
                                     DUP ;
                                     DUG 5 ;
                                     SENDER ;
                                     PAIR ;
                                     DIG 4 ;
                                     DUP ;
                                     DUG 5 ;
                                     PAIR ;
                                     TRANSFER_TOKENS ;
                                     CONS ;
                                     DIP 1 { DIG 18 ; DROP 1 } ;
                                     DUG 18 ;
                                     DROP 2 ;
                                     SWAP ;
                                     PAIR ;
                                     SWAP ;
                                     PAIR ;
                                     SWAP ;
                                     PAIR ;
                                     SWAP ;
                                     PAIR ;
                                     SWAP ;
                                     PAIR ;
                                     SWAP ;
                                     PAIR ;
                                     SWAP ;
                                     PAIR ;
                                     SWAP ;
                                     PAIR ;
                                     SWAP ;
                                     PAIR ;
                                     SWAP ;
                                     PAIR ;
                                     SWAP ;
                                     PAIR ;
                                     SWAP ;
                                     PAIR ;
                                     SWAP ;
                                     PAIR ;
                                     SWAP ;
                                     PAIR ;
                                     SWAP ;
                                     PAIR ;
                                     DIG 1 ;
                                     PAIR }
                                   { IF_LEFT
                                       { DIG 3 ;
                                         DUP ;
                                         DUG 4 ;
                                         PUSH nat 1 ;
                                         COMPARE ;
                                         NEQ ;
                                         IF { PUSH string "InvalidState" ; FAILWITH } {} ;
                                         DIG 9 ;
                                         DUP ;
                                         DUG 10 ;
                                         DIG 1 ;
                                         DUP ;
                                         DUG 2 ;
                                         COMPARE ;
                                         EQ ;
                                         NOT ;
                                         IF { PUSH string "r30" ; PUSH string "InvalidCondition" ; PAIR ; FAILWITH } {} ;
                                         DIG 17 ;
                                         DUP ;
                                         DUG 18 ;
                                         SELF ;
                                         ADDRESS ;
                                         CONTRACT %bid nat ;
                                         IF_NONE { PUSH string "NotFound" ; FAILWITH } {} ;
                                         PUSH mutez 0 ;
                                         DIG 3 ;
                                         DUP ;
                                         DUG 4 ;
                                         TRANSFER_TOKENS ;
                                         CONS ;
                                         DIP 1 { DIG 17 ; DROP 1 } ;
                                         DUG 17 ;
                                         DROP 1 ;
                                         SWAP ;
                                         PAIR ;
                                         SWAP ;
                                         PAIR ;
                                         SWAP ;
                                         PAIR ;
                                         SWAP ;
                                         PAIR ;
                                         SWAP ;
                                         PAIR ;
                                         SWAP ;
                                         PAIR ;
                                         SWAP ;
                                         PAIR ;
                                         SWAP ;
                                         PAIR ;
                                         SWAP ;
                                         PAIR ;
                                         SWAP ;
                                         PAIR ;
                                         SWAP ;
                                         PAIR ;
                                         SWAP ;
                                         PAIR ;
                                         SWAP ;
                                         PAIR ;
                                         SWAP ;
                                         PAIR ;
                                         SWAP ;
                                         PAIR ;
                                         DIG 1 ;
                                         PAIR }
                                       { IF_LEFT
                                           { DIG 3 ;
                                             DUP ;
                                             DUG 4 ;
                                             PUSH nat 0 ;
                                             COMPARE ;
                                             NEQ ;
                                             IF { PUSH string "InvalidState" ; FAILWITH } {} ;
                                             NOW ;
                                             RIGHT bytes ;
                                             DIG 18 ;
                                             DUP ;
                                             DUG 19 ;
                                             DIG 15 ;
                                             DUP ;
                                             DUG 16 ;
                                             CONTRACT %transfer (pair address (pair address nat)) ;
                                             IF_NONE { PUSH string "NotFound" ; FAILWITH } {} ;
                                             PUSH mutez 0 ;
                                             DIG 4 ;
                                             DUP ;
                                             DUG 5 ;
                                             SELF ;
                                             ADDRESS ;
                                             PAIR ;
                                             SENDER ;
                                             PAIR ;
                                             TRANSFER_TOKENS ;
                                             CONS ;
                                             DIP 1 { DIG 18 ; DROP 1 } ;
                                             DUG 18 ;
                                             DIG 5 ;
                                             DUP ;
                                             DUG 6 ;
                                             DIG 1 ;
                                             DUP ;
                                             DUG 2 ;
                                             MEM ;
                                             IF { PUSH string "KeyExists" ; FAILWITH }
                                                { DIG 5 ;
                                                  DUP ;
                                                  DUG 6 ;
                                                  DIG 2 ;
                                                  DUP ;
                                                  DUG 3 ;
                                                  NOW ;
                                                  PAIR ;
                                                  SENDER ;
                                                  PAIR ;
                                                  SOME ;
                                                  DIG 2 ;
                                                  DUP ;
                                                  DUG 3 ;
                                                  UPDATE ;
                                                  DIP 1 { DIG 5 ; DROP 1 } ;
                                                  DUG 5 } ;
                                             DIG 11 ;
                                             DUP ;
                                             DUG 12 ;
                                             DIG 2 ;
                                             DUP ;
                                             DUG 3 ;
                                             COMPARE ;
                                             GT ;
                                             IF { DIG 1 ;
                                                  DUP ;
                                                  DUG 2 ;
                                                  DIP 1 { DIG 11 ; DROP 1 } ;
                                                  DUG 11 ;
                                                  DUP ;
                                                  SOME ;
                                                  DIP 1 { DIG 6 ; DROP 1 } ;
                                                  DUG 6 }
                                                {} ;
                                             DROP 2 ;
                                             SWAP ;
                                             PAIR ;
                                             SWAP ;
                                             PAIR ;
                                             SWAP ;
                                             PAIR ;
                                             SWAP ;
                                             PAIR ;
                                             SWAP ;
                                             PAIR ;
                                             SWAP ;
                                             PAIR ;
                                             SWAP ;
                                             PAIR ;
                                             SWAP ;
                                             PAIR ;
                                             SWAP ;
                                             PAIR ;
                                             SWAP ;
                                             PAIR ;
                                             SWAP ;
                                             PAIR ;
                                             SWAP ;
                                             PAIR ;
                                             SWAP ;
                                             PAIR ;
                                             SWAP ;
                                             PAIR ;
                                             SWAP ;
                                             PAIR ;
                                             DIG 1 ;
                                             PAIR }
                                           { IF_LEFT
                                               { { { DUP ; CAR ; DIP { CDR } } } ;
                                                 SWAP ;
                                                 { { DUP ; CAR ; DIP { CDR } } } ;
                                                 SWAP ;
                                                 DIG 14 ;
                                                 DUP ;
                                                 DUG 15 ;
                                                 SOURCE ;
                                                 COMPARE ;
                                                 EQ ;
                                                 NOT ;
                                                 IF { PUSH string "InvalidCaller" ; FAILWITH } {} ;
                                                 DIG 5 ;
                                                 DUP ;
                                                 DUG 6 ;
                                                 PUSH nat 1 ;
                                                 COMPARE ;
                                                 NEQ ;
                                                 IF { PUSH string "InvalidState" ; FAILWITH } {} ;
                                                 DIG 10 ;
                                                 DUP ;
                                                 DUG 11 ;
                                                 NOW ;
                                                 COMPARE ;
                                                 LT ;
                                                 NOT ;
                                                 IF { PUSH string "Bid Period Is Over" ; FAILWITH } {} ;
                                                 DIG 11 ;
                                                 DUP ;
                                                 DUG 12 ;
                                                 DIG 1 ;
                                                 DUP ;
                                                 DUG 2 ;
                                                 COMPARE ;
                                                 EQ ;
                                                 DIG 12 ;
                                                 DUP ;
                                                 DUG 13 ;
                                                 DIG 2 ;
                                                 DUP ;
                                                 DUG 3 ;
                                                 COMPARE ;
                                                 LE ;
                                                 DIG 2 ;
                                                 DUP ;
                                                 DUG 3 ;
                                                 DIG 26 ;
                                                 DUP ;
                                                 DUG 27 ;
                                                 DIG 16 ;
                                                 DUP ;
                                                 DUG 17 ;
                                                 DIG 9 ;
                                                 DUP ;
                                                 DUG 10 ;
                                                 PAIR ;
                                                 EXEC ;
                                                 DIG 16 ;
                                                 DUP ;
                                                 DUG 17 ;
                                                 ADD ;
                                                 COMPARE ;
                                                 LE ;
                                                 AND ;
                                                 OR ;
                                                 NOT ;
                                                 IF { PUSH string "Invalid Bid Value" ; FAILWITH } {} ;
                                                 DIG 21 ;
                                                 DUP ;
                                                 DUG 22 ;
                                                 DIG 3 ;
                                                 DUP ;
                                                 DUG 4 ;
                                                 EXEC ;
                                                 NOT ;
                                                 IF { PUSH string "Invalid Payment Type" ; FAILWITH } {} ;
                                                 DIG 19 ;
                                                 DUP ;
                                                 DUG 20 ;
                                                 DIG 16 ;
                                                 DUP ;
                                                 DUG 17 ;
                                                 CONTRACT %transfer (pair address (pair address nat)) ;
                                                 IF_NONE { PUSH string "NotFound" ; FAILWITH } {} ;
                                                 PUSH mutez 0 ;
                                                 DIG 3 ;
                                                 DUP ;
                                                 DUG 4 ;
                                                 SELF ;
                                                 ADDRESS ;
                                                 PAIR ;
                                                 SENDER ;
                                                 PAIR ;
                                                 TRANSFER_TOKENS ;
                                                 CONS ;
                                                 DIP 1 { DIG 19 ; DROP 1 } ;
                                                 DUG 19 ;
                                                 DIG 19 ;
                                                 DUP ;
                                                 DUG 20 ;
                                                 SELF ;
                                                 ADDRESS ;
                                                 CONTRACT %bidInternal (pair (or bytes timestamp) (pair address nat)) ;
                                                 IF_NONE { PUSH string "NotFound" ; FAILWITH } {} ;
                                                 PUSH mutez 0 ;
                                                 DIG 3 ;
                                                 DUP ;
                                                 DUG 4 ;
                                                 DIG 5 ;
                                                 DUP ;
                                                 DUG 6 ;
                                                 PAIR ;
                                                 DIG 6 ;
                                                 DUP ;
                                                 DUG 7 ;
                                                 PAIR ;
                                                 TRANSFER_TOKENS ;
                                                 CONS ;
                                                 DIP 1 { DIG 19 ; DROP 1 } ;
                                                 DUG 19 ;
                                                 DROP 3 ;
                                                 SWAP ;
                                                 PAIR ;
                                                 SWAP ;
                                                 PAIR ;
                                                 SWAP ;
                                                 PAIR ;
                                                 SWAP ;
                                                 PAIR ;
                                                 SWAP ;
                                                 PAIR ;
                                                 SWAP ;
                                                 PAIR ;
                                                 SWAP ;
                                                 PAIR ;
                                                 SWAP ;
                                                 PAIR ;
                                                 SWAP ;
                                                 PAIR ;
                                                 SWAP ;
                                                 PAIR ;
                                                 SWAP ;
                                                 PAIR ;
                                                 SWAP ;
                                                 PAIR ;
                                                 SWAP ;
                                                 PAIR ;
                                                 SWAP ;
                                                 PAIR ;
                                                 SWAP ;
                                                 PAIR ;
                                                 DIG 1 ;
                                                 PAIR }
                                               { IF_LEFT
                                                   { { { DUP ; CAR ; DIP { CDR } } } ;
                                                     SWAP ;
                                                     { { DUP ; CAR ; DIP { CDR } } } ;
                                                     SWAP ;
                                                     DIG 14 ;
                                                     DUP ;
                                                     DUG 15 ;
                                                     SOURCE ;
                                                     COMPARE ;
                                                     EQ ;
                                                     NOT ;
                                                     IF { PUSH string "InvalidCaller" ; FAILWITH } {} ;
                                                     DIG 5 ;
                                                     DUP ;
                                                     DUG 6 ;
                                                     PUSH nat 1 ;
                                                     COMPARE ;
                                                     NEQ ;
                                                     IF { PUSH string "InvalidState" ; FAILWITH } {} ;
                                                     DIG 11 ;
                                                     DUP ;
                                                     DUG 12 ;
                                                     DIG 1 ;
                                                     DUP ;
                                                     DUG 2 ;
                                                     COMPARE ;
                                                     EQ ;
                                                     NOT ;
                                                     IF { PUSH string "r31" ; PUSH string "InvalidCondition" ; PAIR ; FAILWITH } {} ;
                                                     DIG 19 ;
                                                     DUP ;
                                                     DUG 20 ;
                                                     SELF ;
                                                     ADDRESS ;
                                                     CONTRACT %bidAs (pair (or bytes timestamp) (pair address nat)) ;
                                                     IF_NONE { PUSH string "NotFound" ; FAILWITH } {} ;
                                                     PUSH mutez 0 ;
                                                     DIG 3 ;
                                                     DUP ;
                                                     DUG 4 ;
                                                     DIG 5 ;
                                                     DUP ;
                                                     DUG 6 ;
                                                     PAIR ;
                                                     DIG 6 ;
                                                     DUP ;
                                                     DUG 7 ;
                                                     PAIR ;
                                                     TRANSFER_TOKENS ;
                                                     CONS ;
                                                     DIP 1 { DIG 19 ; DROP 1 } ;
                                                     DUG 19 ;
                                                     DROP 3 ;
                                                     SWAP ;
                                                     PAIR ;
                                                     SWAP ;
                                                     PAIR ;
                                                     SWAP ;
                                                     PAIR ;
                                                     SWAP ;
                                                     PAIR ;
                                                     SWAP ;
                                                     PAIR ;
                                                     SWAP ;
                                                     PAIR ;
                                                     SWAP ;
                                                     PAIR ;
                                                     SWAP ;
                                                     PAIR ;
                                                     SWAP ;
                                                     PAIR ;
                                                     SWAP ;
                                                     PAIR ;
                                                     SWAP ;
                                                     PAIR ;
                                                     SWAP ;
                                                     PAIR ;
                                                     SWAP ;
                                                     PAIR ;
                                                     SWAP ;
                                                     PAIR ;
                                                     SWAP ;
                                                     PAIR ;
                                                     DIG 1 ;
                                                     PAIR }
                                                   { IF_LEFT
                                                       { { { DUP ; CAR ; DIP { CDR } } } ;
                                                         SWAP ;
                                                         { { DUP ; CAR ; DIP { CDR } } } ;
                                                         SWAP ;
                                                         DIG 14 ;
                                                         DUP ;
                                                         DUG 15 ;
                                                         SENDER ;
                                                         COMPARE ;
                                                         EQ ;
                                                         NOT ;
                                                         IF { PUSH string "InvalidCaller" ; FAILWITH } {} ;
                                                         DIG 5 ;
                                                         DUP ;
                                                         DUG 6 ;
                                                         PUSH nat 0 ;
                                                         COMPARE ;
                                                         NEQ ;
                                                         IF { PUSH string "InvalidState" ; FAILWITH } {} ;
                                                         DIG 21 ;
                                                         DUP ;
                                                         DUG 22 ;
                                                         DIG 3 ;
                                                         DUP ;
                                                         DUG 4 ;
                                                         EXEC ;
                                                         NOT ;
                                                         IF { PUSH string "Invalid Payment Type" ; FAILWITH } {} ;
                                                         DIG 19 ;
                                                         DUP ;
                                                         DUG 20 ;
                                                         DIG 16 ;
                                                         DUP ;
                                                         DUG 17 ;
                                                         CONTRACT %transfer (pair address (pair address nat)) ;
                                                         IF_NONE { PUSH string "NotFound" ; FAILWITH } {} ;
                                                         PUSH mutez 0 ;
                                                         DIG 3 ;
                                                         DUP ;
                                                         DUG 4 ;
                                                         SELF ;
                                                         ADDRESS ;
                                                         PAIR ;
                                                         DIG 18 ;
                                                         DUP ;
                                                         DUG 19 ;
                                                         PAIR ;
                                                         TRANSFER_TOKENS ;
                                                         CONS ;
                                                         DIP 1 { DIG 19 ; DROP 1 } ;
                                                         DUG 19 ;
                                                         DIG 6 ;
                                                         DUP ;
                                                         DUG 7 ;
                                                         DIG 3 ;
                                                         DUP ;
                                                         DUG 4 ;
                                                         MEM ;
                                                         IF { PUSH string "KeyExists" ; FAILWITH }
                                                            { DIG 6 ;
                                                              DUP ;
                                                              DUG 7 ;
                                                              DIG 1 ;
                                                              DUP ;
                                                              DUG 2 ;
                                                              NOW ;
                                                              PAIR ;
                                                              DIG 3 ;
                                                              DUP ;
                                                              DUG 4 ;
                                                              PAIR ;
                                                              SOME ;
                                                              DIG 4 ;
                                                              DUP ;
                                                              DUG 5 ;
                                                              UPDATE ;
                                                              DIP 1 { DIG 6 ; DROP 1 } ;
                                                              DUG 6 } ;
                                                         DIG 12 ;
                                                         DUP ;
                                                         DUG 13 ;
                                                         DIG 1 ;
                                                         DUP ;
                                                         DUG 2 ;
                                                         COMPARE ;
                                                         GT ;
                                                         IF { DUP ;
                                                              DIP 1 { DIG 12 ; DROP 1 } ;
                                                              DUG 12 ;
                                                              DIG 2 ;
                                                              DUP ;
                                                              DUG 3 ;
                                                              SOME ;
                                                              DIP 1 { DIG 7 ; DROP 1 } ;
                                                              DUG 7 }
                                                            {} ;
                                                         DROP 3 ;
                                                         SWAP ;
                                                         PAIR ;
                                                         SWAP ;
                                                         PAIR ;
                                                         SWAP ;
                                                         PAIR ;
                                                         SWAP ;
                                                         PAIR ;
                                                         SWAP ;
                                                         PAIR ;
                                                         SWAP ;
                                                         PAIR ;
                                                         SWAP ;
                                                         PAIR ;
                                                         SWAP ;
                                                         PAIR ;
                                                         SWAP ;
                                                         PAIR ;
                                                         SWAP ;
                                                         PAIR ;
                                                         SWAP ;
                                                         PAIR ;
                                                         SWAP ;
                                                         PAIR ;
                                                         SWAP ;
                                                         PAIR ;
                                                         SWAP ;
                                                         PAIR ;
                                                         SWAP ;
                                                         PAIR ;
                                                         DIG 1 ;
                                                         PAIR }
                                                       { IF_LEFT
                                                           { { { DUP ; CAR ; DIP { CDR } } } ;
                                                             SWAP ;
                                                             DIG 13 ;
                                                             DUP ;
                                                             DUG 14 ;
                                                             SENDER ;
                                                             COMPARE ;
                                                             EQ ;
                                                             NOT ;
                                                             IF { PUSH string "InvalidCaller" ; FAILWITH } {} ;
                                                             DIG 20 ;
                                                             DUP ;
                                                             DUG 21 ;
                                                             DIG 1 ;
                                                             DUP ;
                                                             DUG 2 ;
                                                             EXEC ;
                                                             NOT ;
                                                             IF { PUSH string "Invalid Payment Type" ; FAILWITH } {} ;
                                                             DIG 5 ;
                                                             DUP ;
                                                             DUG 6 ;
                                                             DIG 1 ;
                                                             DUP ;
                                                             DUG 2 ;
                                                             GET ;
                                                             IF_NONE { PUSH string "NotFound" ; FAILWITH } {} ;
                                                             CDR ;
                                                             CDR ;
                                                             DIG 9 ;
                                                             DUP ;
                                                             DUG 10 ;
                                                             ADD ;
                                                             DIP 1 { DIG 8 ; DROP 1 } ;
                                                             DUG 8 ;
                                                             DIG 5 ;
                                                             DUP ;
                                                             DUG 6 ;
                                                             NONE (pair address (pair timestamp nat)) ;
                                                             DIG 2 ;
                                                             DUP ;
                                                             DUG 3 ;
                                                             UPDATE ;
                                                             DIP 1 { DIG 5 ; DROP 1 } ;
                                                             DUG 5 ;
                                                             PUSH nat 0 ;
                                                             DIG 6 ;
                                                             DUP ;
                                                             DUG 7 ;
                                                             SIZE ;
                                                             COMPARE ;
                                                             EQ ;
                                                             IF { DIG 12 ;
                                                                  DUP ;
                                                                  DUG 13 ;
                                                                  DIP 1 { DIG 11 ; DROP 1 } ;
                                                                  DUG 11 ;
                                                                  NONE (or bytes timestamp) ;
                                                                  DIP 1 { DIG 6 ; DROP 1 } ;
                                                                  DUG 6 }
                                                                { NONE (or bytes timestamp) ;
                                                                  PUSH nat 0 ;
                                                                  PAIR ;
                                                                  NIL (or bytes timestamp) ;
                                                                  DIG 7 ;
                                                                  DUP ;
                                                                  DUG 8 ;
                                                                  ITER { { { DUP ; CAR ; DIP { CDR } } } ;
                                                                         NIL (or bytes timestamp) ;
                                                                         DIG 1 ;
                                                                         DUP ;
                                                                         DUG 2 ;
                                                                         SOME ;
                                                                         PAIR ;
                                                                         DIG 3 ;
                                                                         DUP ;
                                                                         DUG 4 ;
                                                                         ITER { DIG 1 ;
                                                                                DUP ;
                                                                                DUG 2 ;
                                                                                CAR ;
                                                                                DIG 2 ;
                                                                                DUP ;
                                                                                DUG 3 ;
                                                                                CDR ;
                                                                                DIG 1 ;
                                                                                DUP ;
                                                                                DUG 2 ;
                                                                                IF_NONE
                                                                                  { DUP ; DIG 3 ; DUP ; DUG 4 ; CONS ; DIG 2 ; DUP ; DUG 3 ; PAIR }
                                                                                  { PUSH int 0 ;
                                                                                    DIG 15 ;
                                                                                    DUP ;
                                                                                    DUG 16 ;
                                                                                    DIG 5 ;
                                                                                    DUP ;
                                                                                    DUG 6 ;
                                                                                    GET ;
                                                                                    IF_NONE { PUSH string "NotFound" ; FAILWITH } {} ;
                                                                                    DIG 8 ;
                                                                                    DUP ;
                                                                                    DUG 9 ;
                                                                                    CDR ;
                                                                                    CDR ;
                                                                                    DIG 1 ;
                                                                                    DUP ;
                                                                                    DUG 2 ;
                                                                                    CDR ;
                                                                                    CDR ;
                                                                                    COMPARE ;
                                                                                    LT ;
                                                                                    IF { PUSH int 1 } { PUSH int 0 } ;
                                                                                    DIP 1 { DROP 1 } ;
                                                                                    COMPARE ;
                                                                                    GT ;
                                                                                    IF { DIG 1 ;
                                                                                         DUP ;
                                                                                         DUG 2 ;
                                                                                         DIG 6 ;
                                                                                         DUP ;
                                                                                         DUG 7 ;
                                                                                         CONS ;
                                                                                         DIG 4 ;
                                                                                         DUP ;
                                                                                         DUG 5 ;
                                                                                         CONS ;
                                                                                         NONE (or bytes timestamp) ;
                                                                                         PAIR }
                                                                                       { DIG 1 ;
                                                                                         DUP ;
                                                                                         DUG 2 ;
                                                                                         DIG 4 ;
                                                                                         DUP ;
                                                                                         DUG 5 ;
                                                                                         CONS ;
                                                                                         DIG 3 ;
                                                                                         DUP ;
                                                                                         DUG 4 ;
                                                                                         PAIR } ;
                                                                                    SWAP ;
                                                                                    DROP 1 } ;
                                                                                DIP 1 { DROP 1 } ;
                                                                                DIP 1 { DROP 1 } ;
                                                                                DIP 1 { DIG 1 ; DROP 1 } ;
                                                                                DUG 1 ;
                                                                                DROP 1 } ;
                                                                         DUP ;
                                                                         CAR ;
                                                                         DIG 1 ;
                                                                         DUP ;
                                                                         DUG 2 ;
                                                                         CDR ;
                                                                         NIL (or bytes timestamp) ;
                                                                         DIG 2 ;
                                                                         DUP ;
                                                                         DUG 3 ;
                                                                         IF_NONE
                                                                           { DIG 1 ; DUP ; DUG 2 }
                                                                           { DIG 2 ; DUP ; DUG 3 ; DIG 6 ; DUP ; DUG 7 ; CONS ; SWAP ; DROP 1 } ;
                                                                         ITER { DIG 1 ;
                                                                                DUP ;
                                                                                DUG 2 ;
                                                                                DIG 1 ;
                                                                                DUP ;
                                                                                DUG 2 ;
                                                                                CONS ;
                                                                                DIP 1 { DIG 1 ; DROP 1 } ;
                                                                                DUG 1 ;
                                                                                DROP 1 } ;
                                                                         DIP 1 { DROP 1 } ;
                                                                         DIP 1 { DROP 1 } ;
                                                                         DIP 1 { DROP 1 } ;
                                                                         DIP 1 { DIG 2 ; DROP 1 } ;
                                                                         DUG 2 ;
                                                                         DROP 2 } ;
                                                                  ITER { PUSH nat 0 ;
                                                                         DIG 2 ;
                                                                         DUP ;
                                                                         DUG 3 ;
                                                                         CAR ;
                                                                         COMPARE ;
                                                                         EQ ;
                                                                         IF { DUP ; SOME ; PUSH nat 1 ; DIG 3 ; DUP ; DUG 4 ; CAR ; ADD ; PAIR }
                                                                            { DIG 1 ;
                                                                              DUP ;
                                                                              DUG 2 ;
                                                                              CDR ;
                                                                              PUSH nat 1 ;
                                                                              DIG 3 ;
                                                                              DUP ;
                                                                              DUG 4 ;
                                                                              CAR ;
                                                                              ADD ;
                                                                              PAIR } ;
                                                                         DIP 1 { DIG 1 ; DROP 1 } ;
                                                                         DUG 1 ;
                                                                         DROP 1 } ;
                                                                  CDR ;
                                                                  IF_NONE { PUSH string "NotFound" ; FAILWITH } {} ;
                                                                  DIG 6 ;
                                                                  DUP ;
                                                                  DUG 7 ;
                                                                  DIG 1 ;
                                                                  DUP ;
                                                                  DUG 2 ;
                                                                  GET ;
                                                                  IF_NONE { PUSH string "NotFound" ; FAILWITH } {} ;
                                                                  CDR ;
                                                                  CDR ;
                                                                  DIP 1 { DIG 12 ; DROP 1 } ;
                                                                  DUG 12 ;
                                                                  DUP ;
                                                                  SOME ;
                                                                  DIP 1 { DIG 7 ; DROP 1 } ;
                                                                  DUG 7 ;
                                                                  DROP 1 } ;
                                                             DIG 7 ;
                                                             DUP ;
                                                             DUG 8 ;
                                                             NOW ;
                                                             ADD ;
                                                             DIP 1 { DIG 9 ; DROP 1 } ;
                                                             DUG 9 ;
                                                             DROP 2 ;
                                                             SWAP ;
                                                             PAIR ;
                                                             SWAP ;
                                                             PAIR ;
                                                             SWAP ;
                                                             PAIR ;
                                                             SWAP ;
                                                             PAIR ;
                                                             SWAP ;
                                                             PAIR ;
                                                             SWAP ;
                                                             PAIR ;
                                                             SWAP ;
                                                             PAIR ;
                                                             SWAP ;
                                                             PAIR ;
                                                             SWAP ;
                                                             PAIR ;
                                                             SWAP ;
                                                             PAIR ;
                                                             SWAP ;
                                                             PAIR ;
                                                             SWAP ;
                                                             PAIR ;
                                                             SWAP ;
                                                             PAIR ;
                                                             SWAP ;
                                                             PAIR ;
                                                             SWAP ;
                                                             PAIR ;
                                                             DIG 1 ;
                                                             PAIR }
                                                           { IF_LEFT
                                                               { { { DUP ; CAR ; DIP { CDR } } } ;
                                                                 SWAP ;
                                                                 DIG 4 ;
                                                                 DUP ;
                                                                 DUG 5 ;
                                                                 PUSH nat 0 ;
                                                                 COMPARE ;
                                                                 NEQ ;
                                                                 IF { PUSH string "InvalidState" ; FAILWITH } {} ;
                                                                 DIG 16 ;
                                                                 DUP ;
                                                                 DUG 17 ;
                                                                 SOURCE ;
                                                                 PAIR ;
                                                                 DIG 19 ;
                                                                 DUP ;
                                                                 DUG 20 ;
                                                                 DIG 17 ;
                                                                 DUP ;
                                                                 DUG 18 ;
                                                                 CONTRACT %balance_of
                                                                   (pair (list (pair address nat)) (contract (list (pair (pair address nat) nat)))) ;
                                                                 IF_NONE { PUSH string "NotFound" ; FAILWITH } {} ;
                                                                 PUSH mutez 0 ;
                                                                 SELF ;
                                                                 ADDRESS ;
                                                                 CONTRACT %checkowner (list (pair (pair address nat) nat)) ;
                                                                 IF_NONE { PUSH string "NotFound" ; FAILWITH } {} ;
                                                                 NIL (pair (address %owner) (nat %token_id)) ;
                                                                 DIG 5 ;
                                                                 DUP ;
                                                                 DUG 6 ;
                                                                 CONS ;
                                                                 PAIR ;
                                                                 TRANSFER_TOKENS ;
                                                                 CONS ;
                                                                 DIP 1 { DIG 19 ; DROP 1 } ;
                                                                 DUG 19 ;
                                                                 DIG 1 ;
                                                                 DUP ;
                                                                 DUG 2 ;
                                                                 IF_LEFT
                                                                   { DIG 7 ;
                                                                     DUP ;
                                                                     DUG 8 ;
                                                                     DIG 3 ;
                                                                     DUP ;
                                                                     DUG 4 ;
                                                                     GET ;
                                                                     IF_NONE { PUSH string "NotFound" ; FAILWITH } {} ;
                                                                     CDR ;
                                                                     CDR ;
                                                                     DIG 11 ;
                                                                     DUP ;
                                                                     DUG 12 ;
                                                                     ADD ;
                                                                     DIP 1 { DIG 10 ; DROP 1 } ;
                                                                     DUG 10 ;
                                                                     DROP 1 }
                                                                   { DIG 20 ;
                                                                     DUP ;
                                                                     DUG 21 ;
                                                                     DIG 17 ;
                                                                     DUP ;
                                                                     DUG 18 ;
                                                                     CONTRACT %transfer (pair address (pair address nat)) ;
                                                                     IF_NONE { PUSH string "NotFound" ; FAILWITH } {} ;
                                                                     PUSH mutez 0 ;
                                                                     DIG 10 ;
                                                                     DUP ;
                                                                     DUG 11 ;
                                                                     DIG 6 ;
                                                                     DUP ;
                                                                     DUG 7 ;
                                                                     GET ;
                                                                     IF_NONE { PUSH string "NotFound" ; FAILWITH } {} ;
                                                                     CDR ;
                                                                     CDR ;
                                                                     DIG 11 ;
                                                                     DUP ;
                                                                     DUG 12 ;
                                                                     DIG 7 ;
                                                                     DUP ;
                                                                     DUG 8 ;
                                                                     GET ;
                                                                     IF_NONE { PUSH string "NotFound" ; FAILWITH } {} ;
                                                                     CAR ;
                                                                     PAIR ;
                                                                     SELF ;
                                                                     ADDRESS ;
                                                                     PAIR ;
                                                                     TRANSFER_TOKENS ;
                                                                     CONS ;
                                                                     DIP 1 { DIG 20 ; DROP 1 } ;
                                                                     DUG 20 ;
                                                                     DROP 1 } ;
                                                                 DIG 6 ;
                                                                 DUP ;
                                                                 DUG 7 ;
                                                                 NONE (pair address (pair timestamp nat)) ;
                                                                 DIG 3 ;
                                                                 DUP ;
                                                                 DUG 4 ;
                                                                 UPDATE ;
                                                                 DIP 1 { DIG 6 ; DROP 1 } ;
                                                                 DUG 6 ;
                                                                 DIG 20 ;
                                                                 DUP ;
                                                                 DUG 21 ;
                                                                 DIG 7 ;
                                                                 DUP ;
                                                                 DUG 8 ;
                                                                 EXEC ;
                                                                 DIP 1 { DIG 7 ; DROP 1 } ;
                                                                 DUG 7 ;
                                                                 DIG 7 ;
                                                                 DUP ;
                                                                 DUG 8 ;
                                                                 IF_NONE
                                                                   { PUSH nat 0 }
                                                                   { DIG 7 ;
                                                                     DUP ;
                                                                     DUG 8 ;
                                                                     DIG 1 ;
                                                                     DUP ;
                                                                     DUG 2 ;
                                                                     GET ;
                                                                     IF_NONE { PUSH string "NotFound" ; FAILWITH } {} ;
                                                                     CDR ;
                                                                     CDR ;
                                                                     SWAP ;
                                                                     DROP 1 } ;
                                                                 DIP 1 { DIG 12 ; DROP 1 } ;
                                                                 DUG 12 ;
                                                                 DROP 3 ;
                                                                 SWAP ;
                                                                 PAIR ;
                                                                 SWAP ;
                                                                 PAIR ;
                                                                 SWAP ;
                                                                 PAIR ;
                                                                 SWAP ;
                                                                 PAIR ;
                                                                 SWAP ;
                                                                 PAIR ;
                                                                 SWAP ;
                                                                 PAIR ;
                                                                 SWAP ;
                                                                 PAIR ;
                                                                 SWAP ;
                                                                 PAIR ;
                                                                 SWAP ;
                                                                 PAIR ;
                                                                 SWAP ;
                                                                 PAIR ;
                                                                 SWAP ;
                                                                 PAIR ;
                                                                 SWAP ;
                                                                 PAIR ;
                                                                 SWAP ;
                                                                 PAIR ;
                                                                 SWAP ;
                                                                 PAIR ;
                                                                 SWAP ;
                                                                 PAIR ;
                                                                 DIG 1 ;
                                                                 PAIR }
                                                               { IF_LEFT
                                                                   { { { DUP ; CAR ; DIP { CDR } } } ;
                                                                     SWAP ;
                                                                     SELF ;
                                                                     ADDRESS ;
                                                                     SENDER ;
                                                                     COMPARE ;
                                                                     EQ ;
                                                                     NOT ;
                                                                     IF { PUSH string "InvalidCaller" ; FAILWITH } {} ;
                                                                     DIG 5 ;
                                                                     DUP ;
                                                                     DUG 6 ;
                                                                     DIG 1 ;
                                                                     DUP ;
                                                                     DUG 2 ;
                                                                     GET ;
                                                                     IF_NONE { PUSH string "NotFound" ; FAILWITH } {} ;
                                                                     CDR ;
                                                                     CDR ;
                                                                     DIG 6 ;
                                                                     DUP ;
                                                                     DUG 7 ;
                                                                     DIG 2 ;
                                                                     DUP ;
                                                                     DUG 3 ;
                                                                     GET ;
                                                                     IF_NONE { PUSH string "NotFound" ; FAILWITH } {} ;
                                                                     CAR ;
                                                                     DIG 20 ;
                                                                     DUP ;
                                                                     DUG 21 ;
                                                                     SELF ;
                                                                     ADDRESS ;
                                                                     CONTRACT %clearBids unit ;
                                                                     IF_NONE { PUSH string "NotFound" ; FAILWITH } {} ;
                                                                     PUSH mutez 0 ;
                                                                     UNIT ;
                                                                     TRANSFER_TOKENS ;
                                                                     CONS ;
                                                                     DIP 1 { DIG 20 ; DROP 1 } ;
                                                                     DUG 20 ;
                                                                     DIG 20 ;
                                                                     DUP ;
                                                                     DUG 21 ;
                                                                     DIG 18 ;
                                                                     DUP ;
                                                                     DUG 19 ;
                                                                     CONTRACT %exchange (pair nat (pair nat (pair address address))) ;
                                                                     IF_NONE { PUSH string "NotFound" ; FAILWITH } {} ;
                                                                     PUSH mutez 0 ;
                                                                     DIG 3 ;
                                                                     DUP ;
                                                                     DUG 4 ;
                                                                     DIG 7 ;
                                                                     DUP ;
                                                                     DUG 8 ;
                                                                     PAIR ;
                                                                     DIG 5 ;
                                                                     DUP ;
                                                                     DUG 6 ;
                                                                     PAIR ;
                                                                     DIG 22 ;
                                                                     DUP ;
                                                                     DUG 23 ;
                                                                     PAIR ;
                                                                     TRANSFER_TOKENS ;
                                                                     CONS ;
                                                                     DIP 1 { DIG 20 ; DROP 1 } ;
                                                                     DUG 20 ;
                                                                     DIG 20 ;
                                                                     DUP ;
                                                                     DUG 21 ;
                                                                     DIG 17 ;
                                                                     DUP ;
                                                                     DUG 18 ;
                                                                     CONTRACT %approve (pair address nat) ;
                                                                     IF_NONE { PUSH string "NotFound" ; FAILWITH } {} ;
                                                                     PUSH mutez 0 ;
                                                                     DIG 4 ;
                                                                     DUP ;
                                                                     DUG 5 ;
                                                                     DIG 21 ;
                                                                     DUP ;
                                                                     DUG 22 ;
                                                                     PAIR ;
                                                                     TRANSFER_TOKENS ;
                                                                     CONS ;
                                                                     DIP 1 { DIG 20 ; DROP 1 } ;
                                                                     DUG 20 ;
                                                                     DIG 7 ;
                                                                     DUP ;
                                                                     DUG 8 ;
                                                                     NONE (pair address (pair timestamp nat)) ;
                                                                     DIG 4 ;
                                                                     DUP ;
                                                                     DUG 5 ;
                                                                     UPDATE ;
                                                                     DIP 1 { DIG 7 ; DROP 1 } ;
                                                                     DUG 7 ;
                                                                     DUP ;
                                                                     DIP 1 { DIG 19 ; DROP 1 } ;
                                                                     DUG 19 ;
                                                                     PUSH nat 0 ;
                                                                     DIP 1 { DIG 13 ; DROP 1 } ;
                                                                     DUG 13 ;
                                                                     DROP 4 ;
                                                                     SWAP ;
                                                                     PAIR ;
                                                                     SWAP ;
                                                                     PAIR ;
                                                                     SWAP ;
                                                                     PAIR ;
                                                                     SWAP ;
                                                                     PAIR ;
                                                                     SWAP ;
                                                                     PAIR ;
                                                                     SWAP ;
                                                                     PAIR ;
                                                                     SWAP ;
                                                                     PAIR ;
                                                                     SWAP ;
                                                                     PAIR ;
                                                                     SWAP ;
                                                                     PAIR ;
                                                                     SWAP ;
                                                                     PAIR ;
                                                                     SWAP ;
                                                                     PAIR ;
                                                                     SWAP ;
                                                                     PAIR ;
                                                                     SWAP ;
                                                                     PAIR ;
                                                                     SWAP ;
                                                                     PAIR ;
                                                                     SWAP ;
                                                                     PAIR ;
                                                                     DIG 1 ;
                                                                     PAIR }
                                                                   { IF_LEFT
                                                                       { { { DUP ; CAR ; DIP { CDR } } } ;
                                                                         SWAP ;
                                                                         DIG 18 ;
                                                                         DUP ;
                                                                         DUG 19 ;
                                                                         SELF ;
                                                                         ADDRESS ;
                                                                         CONTRACT %acceptInternal (pair address (or bytes timestamp)) ;
                                                                         IF_NONE { PUSH string "NotFound" ; FAILWITH } {} ;
                                                                         PUSH mutez 0 ;
                                                                         DIG 3 ;
                                                                         DUP ;
                                                                         DUG 4 ;
                                                                         SOURCE ;
                                                                         PAIR ;
                                                                         TRANSFER_TOKENS ;
                                                                         CONS ;
                                                                         DIP 1 { DIG 18 ; DROP 1 } ;
                                                                         DUG 18 ;
                                                                         DIG 16 ;
                                                                         DUP ;
                                                                         DUG 17 ;
                                                                         DIG 16 ;
                                                                         DUP ;
                                                                         DUG 17 ;
                                                                         PAIR ;
                                                                         SOURCE ;
                                                                         PAIR ;
                                                                         DIG 19 ;
                                                                         DUP ;
                                                                         DUG 20 ;
                                                                         DIG 17 ;
                                                                         DUP ;
                                                                         DUG 18 ;
                                                                         CONTRACT %update_operators
                                                                           (list (or (pair address (pair address nat)) (pair address (pair address nat)))) ;
                                                                         IF_NONE { PUSH string "NotFound" ; FAILWITH } {} ;
                                                                         PUSH mutez 0 ;
                                                                         NIL (or (pair (address %owner) (pair (address %operator) (nat %token_id)))
                                                                                 (pair (address %owner) (pair (address %operator) (nat %token_id)))) ;
                                                                         DIG 4 ;
                                                                         DUP ;
                                                                         DUG 5 ;
                                                                         LEFT (pair address (pair address nat)) ;
                                                                         CONS ;
                                                                         TRANSFER_TOKENS ;
                                                                         CONS ;
                                                                         DIP 1 { DIG 19 ; DROP 1 } ;
                                                                         DUG 19 ;
                                                                         DROP 3 ;
                                                                         SWAP ;
                                                                         PAIR ;
                                                                         SWAP ;
                                                                         PAIR ;
                                                                         SWAP ;
                                                                         PAIR ;
                                                                         SWAP ;
                                                                         PAIR ;
                                                                         SWAP ;
                                                                         PAIR ;
                                                                         SWAP ;
                                                                         PAIR ;
                                                                         SWAP ;
                                                                         PAIR ;
                                                                         SWAP ;
                                                                         PAIR ;
                                                                         SWAP ;
                                                                         PAIR ;
                                                                         SWAP ;
                                                                         PAIR ;
                                                                         SWAP ;
                                                                         PAIR ;
                                                                         SWAP ;
                                                                         PAIR ;
                                                                         SWAP ;
                                                                         PAIR ;
                                                                         SWAP ;
                                                                         PAIR ;
                                                                         SWAP ;
                                                                         PAIR ;
                                                                         DIG 1 ;
                                                                         PAIR }
                                                                       { IF_LEFT
                                                                           { DROP 1 ;
                                                                             DIG 11 ;
                                                                             DUP ;
                                                                             DUG 12 ;
                                                                             SENDER ;
                                                                             COMPARE ;
                                                                             EQ ;
                                                                             NOT ;
                                                                             IF { PUSH string "InvalidCaller" ; FAILWITH } {} ;
                                                                             DIG 7 ;
                                                                             DUP ;
                                                                             DUG 8 ;
                                                                             NOW ;
                                                                             COMPARE ;
                                                                             GT ;
                                                                             NOT ;
                                                                             IF { PUSH string "Bid Period Is Still On" ; FAILWITH } {} ;
                                                                             DIG 2 ;
                                                                             DUP ;
                                                                             DUG 3 ;
                                                                             DUP ;
                                                                             PUSH nat 1 ;
                                                                             COMPARE ;
                                                                             EQ ;
                                                                             IF { DIG 5 ;
                                                                                  DUP ;
                                                                                  DUG 6 ;
                                                                                  IF_NONE
                                                                                    {}
                                                                                    { DIG 18 ;
                                                                                      DUP ;
                                                                                      DUG 19 ;
                                                                                      SELF ;
                                                                                      ADDRESS ;
                                                                                      CONTRACT %acceptInternal (pair address (or bytes timestamp)) ;
                                                                                      IF_NONE { PUSH string "NotFound" ; FAILWITH } {} ;
                                                                                      PUSH mutez 0 ;
                                                                                      DIG 3 ;
                                                                                      DUP ;
                                                                                      DUG 4 ;
                                                                                      DIG 21 ;
                                                                                      DUP ;
                                                                                      DUG 22 ;
                                                                                      PAIR ;
                                                                                      TRANSFER_TOKENS ;
                                                                                      CONS ;
                                                                                      DIP 1 { DIG 18 ; DROP 1 } ;
                                                                                      DUG 18 ;
                                                                                      DROP 1 } ;
                                                                                  PUSH nat 0 ;
                                                                                  DIP 1 { DIG 3 ; DROP 1 } ;
                                                                                  DUG 3 }
                                                                                { PUSH string "InvalidState" ; FAILWITH } ;
                                                                             DROP 1 ;
                                                                             SWAP ;
                                                                             PAIR ;
                                                                             SWAP ;
                                                                             PAIR ;
                                                                             SWAP ;
                                                                             PAIR ;
                                                                             SWAP ;
                                                                             PAIR ;
                                                                             SWAP ;
                                                                             PAIR ;
                                                                             SWAP ;
                                                                             PAIR ;
                                                                             SWAP ;
                                                                             PAIR ;
                                                                             SWAP ;
                                                                             PAIR ;
                                                                             SWAP ;
                                                                             PAIR ;
                                                                             SWAP ;
                                                                             PAIR ;
                                                                             SWAP ;
                                                                             PAIR ;
                                                                             SWAP ;
                                                                             PAIR ;
                                                                             SWAP ;
                                                                             PAIR ;
                                                                             SWAP ;
                                                                             PAIR ;
                                                                             SWAP ;
                                                                             PAIR ;
                                                                             DIG 1 ;
                                                                             PAIR }
                                                                           { DROP 1 ;
                                                                             DIG 11 ;
                                                                             DUP ;
                                                                             DUG 12 ;
                                                                             SENDER ;
                                                                             COMPARE ;
                                                                             EQ ;
                                                                             NOT ;
                                                                             IF { PUSH string "InvalidCaller" ; FAILWITH } {} ;
                                                                             DIG 7 ;
                                                                             DUP ;
                                                                             DUG 8 ;
                                                                             NOW ;
                                                                             COMPARE ;
                                                                             GT ;
                                                                             NOT ;
                                                                             IF { PUSH string "Bid Period Is Still On" ; FAILWITH } {} ;
                                                                             PUSH nat 0 ;
                                                                             DIG 4 ;
                                                                             DUP ;
                                                                             DUG 5 ;
                                                                             SIZE ;
                                                                             COMPARE ;
                                                                             EQ ;
                                                                             NOT ;
                                                                             IF { PUSH string "Bids is not empty" ; FAILWITH } {} ;
                                                                             DIG 2 ;
                                                                             DUP ;
                                                                             DUG 3 ;
                                                                             DUP ;
                                                                             PUSH nat 1 ;
                                                                             COMPARE ;
                                                                             EQ ;
                                                                             IF { PUSH nat 0 ; DIP 1 { DIG 3 ; DROP 1 } ; DUG 3 }
                                                                                { PUSH string "InvalidState" ; FAILWITH } ;
                                                                             DROP 1 ;
                                                                             SWAP ;
                                                                             PAIR ;
                                                                             SWAP ;
                                                                             PAIR ;
                                                                             SWAP ;
                                                                             PAIR ;
                                                                             SWAP ;
                                                                             PAIR ;
                                                                             SWAP ;
                                                                             PAIR ;
                                                                             SWAP ;
                                                                             PAIR ;
                                                                             SWAP ;
                                                                             PAIR ;
                                                                             SWAP ;
                                                                             PAIR ;
                                                                             SWAP ;
                                                                             PAIR ;
                                                                             SWAP ;
                                                                             PAIR ;
                                                                             SWAP ;
                                                                             PAIR ;
                                                                             SWAP ;
                                                                             PAIR ;
                                                                             SWAP ;
                                                                             PAIR ;
                                                                             SWAP ;
                                                                             PAIR ;
                                                                             SWAP ;
                                                                             PAIR ;
                                                                             DIG 1 ;
                                                                             PAIR } } } } } } } } } } } } } } } } } ;
         DIP 1 { DROP 4 } } }
