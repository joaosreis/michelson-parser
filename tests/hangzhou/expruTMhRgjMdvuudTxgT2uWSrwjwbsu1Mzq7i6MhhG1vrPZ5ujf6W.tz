{ storage
    (pair (pair (pair (address %admin) (pair (big_map %balance address nat) (nat %current_ticket)))
                (pair (pair (big_map %house_pool address (pair (nat %amount) (bool %auto_withdraw)))
                            (nat %house_pool_amount))
                      (pair (set %house_pool_indexes address) (int %last_house_pool_diff))))
          (pair (pair (map %last_winner address nat)
                      (pair (big_map %metadata string bytes) (address %operator)))
                (pair (pair (bool %pick_lottery_permission)
                            (big_map %player_pool nat (pair (nat %amount) (map %players address nat))))
                      (pair (address %token_address) (bool %withdraw_permission))))) ;
  parameter
    (or (or (or (nat %deposit) (bool %grant_pick_lottery_permission))
            (or (bool %grant_withdraw_permission)
                (pair %house_deposit (nat %amount) (bool %auto_withdraw))))
        (or (or (unit %house_withdraw) (nat %oracle))
            (or (pair %player_pick_lottery (nat %amount) (list %tickets nat))
                (or (address %update_operator) (nat %withdraw))))) ;
  code { CAST (pair (or (or (or nat bool) (or bool (pair nat bool)))
                        (or (or unit nat) (or (pair nat (list nat)) (or address nat))))
                    (pair (pair (pair address (pair (big_map address nat) nat))
                                (pair (pair (big_map address (pair nat bool)) nat) (pair (set address) int)))
                          (pair (pair (map address nat) (pair (big_map string bytes) address))
                                (pair (pair bool (big_map nat (pair nat (map address nat)))) (pair address bool))))) ;
         UNPAIR ;
         IF_LEFT
           { IF_LEFT
               { IF_LEFT
                   { DUP ;
                     PUSH nat 0 ;
                     COMPARE ;
                     LT ;
                     IF {} { PUSH string "INVALID INPUT" ; FAILWITH } ;
                     NIL operation ;
                     DUP 3 ;
                     GET 7 ;
                     CONTRACT %transfer (list (pair address (list (pair address (pair nat nat))))) ;
                     IF_NONE { PUSH int 26 ; FAILWITH } {} ;
                     PUSH mutez 0 ;
                     NIL (pair address (list (pair address (pair nat nat)))) ;
                     NIL (pair address (pair nat nat)) ;
                     DUP 6 ;
                     PUSH nat 0 ;
                     SELF_ADDRESS ;
                     PAIR 3 ;
                     CONS ;
                     SENDER ;
                     PAIR ;
                     CONS ;
                     TRANSFER_TOKENS ;
                     CONS ;
                     DUP 3 ;
                     CAR ;
                     CAR ;
                     GET 3 ;
                     SENDER ;
                     MEM ;
                     IF { DIG 2 ;
                          UNPAIR ;
                          UNPAIR ;
                          UNPAIR ;
                          SWAP ;
                          UNPAIR ;
                          DUP ;
                          SENDER ;
                          DUP ;
                          DUG 2 ;
                          GET ;
                          IF_NONE { PUSH int 100 ; FAILWITH } {} ;
                          DIG 8 ;
                          ADD ;
                          SOME ;
                          SWAP ;
                          UPDATE ;
                          PAIR ;
                          SWAP ;
                          PAIR ;
                          PAIR ;
                          PAIR ;
                          SWAP }
                        { DIG 2 ;
                          UNPAIR ;
                          UNPAIR ;
                          UNPAIR ;
                          SWAP ;
                          UNPAIR ;
                          DIG 6 ;
                          SOME ;
                          SENDER ;
                          UPDATE ;
                          PAIR ;
                          SWAP ;
                          PAIR ;
                          PAIR ;
                          PAIR ;
                          SWAP } }
                   { SWAP ;
                     DUP ;
                     DUG 2 ;
                     GET 3 ;
                     GET 4 ;
                     SENDER ;
                     COMPARE ;
                     EQ ;
                     IF { PUSH bool True }
                        { SWAP ; DUP ; DUG 2 ; CAR ; CAR ; CAR ; SENDER ; COMPARE ; EQ } ;
                     IF {} { PUSH string "ADMIN REQUIRED" ; FAILWITH } ;
                     SWAP ;
                     UNPAIR ;
                     SWAP ;
                     UNPAIR ;
                     SWAP ;
                     UNPAIR ;
                     CDR ;
                     DIG 4 ;
                     PAIR ;
                     PAIR ;
                     SWAP ;
                     PAIR ;
                     SWAP ;
                     PAIR ;
                     NIL operation } }
               { IF_LEFT
                   { SWAP ;
                     DUP ;
                     DUG 2 ;
                     GET 3 ;
                     GET 4 ;
                     SENDER ;
                     COMPARE ;
                     EQ ;
                     IF { PUSH bool True }
                        { SWAP ; DUP ; DUG 2 ; CAR ; CAR ; CAR ; SENDER ; COMPARE ; EQ } ;
                     IF {} { PUSH string "ADMIN REQUIRED" ; FAILWITH } ;
                     UPDATE 8 }
                   { DUP ;
                     CAR ;
                     PUSH nat 0 ;
                     COMPARE ;
                     LT ;
                     IF { SWAP ; DUP ; DUG 2 ; CAR ; CAR ; GET 3 ; SENDER ; MEM }
                        { PUSH bool False } ;
                     IF { SWAP ;
                          DUP ;
                          DUG 2 ;
                          CAR ;
                          CAR ;
                          GET 3 ;
                          SENDER ;
                          GET ;
                          IF_NONE { PUSH int 116 ; FAILWITH } {} ;
                          SWAP ;
                          DUP ;
                          DUG 2 ;
                          CAR ;
                          COMPARE ;
                          LE }
                        { PUSH bool False } ;
                     IF {} { PUSH string "DEPOSIT REQUIRED" ; FAILWITH } ;
                     SWAP ;
                     DUP ;
                     DUG 2 ;
                     UNPAIR ;
                     UNPAIR ;
                     UNPAIR ;
                     SWAP ;
                     UNPAIR ;
                     DUP 6 ;
                     CAR ;
                     DIG 7 ;
                     CAR ;
                     CAR ;
                     GET 3 ;
                     SENDER ;
                     GET ;
                     IF_NONE { PUSH int 118 ; FAILWITH } {} ;
                     SUB ;
                     ISNAT ;
                     IF_NONE { PUSH int 118 ; FAILWITH } {} ;
                     SOME ;
                     SENDER ;
                     UPDATE ;
                     PAIR ;
                     SWAP ;
                     PAIR ;
                     PAIR ;
                     PAIR ;
                     DUP ;
                     DUG 2 ;
                     CAR ;
                     GET 3 ;
                     CAR ;
                     SENDER ;
                     MEM ;
                     IF { SWAP ;
                          UNPAIR ;
                          UNPAIR ;
                          SWAP ;
                          UNPAIR ;
                          UNPAIR ;
                          DUP ;
                          SENDER ;
                          DUP ;
                          DUG 2 ;
                          GET ;
                          IF_NONE { PUSH int 121 ; FAILWITH } {} ;
                          DUP ;
                          CAR ;
                          DUP 9 ;
                          CAR ;
                          ADD ;
                          UPDATE 1 ;
                          SOME ;
                          SWAP ;
                          UPDATE ;
                          DUP ;
                          SENDER ;
                          DUP ;
                          DUG 2 ;
                          GET ;
                          IF_NONE { PUSH int 122 ; FAILWITH } {} ;
                          DUP 8 ;
                          CDR ;
                          UPDATE 2 ;
                          SOME ;
                          SWAP ;
                          UPDATE ;
                          PAIR ;
                          PAIR ;
                          SWAP ;
                          PAIR ;
                          PAIR ;
                          SWAP }
                        { SWAP ;
                          UNPAIR ;
                          UNPAIR ;
                          SWAP ;
                          UNPAIR ;
                          UNPAIR ;
                          DIG 5 ;
                          DUP ;
                          CDR ;
                          SWAP ;
                          DUP ;
                          DUG 7 ;
                          CAR ;
                          PAIR ;
                          SOME ;
                          SENDER ;
                          UPDATE ;
                          PAIR ;
                          PAIR ;
                          SWAP ;
                          PAIR ;
                          PAIR ;
                          SWAP } ;
                     SWAP ;
                     UNPAIR ;
                     UNPAIR ;
                     SWAP ;
                     UNPAIR ;
                     UNPAIR ;
                     SWAP ;
                     DIG 5 ;
                     CAR ;
                     ADD ;
                     SWAP ;
                     PAIR ;
                     PAIR ;
                     SWAP ;
                     PAIR ;
                     PAIR ;
                     DUP ;
                     CAR ;
                     GET 5 ;
                     SENDER ;
                     MEM ;
                     IF {}
                        { UNPAIR ;
                          UNPAIR ;
                          SWAP ;
                          UNPAIR ;
                          SWAP ;
                          UNPAIR ;
                          PUSH bool True ;
                          SENDER ;
                          UPDATE ;
                          PAIR ;
                          SWAP ;
                          PAIR ;
                          SWAP ;
                          PAIR ;
                          PAIR } } ;
                 NIL operation } }
           { IF_LEFT
               { IF_LEFT
                   { DROP ;
                     DUP ;
                     CAR ;
                     GET 3 ;
                     CAR ;
                     SENDER ;
                     MEM ;
                     IF { DUP ; GET 8 } { PUSH bool False } ;
                     IF {} { PUSH string "INVALID HOUSE POOL BALANCE" ; FAILWITH } ;
                     DUP ;
                     UNPAIR ;
                     UNPAIR ;
                     UNPAIR ;
                     SWAP ;
                     UNPAIR ;
                     DUP ;
                     SENDER ;
                     DUP ;
                     DUG 2 ;
                     GET ;
                     IF_NONE { PUSH int 139 ; FAILWITH } {} ;
                     DIG 7 ;
                     CAR ;
                     GET 3 ;
                     CAR ;
                     SENDER ;
                     GET ;
                     IF_NONE { PUSH int 139 ; FAILWITH } {} ;
                     CAR ;
                     ADD ;
                     SOME ;
                     SWAP ;
                     UPDATE ;
                     PAIR ;
                     SWAP ;
                     PAIR ;
                     PAIR ;
                     PAIR ;
                     DUP ;
                     UNPAIR ;
                     UNPAIR ;
                     SWAP ;
                     UNPAIR ;
                     CAR ;
                     DUP 5 ;
                     CAR ;
                     GET 3 ;
                     CAR ;
                     SENDER ;
                     GET ;
                     IF_NONE { PUSH int 140 ; FAILWITH } {} ;
                     CAR ;
                     DIG 5 ;
                     CAR ;
                     GET 3 ;
                     CDR ;
                     SUB ;
                     ISNAT ;
                     IF_NONE { PUSH int 140 ; FAILWITH } {} ;
                     SWAP ;
                     DUP ;
                     SENDER ;
                     DUP ;
                     DUG 2 ;
                     GET ;
                     IF_NONE { PUSH int 141 ; FAILWITH } {} ;
                     PUSH nat 0 ;
                     UPDATE 1 ;
                     SOME ;
                     SWAP ;
                     UPDATE ;
                     PAIR ;
                     SWAP ;
                     UNPAIR ;
                     PUSH bool False ;
                     SENDER ;
                     UPDATE ;
                     PAIR ;
                     SWAP ;
                     PAIR ;
                     SWAP ;
                     PAIR ;
                     PAIR }
                   { SWAP ;
                     DUP ;
                     DUG 2 ;
                     GET 3 ;
                     GET 4 ;
                     SENDER ;
                     COMPARE ;
                     EQ ;
                     IF { DUP ; PUSH nat 0 ; SWAP ; COMPARE ; GE } { PUSH bool False } ;
                     IF { DUP ; PUSH nat 100 ; COMPARE ; GT } { PUSH bool False } ;
                     IF {} { PUSH string "WRONG TICKET" ; FAILWITH } ;
                     SWAP ;
                     UNPAIR ;
                     UNPAIR ;
                     UNPAIR ;
                     SWAP ;
                     CAR ;
                     DUP 5 ;
                     SWAP ;
                     PAIR ;
                     SWAP ;
                     PAIR ;
                     PAIR ;
                     PAIR ;
                     DUP ;
                     DUG 2 ;
                     CAR ;
                     GET 3 ;
                     CDR ;
                     DIG 2 ;
                     UNPAIR ;
                     UNPAIR ;
                     SWAP ;
                     UNPAIR ;
                     SWAP ;
                     CAR ;
                     PUSH int 0 ;
                     SWAP ;
                     PAIR ;
                     SWAP ;
                     PAIR ;
                     SWAP ;
                     PAIR ;
                     PAIR ;
                     DUG 2 ;
                     PUSH nat 0 ;
                     PUSH bool True ;
                     LOOP { DUP 3 ;
                            SWAP ;
                            DUP ;
                            DUG 2 ;
                            COMPARE ;
                            EQ ;
                            IF { DUP 4 ;
                                 GET 5 ;
                                 CDR ;
                                 SWAP ;
                                 DUP ;
                                 DUG 2 ;
                                 MEM ;
                                 IF { DUP 4 ;
                                      GET 5 ;
                                      CDR ;
                                      SWAP ;
                                      DUP ;
                                      DUG 2 ;
                                      GET ;
                                      IF_NONE { PUSH int 181 ; FAILWITH } {} ;
                                      CDR ;
                                      ITER { DIG 4 ;
                                             UNPAIR ;
                                             UNPAIR ;
                                             UNPAIR ;
                                             SWAP ;
                                             UNPAIR ;
                                             DUP ;
                                             DUP 7 ;
                                             CAR ;
                                             DUP ;
                                             DUG 2 ;
                                             GET ;
                                             IF_NONE { PUSH int 182 ; FAILWITH } {} ;
                                             PUSH int 71 ;
                                             DIG 8 ;
                                             CDR ;
                                             INT ;
                                             MUL ;
                                             ISNAT ;
                                             IF_NONE { PUSH int 182 ; FAILWITH } {} ;
                                             ADD ;
                                             SOME ;
                                             SWAP ;
                                             UPDATE ;
                                             PAIR ;
                                             SWAP ;
                                             PAIR ;
                                             PAIR ;
                                             PAIR ;
                                             DUG 3 } ;
                                      DUP 4 ;
                                      UNPAIR ;
                                      UNPAIR ;
                                      SWAP ;
                                      UNPAIR ;
                                      CAR ;
                                      DUP 8 ;
                                      GET 5 ;
                                      CDR ;
                                      DUP 6 ;
                                      GET ;
                                      IF_NONE { PUSH int 184 ; FAILWITH } {} ;
                                      CAR ;
                                      PUSH nat 70 ;
                                      MUL ;
                                      DIG 8 ;
                                      CAR ;
                                      GET 3 ;
                                      CDR ;
                                      SUB ;
                                      ISNAT ;
                                      IF_NONE { PUSH int 184 ; FAILWITH } {} ;
                                      SWAP ;
                                      PAIR ;
                                      PAIR ;
                                      SWAP ;
                                      PAIR ;
                                      PAIR ;
                                      DUP ;
                                      DUG 4 ;
                                      UNPAIR ;
                                      UNPAIR ;
                                      SWAP ;
                                      UNPAIR ;
                                      SWAP ;
                                      UNPAIR ;
                                      SWAP ;
                                      DIG 8 ;
                                      GET 5 ;
                                      CDR ;
                                      DUP 7 ;
                                      GET ;
                                      IF_NONE { PUSH int 186 ; FAILWITH } {} ;
                                      CAR ;
                                      PUSH nat 70 ;
                                      MUL ;
                                      INT ;
                                      SWAP ;
                                      SUB ;
                                      SWAP ;
                                      PAIR ;
                                      SWAP ;
                                      PAIR ;
                                      SWAP ;
                                      PAIR ;
                                      SWAP ;
                                      UNPAIR ;
                                      SWAP ;
                                      UNPAIR ;
                                      UNPAIR ;
                                      SWAP ;
                                      DUP ;
                                      DUP 7 ;
                                      DUP ;
                                      DUG 2 ;
                                      GET ;
                                      IF_NONE { PUSH int 188 ; FAILWITH } {} ;
                                      PUSH nat 0 ;
                                      UPDATE 1 ;
                                      SOME ;
                                      SWAP ;
                                      UPDATE ;
                                      SWAP ;
                                      PAIR ;
                                      PAIR ;
                                      SWAP ;
                                      PAIR ;
                                      SWAP ;
                                      PAIR ;
                                      DUP ;
                                      DUG 4 ;
                                      UNPAIR ;
                                      SWAP ;
                                      UNPAIR ;
                                      CDR ;
                                      DIG 6 ;
                                      GET 5 ;
                                      CDR ;
                                      DUP 5 ;
                                      GET ;
                                      IF_NONE { PUSH int 189 ; FAILWITH } {} ;
                                      CDR ;
                                      PAIR ;
                                      SWAP ;
                                      UNPAIR ;
                                      UNPAIR ;
                                      SWAP ;
                                      DUP ;
                                      DUP 7 ;
                                      DUP ;
                                      DUG 2 ;
                                      GET ;
                                      IF_NONE { PUSH int 190 ; FAILWITH } {} ;
                                      EMPTY_MAP address nat ;
                                      UPDATE 2 ;
                                      SOME ;
                                      SWAP ;
                                      UPDATE ;
                                      SWAP ;
                                      PAIR ;
                                      PAIR ;
                                      SWAP ;
                                      PAIR ;
                                      SWAP ;
                                      PAIR ;
                                      DUG 3 }
                                    { DIG 3 ;
                                      UNPAIR ;
                                      SWAP ;
                                      UNPAIR ;
                                      CDR ;
                                      EMPTY_MAP address nat ;
                                      PAIR ;
                                      PAIR ;
                                      SWAP ;
                                      PAIR ;
                                      DUG 3 } }
                               { DUP 4 ;
                                 GET 5 ;
                                 CDR ;
                                 SWAP ;
                                 DUP ;
                                 DUG 2 ;
                                 MEM ;
                                 IF { DUP 4 ;
                                      UNPAIR ;
                                      UNPAIR ;
                                      SWAP ;
                                      UNPAIR ;
                                      UNPAIR ;
                                      SWAP ;
                                      DIG 8 ;
                                      GET 5 ;
                                      CDR ;
                                      DUP 7 ;
                                      GET ;
                                      IF_NONE { PUSH int 196 ; FAILWITH } {} ;
                                      CAR ;
                                      ADD ;
                                      SWAP ;
                                      PAIR ;
                                      PAIR ;
                                      SWAP ;
                                      PAIR ;
                                      PAIR ;
                                      DUP ;
                                      DUG 4 ;
                                      UNPAIR ;
                                      UNPAIR ;
                                      SWAP ;
                                      UNPAIR ;
                                      SWAP ;
                                      UNPAIR ;
                                      SWAP ;
                                      DIG 8 ;
                                      GET 5 ;
                                      CDR ;
                                      DUP 7 ;
                                      GET ;
                                      IF_NONE { PUSH int 197 ; FAILWITH } {} ;
                                      CAR ;
                                      INT ;
                                      ADD ;
                                      SWAP ;
                                      PAIR ;
                                      SWAP ;
                                      PAIR ;
                                      SWAP ;
                                      PAIR ;
                                      SWAP ;
                                      UNPAIR ;
                                      SWAP ;
                                      UNPAIR ;
                                      UNPAIR ;
                                      SWAP ;
                                      DUP ;
                                      DUP 7 ;
                                      DUP ;
                                      DUG 2 ;
                                      GET ;
                                      IF_NONE { PUSH int 198 ; FAILWITH } {} ;
                                      PUSH nat 0 ;
                                      UPDATE 1 ;
                                      SOME ;
                                      SWAP ;
                                      UPDATE ;
                                      DUP ;
                                      DUP 7 ;
                                      DUP ;
                                      DUG 2 ;
                                      GET ;
                                      IF_NONE { PUSH int 199 ; FAILWITH } {} ;
                                      EMPTY_MAP address nat ;
                                      UPDATE 2 ;
                                      SOME ;
                                      SWAP ;
                                      UPDATE ;
                                      SWAP ;
                                      PAIR ;
                                      PAIR ;
                                      SWAP ;
                                      PAIR ;
                                      SWAP ;
                                      PAIR ;
                                      DUG 3 }
                                    {} } ;
                            PUSH nat 1 ;
                            ADD ;
                            DUP ;
                            PUSH nat 100 ;
                            COMPARE ;
                            GT } ;
                     DROP ;
                     DUP 3 ;
                     CAR ;
                     GET 5 ;
                     ITER { DUP 4 ;
                            UNPAIR ;
                            UNPAIR ;
                            SWAP ;
                            UNPAIR ;
                            UNPAIR ;
                            DUP ;
                            DUP 7 ;
                            DUP ;
                            DUG 2 ;
                            GET ;
                            IF_NONE { PUSH int 202 ; FAILWITH } {} ;
                            DUP 9 ;
                            DIG 11 ;
                            DUP ;
                            CAR ;
                            GET 3 ;
                            CDR ;
                            SWAP ;
                            CAR ;
                            GET 3 ;
                            CAR ;
                            DUP 11 ;
                            GET ;
                            IF_NONE { PUSH int 202 ; FAILWITH } {} ;
                            CAR ;
                            MUL ;
                            EDIV ;
                            IF_NONE { PUSH int 202 ; FAILWITH } { CAR } ;
                            INT ;
                            ISNAT ;
                            IF_NONE { PUSH int 202 ; FAILWITH } {} ;
                            UPDATE 1 ;
                            SOME ;
                            SWAP ;
                            UPDATE ;
                            PAIR ;
                            PAIR ;
                            SWAP ;
                            PAIR ;
                            PAIR ;
                            DUP ;
                            DUG 4 ;
                            CAR ;
                            GET 3 ;
                            CAR ;
                            SWAP ;
                            DUP ;
                            DUG 2 ;
                            GET ;
                            IF_NONE { PUSH int 204 ; FAILWITH } {} ;
                            CDR ;
                            IF { DUP 4 ;
                                 UNPAIR ;
                                 UNPAIR ;
                                 UNPAIR ;
                                 SWAP ;
                                 UNPAIR ;
                                 DUP ;
                                 DUP 7 ;
                                 DUP ;
                                 DUG 2 ;
                                 GET ;
                                 IF_NONE { PUSH int 139 ; FAILWITH } {} ;
                                 DIG 10 ;
                                 CAR ;
                                 GET 3 ;
                                 CAR ;
                                 DUP 9 ;
                                 GET ;
                                 IF_NONE { PUSH int 139 ; FAILWITH } {} ;
                                 CAR ;
                                 ADD ;
                                 SOME ;
                                 SWAP ;
                                 UPDATE ;
                                 PAIR ;
                                 SWAP ;
                                 PAIR ;
                                 PAIR ;
                                 PAIR ;
                                 DUP ;
                                 DUG 4 ;
                                 UNPAIR ;
                                 UNPAIR ;
                                 SWAP ;
                                 UNPAIR ;
                                 CAR ;
                                 DUP 8 ;
                                 CAR ;
                                 GET 3 ;
                                 CAR ;
                                 DUP 6 ;
                                 GET ;
                                 IF_NONE { PUSH int 140 ; FAILWITH } {} ;
                                 CAR ;
                                 DIG 8 ;
                                 CAR ;
                                 GET 3 ;
                                 CDR ;
                                 SUB ;
                                 ISNAT ;
                                 IF_NONE { PUSH int 140 ; FAILWITH } {} ;
                                 SWAP ;
                                 DUP ;
                                 DUP 7 ;
                                 DUP ;
                                 DUG 2 ;
                                 GET ;
                                 IF_NONE { PUSH int 141 ; FAILWITH } {} ;
                                 PUSH nat 0 ;
                                 UPDATE 1 ;
                                 SOME ;
                                 SWAP ;
                                 UPDATE ;
                                 PAIR ;
                                 SWAP ;
                                 UNPAIR ;
                                 PUSH bool False ;
                                 DIG 6 ;
                                 UPDATE ;
                                 PAIR ;
                                 SWAP ;
                                 PAIR ;
                                 SWAP ;
                                 PAIR ;
                                 PAIR ;
                                 DUG 2 }
                               { DROP } } ;
                     DROP 2 } ;
                 NIL operation }
               { IF_LEFT
                   { SWAP ;
                     DUP ;
                     DUG 2 ;
                     GET 5 ;
                     CAR ;
                     IF {} { PUSH string "REQUIRED PERMISSION" ; FAILWITH } ;
                     DUP ;
                     CAR ;
                     PUSH nat 0 ;
                     COMPARE ;
                     LT ;
                     IF { SWAP ; DUP ; DUG 2 ; CAR ; CAR ; GET 3 ; SENDER ; MEM }
                        { PUSH bool False } ;
                     IF {} { PUSH string "INVALID INPUT" ; FAILWITH } ;
                     DUP ;
                     CDR ;
                     ITER { DUP 3 ;
                            CAR ;
                            CAR ;
                            GET 3 ;
                            SENDER ;
                            GET ;
                            IF_NONE { PUSH int 151 ; FAILWITH } {} ;
                            DUP 3 ;
                            CAR ;
                            COMPARE ;
                            LE ;
                            IF { DUP ; PUSH nat 0 ; SWAP ; COMPARE ; GE } { PUSH bool False } ;
                            IF { DUP ; PUSH nat 100 ; COMPARE ; GT } { PUSH bool False } ;
                            IF {} { PUSH string "INVALID TICKET" ; FAILWITH } ;
                            DUP 3 ;
                            UNPAIR ;
                            UNPAIR ;
                            UNPAIR ;
                            SWAP ;
                            UNPAIR ;
                            DUP 7 ;
                            CAR ;
                            DIG 8 ;
                            CAR ;
                            CAR ;
                            GET 3 ;
                            SENDER ;
                            GET ;
                            IF_NONE { PUSH int 152 ; FAILWITH } {} ;
                            SUB ;
                            ISNAT ;
                            IF_NONE { PUSH int 152 ; FAILWITH } {} ;
                            SOME ;
                            SENDER ;
                            UPDATE ;
                            PAIR ;
                            SWAP ;
                            PAIR ;
                            PAIR ;
                            PAIR ;
                            DUP ;
                            DUG 3 ;
                            GET 5 ;
                            CDR ;
                            SWAP ;
                            DUP ;
                            DUG 2 ;
                            MEM ;
                            IF { DUP 3 ;
                                 GET 5 ;
                                 CDR ;
                                 SWAP ;
                                 DUP ;
                                 DUG 2 ;
                                 GET ;
                                 IF_NONE { PUSH int 155 ; FAILWITH } {} ;
                                 CDR ;
                                 SENDER ;
                                 MEM ;
                                 IF { DIG 2 ;
                                      UNPAIR ;
                                      SWAP ;
                                      UNPAIR ;
                                      SWAP ;
                                      UNPAIR ;
                                      UNPAIR ;
                                      SWAP ;
                                      DUP ;
                                      DUP 7 ;
                                      DUP ;
                                      DUG 2 ;
                                      GET ;
                                      IF_NONE { PUSH int 156 ; FAILWITH } {} ;
                                      DUP ;
                                      CDR ;
                                      DUP ;
                                      SENDER ;
                                      DUP ;
                                      DUG 2 ;
                                      GET ;
                                      IF_NONE { PUSH int 156 ; FAILWITH } {} ;
                                      DUP 12 ;
                                      CAR ;
                                      ADD ;
                                      SOME ;
                                      SWAP ;
                                      UPDATE ;
                                      UPDATE 2 ;
                                      SOME ;
                                      SWAP ;
                                      UPDATE ;
                                      SWAP ;
                                      PAIR ;
                                      PAIR ;
                                      SWAP ;
                                      PAIR ;
                                      SWAP ;
                                      PAIR ;
                                      DUG 2 }
                                    { DIG 2 ;
                                      UNPAIR ;
                                      SWAP ;
                                      UNPAIR ;
                                      SWAP ;
                                      UNPAIR ;
                                      UNPAIR ;
                                      SWAP ;
                                      DUP ;
                                      DUP 7 ;
                                      DUP ;
                                      DUG 2 ;
                                      GET ;
                                      IF_NONE { PUSH int 158 ; FAILWITH } {} ;
                                      DUP ;
                                      CDR ;
                                      DUP 10 ;
                                      CAR ;
                                      SOME ;
                                      SENDER ;
                                      UPDATE ;
                                      UPDATE 2 ;
                                      SOME ;
                                      SWAP ;
                                      UPDATE ;
                                      SWAP ;
                                      PAIR ;
                                      PAIR ;
                                      SWAP ;
                                      PAIR ;
                                      SWAP ;
                                      PAIR ;
                                      DUG 2 } ;
                                 DIG 2 ;
                                 UNPAIR ;
                                 SWAP ;
                                 UNPAIR ;
                                 SWAP ;
                                 UNPAIR ;
                                 UNPAIR ;
                                 SWAP ;
                                 DUP ;
                                 DUP 7 ;
                                 DUP ;
                                 DUG 2 ;
                                 GET ;
                                 IF_NONE { PUSH int 159 ; FAILWITH } {} ;
                                 DUP ;
                                 CAR ;
                                 DUP 10 ;
                                 CAR ;
                                 ADD ;
                                 UPDATE 1 ;
                                 SOME ;
                                 SWAP ;
                                 UPDATE ;
                                 SWAP ;
                                 PAIR ;
                                 PAIR ;
                                 SWAP ;
                                 PAIR ;
                                 SWAP ;
                                 PAIR ;
                                 DUG 2 }
                               { DIG 2 ;
                                 UNPAIR ;
                                 SWAP ;
                                 UNPAIR ;
                                 SWAP ;
                                 UNPAIR ;
                                 UNPAIR ;
                                 SWAP ;
                                 EMPTY_MAP address nat ;
                                 DUP 8 ;
                                 CAR ;
                                 SOME ;
                                 SENDER ;
                                 UPDATE ;
                                 DUP 8 ;
                                 CAR ;
                                 PAIR ;
                                 SOME ;
                                 DUP 7 ;
                                 UPDATE ;
                                 SWAP ;
                                 PAIR ;
                                 PAIR ;
                                 SWAP ;
                                 PAIR ;
                                 SWAP ;
                                 PAIR ;
                                 DUG 2 } ;
                            DUP 3 ;
                            CAR ;
                            GET 3 ;
                            CDR ;
                            PUSH nat 80 ;
                            DUP 5 ;
                            GET 5 ;
                            CDR ;
                            DIG 3 ;
                            GET ;
                            IF_NONE { PUSH int 166 ; FAILWITH } {} ;
                            CAR ;
                            MUL ;
                            COMPARE ;
                            LE ;
                            IF {} { PUSH string "HOUSE POOL DRY" ; FAILWITH } } ;
                     DROP ;
                     NIL operation }
                   { IF_LEFT
                       { SWAP ;
                         DUP ;
                         DUG 2 ;
                         CAR ;
                         CAR ;
                         CAR ;
                         SENDER ;
                         COMPARE ;
                         EQ ;
                         IF {}
                            { PUSH string "WrongCondition: sp.sender == self.data.admin" ; FAILWITH } ;
                         SWAP ;
                         UNPAIR ;
                         SWAP ;
                         UNPAIR ;
                         UNPAIR ;
                         SWAP ;
                         CAR ;
                         DIG 4 ;
                         SWAP ;
                         PAIR ;
                         SWAP ;
                         PAIR ;
                         PAIR ;
                         SWAP ;
                         PAIR ;
                         NIL operation }
                       { DUP ;
                         PUSH nat 0 ;
                         COMPARE ;
                         LT ;
                         IF { SWAP ; DUP ; DUG 2 ; CAR ; CAR ; GET 3 ; SENDER ; MEM }
                            { PUSH bool False } ;
                         IF { SWAP ;
                              DUP ;
                              DUG 2 ;
                              CAR ;
                              CAR ;
                              GET 3 ;
                              SENDER ;
                              GET ;
                              IF_NONE { PUSH int 107 ; FAILWITH } {} ;
                              SWAP ;
                              DUP ;
                              DUG 2 ;
                              COMPARE ;
                              LE }
                            { PUSH bool False } ;
                         IF {} { PUSH string "INVALID INPUT" ; FAILWITH } ;
                         NIL operation ;
                         DUP 3 ;
                         GET 7 ;
                         CONTRACT %transfer (list (pair address (list (pair address (pair nat nat))))) ;
                         IF_NONE { PUSH int 26 ; FAILWITH } {} ;
                         PUSH mutez 0 ;
                         NIL (pair address (list (pair address (pair nat nat)))) ;
                         NIL (pair address (pair nat nat)) ;
                         DUP 6 ;
                         PUSH nat 0 ;
                         SENDER ;
                         PAIR 3 ;
                         CONS ;
                         SELF_ADDRESS ;
                         PAIR ;
                         CONS ;
                         TRANSFER_TOKENS ;
                         CONS ;
                         DUP 3 ;
                         UNPAIR ;
                         UNPAIR ;
                         UNPAIR ;
                         SWAP ;
                         UNPAIR ;
                         DIG 6 ;
                         DIG 7 ;
                         CAR ;
                         CAR ;
                         GET 3 ;
                         SENDER ;
                         GET ;
                         IF_NONE { PUSH int 111 ; FAILWITH } {} ;
                         SUB ;
                         ISNAT ;
                         IF_NONE { PUSH int 111 ; FAILWITH } {} ;
                         SOME ;
                         SENDER ;
                         UPDATE ;
                         PAIR ;
                         SWAP ;
                         PAIR ;
                         PAIR ;
                         PAIR ;
                         SWAP } } } } ;
         PAIR } }
