{ storage
    (pair (pair (pair (pair (address %administrator) (address %distributor))
                      (pair (big_map %metadata string bytes) (bool %paused)))
                (pair (pair (big_map %trades
                               address
                               (map nat
                                    (pair (pair (address %owner) (pair (mutez %price_accepted) (mutez %price_offered)))
                                          (pair (timestamp %timestamp)
                                                (pair (list %tokens_accepted (pair (nat %amount) (pair (address %fa2) (nat %token_id))))
                                                      (list %tokens_offered (pair (nat %amount) (pair (address %fa2) (nat %token_id)))))))))
                            (nat %trading_fee))
                      (pair (nat %treasure_fee) (pair (address %treasury) (map %whitelist address bool)))))
          (big_map
             nat
             (lambda
                (pair (or (or (or (pair address nat) (pair bool address))
                              (or (pair (pair mutez mutez)
                                        (pair (list (pair nat (pair address nat))) (list (pair nat (pair address nat)))))
                                  address))
                          (or (or address (pair nat nat)) (or bool (pair address nat))))
                      (pair (pair (pair address address) (pair (big_map string bytes) bool))
                            (pair (pair (big_map
                                           address
                                           (map nat
                                                (pair (pair address (pair mutez mutez))
                                                      (pair timestamp
                                                            (pair (list (pair nat (pair address nat))) (list (pair nat (pair address nat))))))))
                                        nat)
                                  (pair nat (pair address (map address bool))))))
                (pair (list operation)
                      (pair (pair (pair address address) (pair (big_map string bytes) bool))
                            (pair (pair (big_map
                                           address
                                           (map nat
                                                (pair (pair address (pair mutez mutez))
                                                      (pair timestamp
                                                            (pair (list (pair nat (pair address nat))) (list (pair nat (pair address nat))))))))
                                        nat)
                                  (pair nat (pair address (map address bool))))))))) ;
  parameter
    (or (or (or (pair %cancel_trade (address %owner_id) (nat %trade_id))
                (pair %mod_whitelist (bool %enabled) (address %fa2)))
            (or (pair %offer_trade
                   (pair (mutez %price_accepted) (mutez %price_offered))
                   (pair (list %tokens_accepted (pair (nat %amount) (pair (address %fa2) (nat %token_id))))
                         (list %tokens_offered (pair (nat %amount) (pair (address %fa2) (nat %token_id))))))
                (address %set_administrator)))
        (or (or (address %set_distributor)
                (pair %set_fees (nat %trading_fee) (nat %treasure_fee)))
            (or (bool %set_pause) (pair %take_trade (address %owner_id) (nat %trade_id))))) ;
  code { CAST (pair (or (or (or (pair address nat) (pair bool address))
                            (or (pair (pair mutez mutez)
                                      (pair (list (pair nat (pair address nat))) (list (pair nat (pair address nat)))))
                                address))
                        (or (or address (pair nat nat)) (or bool (pair address nat))))
                    (pair (pair (pair (pair address address) (pair (big_map string bytes) bool))
                                (pair (pair (big_map
                                               address
                                               (map nat
                                                    (pair (pair address (pair mutez mutez))
                                                          (pair timestamp
                                                                (pair (list (pair nat (pair address nat))) (list (pair nat (pair address nat))))))))
                                            nat)
                                      (pair nat (pair address (map address bool)))))
                          (big_map
                             nat
                             (lambda
                                (pair (or (or (or (pair address nat) (pair bool address))
                                              (or (pair (pair mutez mutez)
                                                        (pair (list (pair nat (pair address nat))) (list (pair nat (pair address nat)))))
                                                  address))
                                          (or (or address (pair nat nat)) (or bool (pair address nat))))
                                      (pair (pair (pair address address) (pair (big_map string bytes) bool))
                                            (pair (pair (big_map
                                                           address
                                                           (map nat
                                                                (pair (pair address (pair mutez mutez))
                                                                      (pair timestamp
                                                                            (pair (list (pair nat (pair address nat))) (list (pair nat (pair address nat))))))))
                                                        nat)
                                                  (pair nat (pair address (map address bool))))))
                                (pair (list operation)
                                      (pair (pair (pair address address) (pair (big_map string bytes) bool))
                                            (pair (pair (big_map
                                                           address
                                                           (map nat
                                                                (pair (pair address (pair mutez mutez))
                                                                      (pair timestamp
                                                                            (pair (list (pair nat (pair address nat))) (list (pair nat (pair address nat))))))))
                                                        nat)
                                                  (pair nat (pair address (map address bool)))))))))) ;
         UNPAIR 3 ;
         DUP ;
         IF_LEFT
           { IF_LEFT
               { IF_LEFT { DROP ; PUSH nat 0 } { DROP ; PUSH nat 1 } }
               { IF_LEFT { DROP ; PUSH nat 2 } { DROP ; PUSH nat 3 } } }
           { IF_LEFT
               { IF_LEFT { DROP ; PUSH nat 4 } { DROP ; PUSH nat 5 } }
               { IF_LEFT { DROP ; PUSH nat 6 } { DROP ; PUSH nat 7 } } } ;
         DUP 4 ;
         SWAP ;
         GET ;
         IF_NONE { PUSH int -1 ; FAILWITH } {} ;
         DUG 2 ;
         PAIR ;
         EXEC ;
         UNPAIR ;
         NIL operation ;
         SWAP ;
         ITER { CONS } ;
         DUG 2 ;
         PAIR ;
         SWAP ;
         PAIR } }
