{ storage
    (list (pair (pair (mutez %amount) (pair (bool %completed) (timestamp %datetime)))
                (pair (mutez %fee) (pair (address %recipient) (address %scheduler_address))))) ;
  parameter
    (or (unit %run_transactions)
        (pair %schedule_transaction
           (pair (mutez %amount) (timestamp %datetime))
           (pair (mutez %fee) (address %recipient)))) ;
  code { UNPAIR ;
         IF_LEFT
           { DROP ;
             DUP ;
             NIL operation ;
             SWAP ;
             ITER { DUP ;
                    CAR ;
                    GET 3 ;
                    PUSH bool False ;
                    COMPARE ;
                    EQ ;
                    IF { DUP ;
                         CAR ;
                         GET 4 ;
                         NOW ;
                         COMPARE ;
                         GE ;
                         IF { DUP ;
                              DUG 2 ;
                              GET 5 ;
                              CONTRACT unit ;
                              IF_NONE { PUSH int 31 ; FAILWITH } {} ;
                              DUP 3 ;
                              CAR ;
                              CAR ;
                              UNIT ;
                              TRANSFER_TOKENS ;
                              CONS ;
                              SENDER ;
                              CONTRACT unit ;
                              IF_NONE { PUSH int 34 ; FAILWITH } {} ;
                              DIG 2 ;
                              GET 3 ;
                              UNIT ;
                              TRANSFER_TOKENS ;
                              CONS }
                            { DROP } }
                       { DROP } } }
           { DUP ;
             GET 3 ;
             PUSH mutez 0 ;
             COMPARE ;
             LT ;
             IF {} { PUSH string "There is no fee!" ; FAILWITH } ;
             DUP ;
             CAR ;
             CAR ;
             PUSH mutez 0 ;
             COMPARE ;
             LT ;
             IF {} { PUSH string "There is no tez in with this transaction!" ; FAILWITH } ;
             DUP ;
             CAR ;
             CDR ;
             NOW ;
             COMPARE ;
             LT ;
             IF {} { PUSH string "WrongCondition: params.datetime > sp.now" ; FAILWITH } ;
             AMOUNT ;
             SWAP ;
             DUP ;
             CAR ;
             CAR ;
             SWAP ;
             DUP ;
             DUG 3 ;
             GET 3 ;
             ADD ;
             COMPARE ;
             LE ;
             IF {}
                { PUSH string "WrongCondition: (params.fee + params.amount) <= sp.amount" ;
                  FAILWITH } ;
             SWAP ;
             SENDER ;
             DUP 3 ;
             GET 4 ;
             PAIR ;
             DUP 3 ;
             GET 3 ;
             PAIR ;
             DUP 3 ;
             CAR ;
             CDR ;
             PUSH bool False ;
             PAIR ;
             DIG 3 ;
             CAR ;
             CAR ;
             PAIR ;
             PAIR ;
             CONS ;
             NIL operation } ;
         NIL operation ;
         SWAP ;
         ITER { CONS } ;
         PAIR } }
