{ storage
    (pair (pair (bool %active) (pair (address %admin) (nat %commission)))
          (pair (pair (big_map %pairs
                         string
                         (map string (pair (address %contract) (pair (string %counterAsset) (nat %decimals)))))
                      (nat %swapFee))
                (pair (big_map %swaps
                         bytes
                         (pair (pair (pair (string %asset) (nat %commission))
                                     (pair (nat %expected) (address %initiator)))
                               (pair (pair (string %pair) (timestamp %refundTimestamp))
                                     (pair (bytes %swapHash) (nat %value)))))
                      (nat %userXTZDeposit)))) ;
  parameter
    (or (or (or (map %addSwapPair
                   string
                   (map string (pair (address %contract) (pair (string %counterAsset) (nat %decimals)))))
                (unit %default))
            (or (pair %offer
                   (pair (string %_asset) (pair (nat %_expected) (string %_pair)))
                   (pair (timestamp %_refundTimestamp) (pair (bytes %_swapHash) (nat %_value))))
                (or (bytes %refund) (list %removeSwapPair string))))
        (or (or (option %setBaker key_hash)
                (or (pair %take
                       (pair (string %_asset) (string %_pair))
                       (pair (bytes %_swapHash) (nat %_value)))
                    (bool %toggleContractState)))
            (or (address %transferFees)
                (or (address %updateAdmin) (pair %updateSwapFees (nat %_commission) (nat %_swapFee)))))) ;
  code { CAST (pair (or (or (or (map string (map string (pair address (pair string nat)))) unit)
                            (or (pair (pair string (pair nat string)) (pair timestamp (pair bytes nat)))
                                (or bytes (list string))))
                        (or (or (option key_hash) (or (pair (pair string string) (pair bytes nat)) bool))
                            (or address (or address (pair nat nat)))))
                    (pair (pair bool (pair address nat))
                          (pair (pair (big_map string (map string (pair address (pair string nat)))) nat)
                                (pair (big_map
                                         bytes
                                         (pair (pair (pair string nat) (pair nat address))
                                               (pair (pair string timestamp) (pair bytes nat))))
                                      nat)))) ;
         UNPAIR ;
         IF_LEFT
           { IF_LEFT
               { IF_LEFT
                   { SWAP ;
                     DUP ;
                     DUG 2 ;
                     CAR ;
                     GET 3 ;
                     SENDER ;
                     COMPARE ;
                     EQ ;
                     IF {} { PUSH string "ONLY_ADMIN" ; FAILWITH } ;
                     DUP ;
                     ITER { CAR ;
                            DIG 2 ;
                            UNPAIR ;
                            SWAP ;
                            UNPAIR ;
                            UNPAIR ;
                            DUP 6 ;
                            DUP 6 ;
                            GET ;
                            IF_NONE { PUSH int 154 ; FAILWITH } {} ;
                            SOME ;
                            DIG 5 ;
                            UPDATE ;
                            PAIR ;
                            PAIR ;
                            SWAP ;
                            PAIR ;
                            SWAP } ;
                     DROP }
                   { DROP } ;
                 NIL operation }
               { IF_LEFT
                   { PUSH bool True ;
                     DUP 3 ;
                     CAR ;
                     CAR ;
                     COMPARE ;
                     EQ ;
                     IF {} { PUSH string "CONTRACT_INACTIVE" ; FAILWITH } ;
                     DUP ;
                     GET 6 ;
                     PUSH nat 0 ;
                     COMPARE ;
                     NEQ ;
                     IF {} { PUSH string "ZERO_VALUE_SWAP" ; FAILWITH } ;
                     SWAP ;
                     DUP ;
                     DUG 2 ;
                     GET 5 ;
                     SWAP ;
                     DUP ;
                     DUG 2 ;
                     GET 5 ;
                     MEM ;
                     IF { PUSH string "HASH_ALREADY_EXISTS" ; FAILWITH } {} ;
                     DUP ;
                     GET 3 ;
                     NOW ;
                     COMPARE ;
                     LT ;
                     IF {} { PUSH string "REFUND_TIME_ALREADY_ARRIVED" ; FAILWITH } ;
                     SWAP ;
                     DUP ;
                     DUG 2 ;
                     GET 3 ;
                     CAR ;
                     SWAP ;
                     DUP ;
                     DUG 2 ;
                     CAR ;
                     GET 4 ;
                     MEM ;
                     IF {} { PUSH string "INVALID_PAIR" ; FAILWITH } ;
                     SWAP ;
                     DUP ;
                     DUG 2 ;
                     GET 3 ;
                     CAR ;
                     SWAP ;
                     DUP ;
                     DUG 2 ;
                     CAR ;
                     GET 4 ;
                     GET ;
                     IF_NONE { PUSH int 80 ; FAILWITH } {} ;
                     SWAP ;
                     DUP ;
                     DUG 2 ;
                     CAR ;
                     CAR ;
                     MEM ;
                     IF {} { PUSH string "INVALID_ASSET" ; FAILWITH } ;
                     DUP ;
                     CAR ;
                     CAR ;
                     PUSH string "xtz" ;
                     COMPARE ;
                     EQ ;
                     IF { PUSH mutez 1 ;
                          DUP 3 ;
                          CAR ;
                          GET 4 ;
                          DUP 3 ;
                          GET 6 ;
                          ADD ;
                          MUL ;
                          AMOUNT ;
                          COMPARE ;
                          EQ ;
                          IF {} { PUSH string "AMOUNT_MISMATCH" ; FAILWITH } ;
                          SWAP ;
                          DUP ;
                          DUG 2 ;
                          DUP ;
                          GET 6 ;
                          DIG 3 ;
                          CAR ;
                          GET 4 ;
                          DUP 4 ;
                          GET 6 ;
                          ADD ;
                          ADD ;
                          UPDATE 6 ;
                          SWAP ;
                          NIL operation }
                        { PUSH mutez 1 ;
                          DUP 3 ;
                          CAR ;
                          GET 4 ;
                          MUL ;
                          AMOUNT ;
                          COMPARE ;
                          EQ ;
                          IF {} { PUSH string "AMOUNT_MISMATCH" ; FAILWITH } ;
                          SWAP ;
                          DUP ;
                          DUG 2 ;
                          DUP ;
                          GET 6 ;
                          DIG 3 ;
                          CAR ;
                          GET 4 ;
                          ADD ;
                          UPDATE 6 ;
                          SWAP ;
                          NIL operation ;
                          DUP 3 ;
                          GET 3 ;
                          CAR ;
                          DUP 3 ;
                          CAR ;
                          GET 4 ;
                          GET ;
                          IF_NONE { PUSH int 228 ; FAILWITH } {} ;
                          DUP 3 ;
                          CAR ;
                          CAR ;
                          GET ;
                          IF_NONE { PUSH int 228 ; FAILWITH } {} ;
                          CAR ;
                          CONTRACT %transfer (pair address (pair address nat)) ;
                          IF_NONE { PUSH int 228 ; FAILWITH } {} ;
                          PUSH mutez 1 ;
                          PUSH nat 0 ;
                          MUL ;
                          DUP 4 ;
                          GET 6 ;
                          SELF_ADDRESS ;
                          SENDER ;
                          PAIR 3 ;
                          TRANSFER_TOKENS ;
                          CONS } ;
                     DUP 3 ;
                     DUP ;
                     GET 5 ;
                     DIG 3 ;
                     DUP ;
                     GET 6 ;
                     SWAP ;
                     DUP ;
                     DUG 5 ;
                     GET 5 ;
                     PAIR ;
                     DIG 4 ;
                     DUP ;
                     GET 3 ;
                     SWAP ;
                     DUP ;
                     DUG 6 ;
                     CAR ;
                     GET 4 ;
                     PAIR ;
                     PAIR ;
                     SENDER ;
                     DUP 6 ;
                     CAR ;
                     GET 3 ;
                     PAIR ;
                     DIG 6 ;
                     CAR ;
                     GET 4 ;
                     DUP 7 ;
                     CAR ;
                     CAR ;
                     PAIR ;
                     PAIR ;
                     PAIR ;
                     SOME ;
                     DIG 4 ;
                     GET 5 ;
                     UPDATE ;
                     UPDATE 5 ;
                     SWAP }
                   { IF_LEFT
                       { SWAP ;
                         DUP ;
                         DUG 2 ;
                         GET 5 ;
                         SWAP ;
                         DUP ;
                         DUG 2 ;
                         MEM ;
                         IF {} { PUSH string "INVALID_HASH" ; FAILWITH } ;
                         NOW ;
                         DUP 3 ;
                         GET 5 ;
                         DUP 3 ;
                         GET ;
                         IF_NONE { PUSH int 106 ; FAILWITH } {} ;
                         GET 3 ;
                         CDR ;
                         COMPARE ;
                         LE ;
                         IF {} { PUSH string "REFUND_TIME_NOT_ARRIVED" ; FAILWITH } ;
                         PUSH string "xtz" ;
                         DUP 3 ;
                         GET 5 ;
                         DUP 3 ;
                         GET ;
                         IF_NONE { PUSH int 277 ; FAILWITH } {} ;
                         CAR ;
                         CAR ;
                         CAR ;
                         COMPARE ;
                         EQ ;
                         IF { NIL operation ;
                              DUP 3 ;
                              GET 5 ;
                              DUP 3 ;
                              GET ;
                              IF_NONE { PUSH int 278 ; FAILWITH } {} ;
                              CAR ;
                              GET 4 ;
                              CONTRACT unit ;
                              IF_NONE { PUSH int 278 ; FAILWITH } {} ;
                              PUSH mutez 1 ;
                              DUP 5 ;
                              GET 5 ;
                              DUP 5 ;
                              GET ;
                              IF_NONE { PUSH int 278 ; FAILWITH } {} ;
                              CAR ;
                              CAR ;
                              CDR ;
                              DUP 6 ;
                              GET 5 ;
                              DUP 6 ;
                              GET ;
                              IF_NONE { PUSH int 278 ; FAILWITH } {} ;
                              GET 6 ;
                              ADD ;
                              MUL ;
                              UNIT ;
                              TRANSFER_TOKENS ;
                              CONS ;
                              DIG 2 ;
                              DUP ;
                              DUP ;
                              DUG 4 ;
                              GET 5 ;
                              DUP 4 ;
                              GET ;
                              IF_NONE { PUSH int 279 ; FAILWITH } {} ;
                              CAR ;
                              CAR ;
                              CDR ;
                              DUP 5 ;
                              GET 5 ;
                              DUP 5 ;
                              GET ;
                              IF_NONE { PUSH int 279 ; FAILWITH } {} ;
                              GET 6 ;
                              ADD ;
                              DIG 4 ;
                              GET 6 ;
                              SUB ;
                              ISNAT ;
                              IF_NONE { PUSH int 279 ; FAILWITH } {} ;
                              UPDATE 6 ;
                              DUG 2 }
                            { PUSH nat 0 ;
                              DUP 3 ;
                              GET 5 ;
                              DUP 3 ;
                              GET ;
                              IF_NONE { PUSH int 281 ; FAILWITH } {} ;
                              CAR ;
                              CAR ;
                              CDR ;
                              COMPARE ;
                              NEQ ;
                              IF { SWAP ;
                                   DUP ;
                                   DUP ;
                                   DUG 3 ;
                                   GET 5 ;
                                   DUP 3 ;
                                   GET ;
                                   IF_NONE { PUSH int 282 ; FAILWITH } {} ;
                                   CAR ;
                                   CAR ;
                                   CDR ;
                                   DIG 3 ;
                                   GET 6 ;
                                   SUB ;
                                   ISNAT ;
                                   IF_NONE { PUSH int 282 ; FAILWITH } {} ;
                                   UPDATE 6 ;
                                   SWAP ;
                                   NIL operation ;
                                   DUP 3 ;
                                   GET 5 ;
                                   DUP 3 ;
                                   GET ;
                                   IF_NONE { PUSH int 283 ; FAILWITH } {} ;
                                   CAR ;
                                   GET 4 ;
                                   CONTRACT unit ;
                                   IF_NONE { PUSH int 283 ; FAILWITH } {} ;
                                   PUSH mutez 1 ;
                                   DUP 5 ;
                                   GET 5 ;
                                   DUP 5 ;
                                   GET ;
                                   IF_NONE { PUSH int 283 ; FAILWITH } {} ;
                                   CAR ;
                                   CAR ;
                                   CDR ;
                                   MUL ;
                                   UNIT ;
                                   TRANSFER_TOKENS ;
                                   CONS }
                                 { NIL operation } ;
                              DIG 2 ;
                              DUP ;
                              GET 3 ;
                              CAR ;
                              SWAP ;
                              DUP ;
                              DUG 4 ;
                              GET 5 ;
                              DUP 4 ;
                              GET ;
                              IF_NONE { PUSH int 284 ; FAILWITH } {} ;
                              GET 3 ;
                              CAR ;
                              GET ;
                              IF_NONE { PUSH int 284 ; FAILWITH } {} ;
                              DUP 4 ;
                              GET 5 ;
                              DUP 4 ;
                              GET ;
                              IF_NONE { PUSH int 284 ; FAILWITH } {} ;
                              CAR ;
                              CAR ;
                              CAR ;
                              GET ;
                              IF_NONE { PUSH int 284 ; FAILWITH } {} ;
                              CAR ;
                              CONTRACT %transfer (pair address (pair address nat)) ;
                              IF_NONE { PUSH int 284 ; FAILWITH } {} ;
                              PUSH mutez 1 ;
                              PUSH nat 0 ;
                              MUL ;
                              DUP 5 ;
                              GET 5 ;
                              DUP 5 ;
                              GET ;
                              IF_NONE { PUSH int 285 ; FAILWITH } {} ;
                              GET 6 ;
                              DUP 6 ;
                              GET 5 ;
                              DUP 6 ;
                              GET ;
                              IF_NONE { PUSH int 285 ; FAILWITH } {} ;
                              CAR ;
                              GET 4 ;
                              SELF_ADDRESS ;
                              PAIR 3 ;
                              TRANSFER_TOKENS ;
                              CONS } ;
                         DIG 2 ;
                         DUP ;
                         GET 5 ;
                         NONE (pair (pair (pair string nat) (pair nat address))
                                    (pair (pair string timestamp) (pair bytes nat))) ;
                         DIG 4 ;
                         UPDATE ;
                         UPDATE 5 ;
                         SWAP }
                       { SWAP ;
                         DUP ;
                         DUG 2 ;
                         CAR ;
                         GET 3 ;
                         SENDER ;
                         COMPARE ;
                         EQ ;
                         IF {} { PUSH string "ONLY_ADMIN" ; FAILWITH } ;
                         DUP ;
                         ITER { DIG 2 ;
                                UNPAIR ;
                                SWAP ;
                                UNPAIR ;
                                UNPAIR ;
                                NONE (map string (pair address (pair string nat))) ;
                                DIG 5 ;
                                UPDATE ;
                                PAIR ;
                                PAIR ;
                                SWAP ;
                                PAIR ;
                                SWAP } ;
                         DROP ;
                         NIL operation } } } }
           { IF_LEFT
               { IF_LEFT
                   { SWAP ;
                     DUP ;
                     DUG 2 ;
                     CAR ;
                     GET 3 ;
                     SENDER ;
                     COMPARE ;
                     EQ ;
                     IF {} { PUSH string "ONLY_ADMIN" ; FAILWITH } ;
                     SET_DELEGATE ;
                     NIL operation ;
                     SWAP ;
                     CONS }
                   { IF_LEFT
                       { PUSH bool True ;
                         DUP 3 ;
                         CAR ;
                         CAR ;
                         COMPARE ;
                         EQ ;
                         IF {} { PUSH string "CONTRACT_INACTIVE" ; FAILWITH } ;
                         NOW ;
                         DUP 3 ;
                         GET 5 ;
                         DUP 3 ;
                         GET 3 ;
                         GET ;
                         IF_NONE { PUSH int 92 ; FAILWITH } {} ;
                         GET 3 ;
                         CDR ;
                         COMPARE ;
                         GT ;
                         IF {}
                            { PUSH string
                                   "WrongCondition:self.data.swaps[params._swapHash].refundTimestamp > sp.now" ;
                              FAILWITH } ;
                         DUP ;
                         CAR ;
                         CDR ;
                         DUP 3 ;
                         GET 5 ;
                         DUP 3 ;
                         GET 3 ;
                         GET ;
                         IF_NONE { PUSH int 93 ; FAILWITH } {} ;
                         GET 3 ;
                         CAR ;
                         COMPARE ;
                         EQ ;
                         IF {} { PUSH string "INVALID_PAIR" ; FAILWITH } ;
                         DUP ;
                         CAR ;
                         CAR ;
                         DUP 3 ;
                         GET 3 ;
                         CAR ;
                         DUP 3 ;
                         CAR ;
                         CDR ;
                         GET ;
                         IF_NONE { PUSH int 94 ; FAILWITH } {} ;
                         DUP 4 ;
                         GET 5 ;
                         DUP 4 ;
                         GET 3 ;
                         GET ;
                         IF_NONE { PUSH int 94 ; FAILWITH } {} ;
                         CAR ;
                         CAR ;
                         CAR ;
                         GET ;
                         IF_NONE { PUSH int 94 ; FAILWITH } {} ;
                         GET 3 ;
                         COMPARE ;
                         EQ ;
                         IF {} { PUSH string "INVALID_ASSET" ; FAILWITH } ;
                         DUP ;
                         GET 4 ;
                         DUP 3 ;
                         GET 5 ;
                         DUP 3 ;
                         GET 3 ;
                         GET ;
                         IF_NONE { PUSH int 95 ; FAILWITH } {} ;
                         CAR ;
                         GET 3 ;
                         COMPARE ;
                         EQ ;
                         IF {} { PUSH string "WRONG_AMOUNT" ; FAILWITH } ;
                         DUP ;
                         CAR ;
                         CAR ;
                         PUSH string "xtz" ;
                         COMPARE ;
                         EQ ;
                         IF { DUP ;
                              GET 4 ;
                              PUSH mutez 1 ;
                              MUL ;
                              AMOUNT ;
                              COMPARE ;
                              EQ ;
                              IF {} { PUSH string "AMOUNT_MISMATCH" ; FAILWITH } ;
                              NIL operation ;
                              DUP 3 ;
                              GET 5 ;
                              DUP 3 ;
                              GET 3 ;
                              GET ;
                              IF_NONE { PUSH int 249 ; FAILWITH } {} ;
                              CAR ;
                              GET 4 ;
                              CONTRACT unit ;
                              IF_NONE { PUSH int 249 ; FAILWITH } {} ;
                              AMOUNT ;
                              UNIT ;
                              TRANSFER_TOKENS ;
                              CONS }
                            { NIL operation ;
                              DUP 3 ;
                              GET 3 ;
                              CAR ;
                              DUP 3 ;
                              CAR ;
                              CDR ;
                              GET ;
                              IF_NONE { PUSH int 251 ; FAILWITH } {} ;
                              DUP 3 ;
                              CAR ;
                              CAR ;
                              GET ;
                              IF_NONE { PUSH int 251 ; FAILWITH } {} ;
                              CAR ;
                              CONTRACT %transfer (pair address (pair address nat)) ;
                              IF_NONE { PUSH int 251 ; FAILWITH } {} ;
                              PUSH mutez 1 ;
                              PUSH nat 0 ;
                              MUL ;
                              DUP 4 ;
                              GET 4 ;
                              DUP 6 ;
                              GET 5 ;
                              DUP 6 ;
                              GET 3 ;
                              GET ;
                              IF_NONE { PUSH int 252 ; FAILWITH } {} ;
                              CAR ;
                              GET 4 ;
                              SENDER ;
                              PAIR 3 ;
                              TRANSFER_TOKENS ;
                              CONS } ;
                         PUSH string "xtz" ;
                         DUP 4 ;
                         GET 5 ;
                         DUP 4 ;
                         GET 3 ;
                         GET ;
                         IF_NONE { PUSH int 255 ; FAILWITH } {} ;
                         CAR ;
                         CAR ;
                         CAR ;
                         COMPARE ;
                         EQ ;
                         IF { SENDER ;
                              CONTRACT unit ;
                              IF_NONE { PUSH int 256 ; FAILWITH } {} ;
                              PUSH mutez 1 ;
                              DUP 5 ;
                              GET 5 ;
                              DUP 5 ;
                              GET 3 ;
                              GET ;
                              IF_NONE { PUSH int 256 ; FAILWITH } {} ;
                              GET 6 ;
                              MUL ;
                              UNIT ;
                              TRANSFER_TOKENS ;
                              CONS ;
                              DIG 2 ;
                              DUP ;
                              DUP ;
                              DUG 4 ;
                              GET 5 ;
                              DUP 4 ;
                              GET 3 ;
                              GET ;
                              IF_NONE { PUSH int 257 ; FAILWITH } {} ;
                              CAR ;
                              CAR ;
                              CDR ;
                              DUP 5 ;
                              GET 5 ;
                              DUP 5 ;
                              GET 3 ;
                              GET ;
                              IF_NONE { PUSH int 257 ; FAILWITH } {} ;
                              GET 6 ;
                              ADD ;
                              DIG 4 ;
                              GET 6 ;
                              SUB ;
                              ISNAT ;
                              IF_NONE { PUSH int 257 ; FAILWITH } {} ;
                              UPDATE 6 ;
                              DUG 2 }
                            { DIG 2 ;
                              DUP ;
                              DUP ;
                              DUG 4 ;
                              GET 5 ;
                              DUP 4 ;
                              GET 3 ;
                              GET ;
                              IF_NONE { PUSH int 259 ; FAILWITH } {} ;
                              CAR ;
                              CAR ;
                              CDR ;
                              DIG 4 ;
                              GET 6 ;
                              SUB ;
                              ISNAT ;
                              IF_NONE { PUSH int 259 ; FAILWITH } {} ;
                              UPDATE 6 ;
                              DUP ;
                              DUG 3 ;
                              GET 3 ;
                              CAR ;
                              DUP 3 ;
                              CAR ;
                              CDR ;
                              GET ;
                              IF_NONE { PUSH int 260 ; FAILWITH } {} ;
                              DUP 4 ;
                              GET 5 ;
                              DUP 4 ;
                              GET 3 ;
                              GET ;
                              IF_NONE { PUSH int 260 ; FAILWITH } {} ;
                              CAR ;
                              CAR ;
                              CAR ;
                              GET ;
                              IF_NONE { PUSH int 260 ; FAILWITH } {} ;
                              CAR ;
                              CONTRACT %transfer (pair address (pair address nat)) ;
                              IF_NONE { PUSH int 260 ; FAILWITH } {} ;
                              PUSH mutez 1 ;
                              PUSH nat 0 ;
                              MUL ;
                              DUP 5 ;
                              GET 5 ;
                              DUP 5 ;
                              GET 3 ;
                              GET ;
                              IF_NONE { PUSH int 261 ; FAILWITH } {} ;
                              GET 6 ;
                              SENDER ;
                              SELF_ADDRESS ;
                              PAIR 3 ;
                              TRANSFER_TOKENS ;
                              CONS } ;
                         DIG 2 ;
                         DUP ;
                         GET 5 ;
                         NONE (pair (pair (pair string nat) (pair nat address))
                                    (pair (pair string timestamp) (pair bytes nat))) ;
                         DIG 4 ;
                         GET 3 ;
                         UPDATE ;
                         UPDATE 5 ;
                         SWAP }
                       { SWAP ;
                         DUP ;
                         DUG 2 ;
                         CAR ;
                         GET 3 ;
                         SENDER ;
                         COMPARE ;
                         EQ ;
                         IF {} { PUSH string "ONLY_ADMIN" ; FAILWITH } ;
                         SWAP ;
                         UNPAIR ;
                         CDR ;
                         DIG 2 ;
                         PAIR ;
                         PAIR ;
                         NIL operation } } }
               { IF_LEFT
                   { SWAP ;
                     DUP ;
                     DUG 2 ;
                     CAR ;
                     GET 3 ;
                     SENDER ;
                     COMPARE ;
                     EQ ;
                     IF {} { PUSH string "ONLY_ADMIN" ; FAILWITH } ;
                     PUSH mutez 1 ;
                     PUSH nat 0 ;
                     MUL ;
                     PUSH mutez 1 ;
                     DUP 4 ;
                     GET 6 ;
                     MUL ;
                     BALANCE ;
                     SUB ;
                     COMPARE ;
                     GT ;
                     IF {}
                        { PUSH string
                               "WrongCondition: (sp.balance - sp.mul(self.data.userXTZDeposit, sp.mutez(1))) > sp.mul(0, sp.mutez(1))" ;
                          FAILWITH } ;
                     CONTRACT unit ;
                     IF_NONE { PUSH int 205 ; FAILWITH } {} ;
                     NIL operation ;
                     SWAP ;
                     PUSH mutez 1 ;
                     DUP 4 ;
                     GET 6 ;
                     MUL ;
                     BALANCE ;
                     SUB ;
                     UNIT ;
                     TRANSFER_TOKENS ;
                     CONS }
                   { IF_LEFT
                       { SWAP ;
                         DUP ;
                         DUG 2 ;
                         CAR ;
                         GET 3 ;
                         SENDER ;
                         COMPARE ;
                         EQ ;
                         IF {} { PUSH string "ONLY_ADMIN" ; FAILWITH } ;
                         SWAP ;
                         UNPAIR ;
                         UNPAIR ;
                         SWAP ;
                         CDR ;
                         DIG 3 ;
                         PAIR ;
                         SWAP ;
                         PAIR ;
                         PAIR }
                       { SWAP ;
                         DUP ;
                         DUG 2 ;
                         CAR ;
                         GET 3 ;
                         SENDER ;
                         COMPARE ;
                         EQ ;
                         IF {} { PUSH string "ONLY_ADMIN" ; FAILWITH } ;
                         SWAP ;
                         UNPAIR ;
                         UNPAIR ;
                         SWAP ;
                         CAR ;
                         DUP 4 ;
                         CAR ;
                         SWAP ;
                         PAIR ;
                         SWAP ;
                         PAIR ;
                         SWAP ;
                         UNPAIR ;
                         CAR ;
                         DIG 3 ;
                         CDR ;
                         SWAP ;
                         PAIR ;
                         PAIR ;
                         SWAP ;
                         PAIR } ;
                     NIL operation } } } ;
         NIL operation ;
         SWAP ;
         ITER { CONS } ;
         PAIR } }
