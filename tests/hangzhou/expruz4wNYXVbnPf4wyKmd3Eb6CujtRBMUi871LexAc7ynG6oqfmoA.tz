{ storage
    (pair (pair (nat %id) (nat %limit))
          (pair (list %previousWinners address) (map %ticketToAddress nat address))) ;
  parameter nat ;
  code { UNPAIR ;
         AMOUNT ;
         PUSH mutez 1000000 ;
         DUP 3 ;
         MUL ;
         COMPARE ;
         EQ ;
         IF {}
            { PUSH string "WrongCondition: sp.tez(params) == sp.amount" ; FAILWITH } ;
         PUSH mutez 0 ;
         SWAP ;
         DUP ;
         DUG 2 ;
         DIG 3 ;
         DUP ;
         CAR ;
         CAR ;
         SWAP ;
         DUP ;
         DUG 5 ;
         CAR ;
         CDR ;
         SUB ;
         ISNAT ;
         IF_NONE { PUSH int 16 ; FAILWITH } {} ;
         DUP 4 ;
         COMPARE ;
         GT ;
         IF { DROP 2 ;
              SWAP ;
              DUP ;
              CAR ;
              CAR ;
              SWAP ;
              DUP ;
              DUG 3 ;
              CAR ;
              CDR ;
              SUB ;
              ISNAT ;
              IF_NONE { PUSH int 16 ; FAILWITH } {} ;
              PUSH mutez 1000000 ;
              DIG 3 ;
              DUP ;
              CAR ;
              CAR ;
              SWAP ;
              DUP ;
              DUG 5 ;
              CAR ;
              CDR ;
              SUB ;
              ISNAT ;
              IF_NONE { PUSH int 16 ; FAILWITH } {} ;
              DUP 4 ;
              SUB ;
              ISNAT ;
              IF_NONE { PUSH int 20 ; FAILWITH } {} ;
              MUL ;
              SWAP }
            {} ;
         DUP ;
         PUSH nat 1 ;
         ADD ;
         PUSH nat 1 ;
         DUP ;
         DUP 3 ;
         COMPARE ;
         GT ;
         LOOP { DUP 6 ;
                UNPAIR ;
                SWAP ;
                UNPAIR ;
                SWAP ;
                SENDER ;
                SOME ;
                DIG 9 ;
                CAR ;
                CAR ;
                UPDATE ;
                SWAP ;
                PAIR ;
                SWAP ;
                UNPAIR ;
                PUSH nat 1 ;
                ADD ;
                PAIR ;
                PAIR ;
                DUG 5 ;
                PUSH nat 1 ;
                ADD ;
                DUP ;
                DUP 3 ;
                COMPARE ;
                GT } ;
         DROP 3 ;
         SWAP ;
         DROP ;
         DUP ;
         PUSH mutez 0 ;
         COMPARE ;
         LT ;
         IF { NIL operation ;
              SENDER ;
              CONTRACT unit ;
              IF_NONE { PUSH int 28 ; FAILWITH } {} ;
              DIG 2 ;
              UNIT ;
              TRANSFER_TOKENS ;
              CONS }
            { DROP ; NIL operation } ;
         PUSH nat 5 ;
         DUP 3 ;
         CAR ;
         CAR ;
         COMPARE ;
         EQ ;
         IF { SWAP ;
              DUP ;
              DUG 2 ;
              GET 4 ;
              PUSH int 5 ;
              PUSH timestamp "1970-01-01T00:00:00Z" ;
              PUSH timestamp "2021-04-20T22:37:47Z" ;
              SUB ;
              EDIV ;
              IF_NONE { PUSH int 37 ; FAILWITH } { CDR } ;
              GET ;
              IF_NONE { PUSH int 40 ; FAILWITH } {} ;
              CONTRACT unit ;
              IF_NONE { PUSH int 40 ; FAILWITH } {} ;
              PUSH mutez 4500000 ;
              UNIT ;
              TRANSFER_TOKENS ;
              CONS ;
              SWAP ;
              DUP ;
              DUG 2 ;
              UNPAIR ;
              SWAP ;
              CDR ;
              DIG 3 ;
              DUP ;
              GET 3 ;
              SWAP ;
              GET 4 ;
              PUSH int 5 ;
              PUSH timestamp "1970-01-01T00:00:00Z" ;
              PUSH timestamp "2021-04-20T22:37:47Z" ;
              SUB ;
              EDIV ;
              IF_NONE { PUSH int 37 ; FAILWITH } { CDR } ;
              GET ;
              IF_NONE { PUSH int 41 ; FAILWITH } {} ;
              CONS ;
              PAIR ;
              SWAP ;
              CDR ;
              PUSH nat 0 ;
              PAIR ;
              SWAP ;
              CAR ;
              EMPTY_MAP nat address ;
              SWAP ;
              PAIR ;
              SWAP ;
              PAIR ;
              SWAP }
            {} ;
         NIL operation ;
         SWAP ;
         ITER { CONS } ;
         PAIR } }
