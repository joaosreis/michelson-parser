{ storage (pair (address %hen_address) (mutez %test)) ;
  parameter
    (or (or (nat %buy_nft) (nat %cancel_swap)) (or (unit %default) (nat %swap_nft))) ;
  code { UNPAIR ;
         IF_LEFT
           { IF_LEFT
               { NIL operation ;
                 DUP 3 ;
                 CAR ;
                 CONTRACT %collect (pair nat nat) ;
                 IF_NONE { PUSH int 16 ; FAILWITH } {} ;
                 PUSH mutez 0 ;
                 DIG 3 ;
                 PUSH nat 1 ;
                 PAIR ;
                 TRANSFER_TOKENS ;
                 CONS }
               { NIL operation ;
                 DUP 3 ;
                 CAR ;
                 CONTRACT %cancel_swap nat ;
                 IF_NONE { PUSH int 26 ; FAILWITH } {} ;
                 PUSH mutez 0 ;
                 DIG 3 ;
                 TRANSFER_TOKENS ;
                 CONS } }
           { IF_LEFT
               { DROP ; DUP ; CDR ; AMOUNT ; ADD ; UPDATE 2 ; NIL operation }
               { NIL operation ;
                 DUP 3 ;
                 CAR ;
                 CONTRACT %swap (pair nat (pair nat mutez)) ;
                 IF_NONE { PUSH int 21 ; FAILWITH } {} ;
                 PUSH mutez 0 ;
                 PUSH mutez 100000 ;
                 DIG 4 ;
                 PAIR ;
                 PUSH nat 1 ;
                 PAIR ;
                 TRANSFER_TOKENS ;
                 CONS } } ;
         PAIR } }
